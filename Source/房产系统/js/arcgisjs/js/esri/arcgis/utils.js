/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/request esri/geometry/normalizeUtils esri/tasks/Task esri/tasks/ImageServiceIdentifyResult".split(" "),function(h,d,n,k,r,q,l,e){h=h(l,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(b){this._url.path+="/identify";this._handler=d.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,c,s,v,
g){try{var m=new e(b);this._successHandler([m],"onComplete",s,g)}catch(f){this._errorHandler(f,v,g)}},execute:function(b,c,s,e){var g=e.assembly;b=this._encode(d.mixin({},this._url.query,{f:"json"},b.toJson(g&&g[0])));var m=this._handler,f=this._errorHandler;return r({url:this._url.path,content:b,callbackParamName:"callback",load:function(a,f){m(a,f,c,s,e.dfd)},error:function(a){f(a,s,e.dfd)}})},onComplete:function(){}});q._createWrappers(h);n("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyTask",
h,k);return h})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/geometry/Point esri/tasks/query esri/layers/RenderMode esri/layers/GridLayout".split(" "),function(h,d,n,k,r,q,l,e,b,c){h=h([b],{declaredClass:"esri.layers._OnDemandMode",constructor:function(b){this.featureLayer=b;this._featureMap={};this._queryErrorHandler=n.hitch(this,this._queryErrorHandler)},initialize:function(b){this.inherited(arguments);
var e=this.featureLayer,g=e._srInfo;this._gridLayer=new c(new l(g?g.valid[0]:b.extent.xmin,b.extent.ymax,b.spatialReference),{width:e._tileWidth,height:e._tileHeight},{width:b.width,height:b.height},g);this._cellMap={};this._gridLayer.setResolution(b.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(b){this._init&&(2>b?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+
this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(b){var c=this._gridLayer,g=b.geometry,e=[];if(g)for(var e=c.getCellsInExtent("point"===g.type?{xmin:g.x,ymin:g.y,xmax:g.x,ymax:g.y}:g.getExtent(),!1).cells,c=this._cellMap,f,a=b.attributes[this.featureLayer.objectIdField],p,u,d,g=0;g<e.length;g++)f=e[g],p=f.latticeID,u=f.row,d=f.col,p?f=c[p]=c[p]||f:(c[u]=c[u]||{},f=c[u][d]=c[u][d]||f),f.features=
f.features||[],f.features.push(b),this._addFeatureIIf(a,b),this._incRefCount(a)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},_enableConnectors:function(){var b=this.map;this._zoomConnect=d.connect(b,"onZoomEnd",this,this._zoomHandler);this._panConnect=d.connect(b,"onPanEnd",this,this._panHandler);this._resizeConnect=d.connect(b,"onResize",this,this._panHandler)},_disableConnectors:function(){d.disconnect(this._zoomConnect);
d.disconnect(this._panConnect);d.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var b=this.featureLayer,c=this.map;b.suspended||(b._fireUpdateStart(),this._clearIIf(),(b=b._trackManager)&&b.clearTracks(),this._cellMap={},this._gridLayer.setResolution(c.extent),this._sendRequest())},_panHandler:function(b){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&b)},_getRequestId:function(b,c){return("_"+b.name+b.layerId+b._ulid+"_"+c.resolution+
"_"+(c.latticeID||c.row+"_"+c.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(b){this._exceeds=!1;var c=this.featureLayer,g=this.map;b=b||g.extent;g=this._gridLayer.getCellsInExtent(b,c.latticeTiling).cells;if(!c.isEditable())var m=this._cellMap,g=k.filter(g,function(a){if(a.lattice){if(m[a.latticeID])return!1}else if(m[a.row]&&m[a.row][a.col])return!1;return!0});var f=c.getOutFields(),a=c.getDefinitionExpression(),p=c._getOffsettedTE(c._mapTimeExtent),u=c.supportsAdvancedQueries?c.getOrderByFields():
null,d=c._usePatch,l=this._ioQueue,x,y=this,w=this._drawFeatures,A,B,G;this._pending=this._pending||0;for(x=0;x<g.length;x++){A=g[x];B=new e;B.geometry=A.extent||A.lattice;B.outFields=f;B.where=a;c.latticeTiling&&A.extent&&(B.spatialRelationship=e.SPATIAL_REL_CONTAINS);B.returnGeometry=!0;B.timeExtent=p;B.maxAllowableOffset=c._maxOffset;c._ts&&(B._ts=(new Date).getTime());B.orderByFields=u;G=null;if(d&&(G=this._getRequestId(c,A),this._isPending(G)))continue;this._pending++;l.push(c._task.execute(B,
function(){var a=A;return function(b){w.apply(y,[b,a])}}.call(this),this._queryErrorHandler,G))}this._removeOldCells(b);this._endCheck()},_drawFeatures:function(b,c){this._exceeds=this._exceeds||b.exceededTransferLimit;this._finalizeIO();var g=this.map.extent,e=c.extent,f=c.row,a=c.col,p=this.featureLayer.objectIdField,d=b.features,t=this._gridLayer,l=this._cellMap,x=c.latticeID,y=x?l[x]:l[f]&&l[f][a];if(c.resolution!=t._resolution||(x?x!==t.getLatticeID(g):!t.intersects(e,g)))y&&this._removeCell(f,
a,x);else if(y)this._updateCell(y,d);else{c.features=d;x?l[x]=c:(l[f]=l[f]||{},l[f][a]=c);e=d.length;for(g=0;g<e;g++)f=d[g],a=f.attributes[p],this._addFeatureIIf(a,f),this._incRefCount(a)}this._endCheck()},_queryErrorHandler:function(b){this._finalizeIO();this.featureLayer._errorHandler(b);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(b){if(0===this._pending){this._processIOQueue();var c=this.featureLayer,g=c._trackManager;g&&(g.clearTracks(),
g.addFeatures(c.graphics),c._ager&&k.forEach(c.graphics,function(b){b._shape&&c._repaint(b)}),g.moveLatestToFront(),g.drawTracks());this.featureLayer._fireUpdateEnd(b&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)c.onQueryLimitExceeded()}},_processIOQueue:function(b){this._ioQueue=k.filter(this._ioQueue,function(b){return-1<b.fired?!1:!0});b&&k.forEach(this._ioQueue,this._cancelPendingRequest)},_removeOldCells:function(b){var c=
this._cellMap,g=this._gridLayer,e,f;for(e in c)if(c[e]){var a=c[e],p=a.latticeID,d=0,t=0;if(p)d++,p!==g.getLatticeID(b)&&(this._removeCell(null,null,p),t++);else for(f in a)a[f]&&(d++,g.intersects(a[f].extent,b)||(this._removeCell(e,f),t++));t===d&&delete c[e]}},_updateCell:function(b,c){var g=this.featureLayer,e=g.objectIdField,g=g._selectedFeatures,f,a=c.length;b.features=b.features||[];for(f=0;f<a;f++){var p=c[f],d=p.attributes[e],t=this._addFeatureIIf(d,p);t===p?(this._incRefCount(d),b.features.push(t)):
d in g||(t.setGeometry(p.geometry),t.setAttributes(p.attributes))}},_removeCell:function(b,c,g){var e=this._cellMap,f=this.featureLayer,a=f.objectIdField,p=g?e[g]:e[b]&&e[b][c];if(p){g?delete e[g]:delete e[b][c];b=p.features;for(c=0;c<b.length;c++)g=b[c].attributes[a],this._decRefCount(g),g in f._selectedFeatures||this._removeFeatureIIf(g)}}});r("extend-esri")&&n.setObject("layers._OnDemandMode",h,q);return h})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on esri/Evented dijit/_WidgetBase".split(" "),
function(h,d,n,k,r,q){return h([q,r],{_onMap:function(d){var e=this.constructor._onMap,b;if(!e||!e.FINAL)delete this.constructor._onMap,e=this.registerConnectEvents(),e.FINAL=!0;d=d.toLowerCase();e[d]?b=this[e[d].method]:(d=this._onCamelCase(d),this[d]&&(b=d));return b},on:function(d,e){var b=this._onMap(d),c=d.replace(/\-/g,""),s="on"+c in this.domNode;return b||!s?this.inherited(arguments):this.own(k(this.domNode,c,e))[0]},emit:function(l,e,b){var c,s,v,g=l.toLowerCase(),m=this.constructor._onMap||
this.registerConnectEvents();s=this[this._onMap(g)];e=e||{};e.target||(e.target=this);s&&(m&&m[g])&&(this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},m[g].argKeys)(e),v=d.mixin({},arguments),v[2]=c,v[0]=m[g].name.replace(/^on/,""));return this.inherited(v||arguments)}})})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(h,d,n,k,r,q,l){var e={_isElementShown:function(b){var c=k.get(b);return"hidden"!=
c.visibility&&"collapsed"!=c.visibility&&"none"!=c.display&&"hidden"!=n.get(b,"type")},hasDefaultTabStop:function(b){switch(b.nodeName.toLowerCase()){case "a":return n.has(b,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var c;try{var e=b.contentDocument;if("designMode"in e&&"on"==e.designMode)return!0;c=e.body}catch(d){try{c=b.contentWindow.document.body}catch(g){return!1}}return c&&("true"==c.contentEditable||c.firstChild&&"true"==
c.firstChild.contentEditable);default:return"true"==b.contentEditable}},isTabNavigable:function(b){return n.get(b,"disabled")?!1:n.has(b,"tabIndex")?0<=n.get(b,"tabIndex"):e.hasDefaultTabStop(b)},_getTabNavigable:function(b){function c(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}var d,l,g,m,f,a,p={},u=e._isElementShown,t=e.isTabNavigable,k=function(b){for(b=b.firstChild;b;b=b.nextSibling)if(!(1!=b.nodeType||9>=q("ie")&&"HTML"!==
b.scopeName||!u(b))){if(t(b)){var e=+n.get(b,"tabIndex");if(!n.has(b,"tabIndex")||0==e)d||(d=b),l=b;else if(0<e){if(!g||e<m)m=e,g=b;if(!f||e>=a)a=e,f=b}e=c(b);n.get(b,"checked")&&e&&(p[e]=b)}"SELECT"!=b.nodeName.toUpperCase()&&k(b)}};u(b)&&k(b);return{first:p[c(d)]||d,last:p[c(l)]||l,lowest:p[c(g)]||g,highest:p[c(f)]||f}},getFirstInTabbingOrder:function(b,c){var s=e._getTabNavigable(d.byId(b,c));return s.lowest?s.lowest:s.first},getLastInTabbingOrder:function(b,c){var s=e._getTabNavigable(d.byId(b,
c));return s.last?s.last:s.highest}};r.mixin(l,e);return e})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has esri/kernel esri/SpatialReference esri/geometry/Extent esri/geometry/webMercatorUtils esri/renderers/SimpleRenderer esri/layers/layer esri/layers/FeatureLayer esri/dijit/PopupTemplate".split(" "),function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f){h=h([g],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(a,f){this.pointSymbol=f&&f.pointSymbol;this.polylineSymbol=f&&f.polylineSymbol;this.polygonSymbol=f&&f.polygonSymbol;this._outSR=f&&(f.outSpatialReference||f.outSR)||new b({wkid:4326});this._options=n.mixin({},f)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var a=[];this._fLayers&&(a=a.concat(this._fLayers));return a},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&(this._map&&!this._io&&
this.visible)&&this._createLayer()},_createLayer:function(a){var b=this;this._fireUpdateStart();a=this.parse(a);a.addCallback(function(a){b._io=null;b._initLayer(a)});a.addErrback(function(a){b._io=null;a=n.mixin(Error(),a);a.message="Unable to load resource: "+b.url+" "+(a.message||"");b._fireUpdateEnd(a);b.onError(a)})},_initLayer:function(a){this.loaded&&this._removeInternalLayers();this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.defaultVisibility=void 0!==a.visibility?
this.visible=!!a.visibility:this.visible=!0;this.featureInfos=a.featureInfos;this.fullExtent=this.initialExtent=new c(a.lookAtExtent);this.copyright=a.author||a.copyright;var b;if((a=n.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=[],k.forEach(a,function(a,c){var e=n.getObject("featureSet.features",!1,a);e&&0<e.length&&(b=n.mixin({outFields:["*"],infoTemplate:a.popupInfo?new f(a.popupInfo):null,editable:!1},this._options),b.id&&(b.id=b.id+"_"+c),a.layerDefinition.capabilities=
"Query,Data",e=new m(a,b),e.geometryType&&(this["_"+e.geometryType]=e),this._fLayers.push(e))},this),0===this._fLayers.length&&delete this._fLayers;this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(a=new v(this.pointSymbol),this._esriGeometryPoint.setRenderer(a)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(a=new v(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(a)));
this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(a=new v(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(a)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();var b=a.spatialReference,f=this._outSR,c;if(b.wkid)c=b._isWebMercator()&&f._isWebMercator()||b.wkid===f.wkid;else if(b.wkt)c=b.wkt===f.wkt;else{console.log("_setMap - map has invalid spatial reference");
return}if(!c)if(b._isWebMercator()&&4326===f.wkid)this._converter=s.geographicToWebMercator;else if(f._isWebMercator()&&4326===b.wkid)this._converter=s.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(b=this._fLayers)&&0<b.length&&k.forEach(b,function(b){if(this._converter){var f=b.graphics,c,e,g=f?f.length:0;for(c=0;c<g;c++)(e=f[c].geometry)&&f[c].setGeometry(this._converter(e))}a.addLayer(b)},
this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var a=this._map;a&&k.forEach(this.getFeatureLayers(),a.removeLayer,a)},setOpacity:function(a){this.opacity!=a&&(k.forEach(this.getFeatureLayers(),function(b){b.setOpacity(a)}),this.opacity=this._options.opacity=a,this.onOpacityChange(a))},onVisibilityChange:function(a){this._fireUpdateStart();k.forEach(this.getFeatureLayers(),function(b){b.setVisibility(a)});this._fireUpdateEnd()},_setMap:function(a,b){this.inherited(arguments);
this._map=a;var f=this._div=r.create("div",null,b);q.set(f,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return f},_unsetMap:function(a,b){this._io&&this._io.cancel();d.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var f=this._div;f&&(b.removeChild(f),r.destroy(f));this._div=null;this.inherited(arguments)}});l("extend-esri")&&n.setObject("layers._ServiceGeneratedFeatureCollection",h,e);return h})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/config esri/request esri/layers/ServiceGeneratedFeatureCollection".split(" "),
function(h,d,n,k,r,q,l,e){h=h([e],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(b,c){q.defaults.geoRSSService&&(this.serviceUrl=q.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=l({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?n.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(b){this.inherited(arguments);
this.loaded||(this.loaded=!0,this.onLoad(this))}});k("extend-esri")&&d.setObject("layers.GeoRSSLayer",h,r);return h})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has esri/kernel esri/lang dojo/i18n!dojo/cldr/nls/number".split(" "),function(h,d,n,k,r,q,l,e){h=h(null,{declaredClass:"esri.PopupInfo",initialize:function(b,c){if(b){d.mixin(this,c);this.info=b;this.title=this.getTitle;this.content=this.getContent;var e=this._fieldLabels=
{},l=this._fieldsMap={};b.fieldInfos&&n.forEach(b.fieldInfos,function(b){e[b.fieldName]=b.label;l[b.fieldName]=b})}},toJson:function(){return k.fromJson(k.toJson(this.info))},getTitle:function(){},getContent:function(){},getComponents:function(b){var c=this.info,s=b.getLayer(),l=d.clone(b.attributes)||{},g=d.clone(l),m=c.fieldInfos,f="",a="",p,u,t,k=s&&s._getDateOpts&&s._getDateOpts().properties,x={dateFormat:{properties:k,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
m&&n.forEach(m,function(a){var b=a.fieldName;g[b]=this._formatValue(g[b],b,x);k&&(a.format&&a.format.dateFormat)&&(a=n.indexOf(k,b),-1<a&&k.splice(a,1))},this);if(s){var y=s.types,w=s.typeIdField,A=w&&l[w];for(u in l)if(t=l[u],e.isDefined(t)){var B=this._getDomainName(s,y,A,u,t);e.isDefined(B)?g[u]=B:u===w&&(B=this._getTypeName(s,t),e.isDefined(B)&&(g[u]=B))}}c.title&&(f=d.trim(e.substitute(g,this._fixTokens(c.title),x)||""));c.description&&(a=d.trim(e.substitute(g,this._fixTokens(c.description),
x)||""));m&&(p=[],n.forEach(m,function(a){(u=a.fieldName)&&a.visible&&p.push([a.label||u,e.substitute(g,"${"+u+"}",x)||""])}));var G,N;c.mediaInfos&&(G=[],n.forEach(c.mediaInfos,function(a){N=0;t=a.value;switch(a.type){case "image":var b=t.sourceURL,b=b&&d.trim(e.substitute(l,this._fixTokens(b)));N=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":N=n.some(t.fields,function(a){return e.isDefined(l[a])});break;default:return}if(N){a=d.clone(a);t=a.value;a.title=a.title?
d.trim(e.substitute(g,this._fixTokens(a.title),x)||""):"";a.caption=a.caption?d.trim(e.substitute(g,this._fixTokens(a.caption),x)||""):"";if("image"===a.type)t.sourceURL=e.substitute(l,this._fixTokens(t.sourceURL)),t.linkURL&&(t.linkURL=d.trim(e.substitute(l,this._fixTokens(t.linkURL))||""));else{var f=l[t.normalizeField]||0;t.fields=n.map(t.fields,function(a){var b=l[a];(b=void 0===b?null:b)&&f&&(b/=f);return{y:b,tooltip:(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(b,a,x,!!f)}},this)}G.push(a)}},
this));return{title:f,description:a,fields:p&&p.length?p:null,mediaInfos:G&&G.length?G:null,formatted:g,editSummary:s&&s.getEditSummary?s.getEditSummary(b):""}},getAttachments:function(b){var c=b.getLayer();b=b.attributes;if(this.info.showAttachments&&(c&&c.hasAttachments&&c.objectIdField)&&(b=b&&b[c.objectIdField]))return c.queryAttachmentInfos(b)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_fixTokens:function(b){return b.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_formatValue:function(b,c,d,l){var g=this._fieldsMap[c];c=g&&g.format;if(!e.isDefined(b)||!g||!e.isDefined(c))return b;var m="",f=[],g=c.hasOwnProperty("places")||c.hasOwnProperty("digitSeparator"),a=c.hasOwnProperty("digitSeparator")?c.digitSeparator:!0;if(g)m="NumberFormat",f.push("places: "+(e.isDefined(c.places)&&(!l||0<c.places)?Number(c.places):"Infinity")),f.length&&(m+="("+f.join(",")+
")");else if(c.dateFormat)m="DateFormat"+this._insertOffset(this._dateFormats[c.dateFormat]||this._dateFormats.shortDateShortTime);else return b;b=e.substitute({myKey:b},"${myKey:"+m+"}",d)||"";g&&!a&&(d=r.getLocalization("dojo.cldr","number"),d.group&&(b=b.replace(RegExp("\\"+d.group,"g"),"")));return b},_insertOffset:function(b){b&&(b=e.isDefined(this.utcOffset)?b.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):b);return b},_getDomainName:function(b,c,d,l,g){var m,f;c&&e.isDefined(d)&&n.some(c,
function(a){if(a.id==d){if((m=a.domains&&a.domains[l])&&"inherited"===m.type)m=this._getLayerDomain(b,l),f=!0;return!0}return!1},this);!f&&!m&&(m=this._getLayerDomain(b,l));if(m&&m.codedValues){var a;n.some(m.codedValues,function(b){return b.code==g?(a=b.name,!0):!1});return a}},_getLayerDomain:function(b,c){var e=b.fields;if(e){var d;n.some(e,function(b){return b.name===c?(d=b.domain,!0):!1});return d}},_getTypeName:function(b,c){var e=b.types;if(e){var d;n.some(e,function(b){return b.id==c?(d=b.name,
!0):!1});return d}}});q("extend-esri")&&(l.PopupInfo=l.PopupInfoTemplate=h);return h})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style esri/kernel esri/config esri/lang esri/request esri/SpatialReference esri/geometry/webMercatorUtils esri/dijit/PopupTemplate esri/layers/layer esri/layers/KMLFolder esri/layers/KMLGroundOverlay esri/layers/MapImageLayer esri/layers/FeatureLayer".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a,p,u,t,z,x,y){var w=d([u],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(a,b){a||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=b&&b.outSR||new f({wkid:4326});this._options=k.mixin({},b);v.defaults.kmlService&&(this.serviceUrl=v.defaults.kmlService);var c=this.linkInfo=b&&b.linkInfo;c&&(this.visible=!!c.visibility,this._waitingForMap=!!c.viewFormat);
(!c||c&&c.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=k.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(a){if(a){var b=a.type,f=a.id,c;switch(b){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(a=this["_"+b])&&(c=k.getObject("_mode._featureMap."+f,!1,a));break;case "GroundOverlay":if(a=this._groundLyr){var e=a.getImages(),b=e.length;for(a=0;a<b;a++)if(e[a].id===f){c=e[a];break}}break;case "ScreenOverlay":break;
case "NetworkLink":r.some(this._links,function(a){return a.linkInfo&&a.linkInfo.id===f?(c=a,!0):!1});break;case "Folder":b=(e=this.folders)?e.length:0;for(a=0;a<b;a++)if(e[a].id===f){c=e[a];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return c}},getLayers:function(){var a=[];this._groundLyr&&a.push(this._groundLyr);this._fLayers&&(a=a.concat(this._fLayers));this._links&&r.forEach(this._links,function(b){b.declaredClass&&a.push(b)});return a},setFolderVisibility:function(a,
b){a&&(this._fireUpdateStart(),(a.visible=b)&&(b=this._areLocalAncestorsVisible(a)),this._setState(a,b),this._fireUpdateEnd())},onRefresh:function(){},onOpacityChange:function(){},_parseKml:function(a){var b=this;this._fireUpdateStart();this._io=m({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(a),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:q.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(a){b._io=null;b._initLayer(a)},error:function(a){b._io=
null;a=k.mixin(Error(),a);a.message="Unable to load KML: "+b.url+" "+(a.message||"");b._fireUpdateEnd(a);b.onError(a)}})},_initLayer:function(a){this.loaded&&this._removeInternalLayers();this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.visibility=a.visibility;this.featureInfos=a.featureInfos;var b,f,c=this.folders=a.folders,e=[],g;if(c){f=c.length;for(b=0;b<f;b++)g=c[b]=new t(c[b]),-1===g.parentFolderId&&e.push(g)}var c=this._links=a.networkLinks,d;f=c?c.length:0;for(b=
0;b<f;b++)c[b].viewRefreshMode&&-1!==c[b].viewRefreshMode.toLowerCase().indexOf("onregion")||(d=k.mixin({},this._options),d.linkInfo=c[b],d.id&&(d.id=d.id+"_"+b),c[b]=new w(c[b].href,d),c[b]._parentLayer=this,c[b]._parentFolderId=this._getLinkParentId(c[b].linkInfo.id));if((c=a.groundOverlays)&&0<c.length){d=k.mixin({},this._options);d.id&&(d.id+="_mapImage");g=this._groundLyr=new x(d);f=c.length;for(b=0;b<f;b++)g.addImage(new z(c[b]))}if((a=k.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=
[],r.forEach(a,function(a,b){var f=k.getObject("featureSet.features",!1,a);f&&0<f.length&&(d=k.mixin({outFields:["*"],infoTemplate:a.popupInfo?new p(a.popupInfo):null,editable:!1},this._options),d.id&&(d.id=d.id+"_"+b),a.layerDefinition.capabilities="Query,Data",f=new y(a,d),f.geometryType&&(this["_"+f.geometryType]=f),this._fLayers.push(f))},this),0===this._fLayers.length&&delete this._fLayers;f=e.length;for(b=0;b<f;b++)g=e[b],this._setState(g,g.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),
this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var b=this._map;this._fireUpdateStart();this._links&&r.forEach(this._links,function(a){a.declaredClass&&(b.addLayer(a),a._waitingForMap&&(a._waitingForMap=null,a.visible?a._parseKml(b):a._wMap=b))});var f=b.spatialReference,c=this._outSR,e;if(!f.equals(c))if(f.isWebMercator()&&4326===c.wkid)e=a.geographicToWebMercator;else if(c.isWebMercator()&&4326===f.wkid)e=a.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");
return}this._groundLyr&&(e&&r.forEach(this._groundLyr.getImages(),function(a){a.extent=e(a.extent)}),b.addLayer(this._groundLyr));(f=this._fLayers)&&0<f.length&&r.forEach(f,function(a){if(e){var f=a.graphics,c,d,g=f?f.length:0;for(c=0;c<g;c++)(d=f[c].geometry)&&f[c].setGeometry(e(d))}b.addLayer(a)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var a=this._map;this._links&&r.forEach(this._links,function(a){a.declaredClass&&a._io&&a._io.cancel()});a&&r.forEach(this.getLayers(),
a.removeLayer,a)},_setState:function(a,b){var f=a.featureInfos,c,e,d,g=f?f.length:0,p=b?"show":"hide";for(d=0;d<g;d++)if(c=f[d],e=this.getFeature(c))if("Folder"===c.type)this._setState(e,b&&e.visible);else if("NetworkLink"===c.type)this._setInternalVisibility(e,b);else e[p]()},_areLocalAncestorsVisible:function(a){var b=a.parentFolderId;for(a=a.visible;a&&-1!==b;)b=this.getFeature({type:"Folder",id:b}),a=a&&b.visible,b=b.parentFolderId;return a},_setInternalVisibility:function(a,b){var f=a._parentLayer,
c=a._parentFolderId;for(b=b&&a.visible;b&&f;)b=b&&f.visible,-1<c&&(b=b&&f._areLocalAncestorsVisible(f.getFeature({type:"Folder",id:c}))),c=f._parentFolderId,f=f._parentLayer;this._setIntState(a,b)},_setIntState:function(a,b){a&&r.forEach(a.getLayers(),function(f){f.linkInfo?a._setIntState(f,b&&f.visible&&a._areLocalAncestorsVisible(a.getFeature({type:"Folder",id:f._parentFolderId}))):f.setVisibility(b)})},_getLinkParentId:function(a){var b=-1;this.folders&&r.some(this.folders,function(f){return f.networkLinkIds&&
-1!==r.indexOf(f.networkLinkIds,a)?(b=f.id,!0):!1});return b},_checkAutoRefresh:function(){var a=this.linkInfo;if(a)if(this.visible){if(this.loaded&&this._map){var b=a.refreshMode,f=a.refreshInterval,c=a.viewRefreshMode,a=a.viewRefreshTime;b&&(-1!==b.toLowerCase().indexOf("oninterval")&&0<f)&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*f));c&&(-1!==c.toLowerCase().indexOf("onstop")&&0<a)&&!this._extChgHandle&&(this._extChgHandle=n.connect(this._map,"onExtentChange",this,
this._extentChanged))}}else this._stopAutoRefresh(),n.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(b){b=b||this._map;var f={},c=this.linkInfo,d=b&&b.extent,p;this._url.query&&(k.mixin(f,this._url.query),p=!!this._url.query.token);if(s.id&&!p&&(p=s.id.findCredential(this._url.path)))f.token=p.token;if(c){p=c.viewFormat;var m=c.httpQuery,c=c.viewBoundScale;if(d&&p){var l=
d,t=d,u=d.spatialReference;u&&(u.isWebMercator()?l=a.webMercatorToGeographic(d):4326===u.wkid&&(t=a.geographicToWebMercator(d)));d=l.getCenter();t=Math.max(t.getWidth(),t.getHeight());c&&(l=l.expand(c));p=p.replace(/\[bboxWest\]/ig,l.xmin).replace(/\[bboxEast\]/ig,l.xmax).replace(/\[bboxSouth\]/ig,l.ymin).replace(/\[bboxNorth\]/ig,l.ymax).replace(/\[lookatLon\]/ig,d.x).replace(/\[lookatLat\]/ig,d.y).replace(/\[lookatRange\]/ig,t).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,
d.x).replace(/\[lookatTerrainLat\]/ig,d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,d.x).replace(/\[cameraLat\]/ig,d.y).replace(/\[cameraAlt\]/ig,t).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,b.width).replace(/\[vertPixels\]/ig,b.height).replace(/\[terrainEnabled\]/ig,0);k.mixin(f,e.queryToObject(p))}m&&(m=m.replace(/\[clientVersion\]/ig,s.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,
h.locale),k.mixin(f,e.queryToObject(m)))}b=[];for(var w in f)g.isDefined(f[w])&&b.push(w+"\x3d"+f[w]);return(b=b.join("\x26"))?"?"+b:""},setOpacity:function(a){this.opacity!=a&&(r.forEach(this.getLayers(),function(b){b.setOpacity(a)}),this.opacity=this._options.opacity=a,this.onOpacityChange(a))},_setMap:function(a,f){this.inherited(arguments);this._map=a;var e=this._div=b.create("div",null,f);c.set(e,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return e},_unsetMap:function(a,
f){this._io&&this._io.cancel();this._stopAutoRefresh();n.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var c=this._div;c&&(f.removeChild(c),b.destroy(c));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(a){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,a),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&a&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&(this._map&&
!this._io&&this.visible)&&this._parseKml()},getFeatureCollection:function(a){var b,f=[];if(a=this.getFeature({type:"Folder",id:a}))(b=r.map(a.featureInfos,function(a){if("esriGeometryPoint"===a.type||"esriGeometryPolyline"===a.type||"esriGeometryPolygon"===a.type)return a.id},this))&&0<b.length&&r.forEach(this._fLayers,function(a){var c,e;c=a.toJson();c.featureSet.features&&0<c.featureSet.features.length&&(e=r.filter(c.featureSet.features,function(f){if(-1!==r.indexOf(b,f.attributes[a.objectIdField]))return f},
this));e&&0<e.length&&(c.featureSet.features=e,f.push(c))},this);return f},getFeatureCount:function(a){a=this.getFeature({type:"Folder",id:a});var b={points:0,polylines:0,polygons:0};a&&r.forEach(a.featureInfos,function(a){"esriGeometryPoint"===a.type&&(b.points+=1);"esriGeometryPolyline"===a.type&&(b.polylines+=1);"esriGeometryPolygon"===a.type&&(b.polygons+=1)});return b},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});
l("extend-esri")&&k.setObject("layers.KMLLayer",w,s);return w})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(h,d,n,k,r,q,l){r.add("highcontrast",function(){var e=l.doc.createElement("div");e.style.cssText="border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("+(d.blankGif||h.toUrl("./resources/blank.gif"))+");";l.body().appendChild(e);var b=k.getComputedStyle(e),
c=b.backgroundImage,b=b.borderTopColor==b.borderRightColor||c&&("none"==c||"url(invalid-url:)"==c);8>=r("ie")?e.outerHTML="":l.body().removeChild(e);return b});q(function(){r("highcontrast")&&n.add(l.body(),"dj_a11y")});return r})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang esri/geometry/jsonUtils".split(" "),function(h,d,n,k,r,q,l){h=h(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",
geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(e){var b=e&&e.geometry||this.geometry;e={geometry:b,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?n.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?n.toJson(this.renderingRule.toJson()):null};b&&(e.geometryType=l.getJsonType(b));b=this.timeExtent;e.time=
b?b.toJson().join(","):null;q.isDefined(this.pixelSizeX)&&q.isDefined(this.pixelSizeY)?e.pixelSize=n.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(e.pixelSize=this.pixelSize?n.toJson(this.pixelSize.toJson()):null);return e}});k("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyParameters",h,r);return h})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a,p,u,t,z,x,y,w){function A(a){return function(b){e[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}g.add("dijit-legacy-requires",!m.isAsync);g.add("dojo-bidi",!1);g("dijit-legacy-requires")&&p(0,function(){h(["dijit/_base/manager"])});var B={};k=q("dijit._WidgetBase",[u,x],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:A("lang"),dir:"",_setDirAttr:A("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",
srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:k.blankGif||h.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,f=a._setterAttrs=[],a=a._onMap={},c;for(c in b.attributeMap)f.push(c);for(c in b)/^on/.test(c)&&(a[c.substring(2).toLowerCase()]=c),/^_set[A-Z](.*)Attr$/.test(c)&&(c=c.charAt(4).toLowerCase()+c.substr(5,c.length-
9),(!b.attributeMap||!(c in b.attributeMap))&&f.push(c))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=l.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,f.mixin(this,a));this.postMixInProperties();this.id||(this.id=w.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=z.body(this.ownerDocument);w.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var e=this.srcNodeRef;e&&(e.parentNode&&this.domNode!==e)&&(e.parentNode.replaceChild(this.domNode,e),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);d.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var f=this._get(b);f&&this.set(b,f)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(d.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,d.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&f.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(f){f.destroyRecursive?f.destroyRecursive(a):f.destroy&&f.destroy(a)}this._beingDestroyed=!0;this.uninitialize();d.forEach(this._connects,f.hitch(this,"disconnect"));d.forEach(this._supportingWidgets,b);this.domNode&&d.forEach(w.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
w.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?e.remove(this.domNode,"widgetId"):c.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||c.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){d.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;f.isObject(a)?
v.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,c,g){g=3<=arguments.length?g:this.attributeMap[a];d.forEach(f.isArray(g)?g:[g],function(d){var g=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":f.isFunction(c)&&(c=f.hitch(this,c));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;g.tagName?e.set(g,d,c):g.set(d,c);break;case "innerText":g.innerHTML="";g.appendChild(this.ownerDocument.createTextNode(c));
break;case "innerHTML":g.innerHTML=c;break;case "class":b.replace(g,c,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var e=this[c.s];if(f.isFunction(e))var d=e.apply(this,Array.prototype.slice.call(arguments,1));else{var e=this.focusNode&&!f.isFunction(this.focusNode)?"focusNode":"domNode",g=this[e]&&this[e].tagName,p;if(p=g)if(!(p=
B[g])){p=this[e];var m={},l;for(l in p)m[l.toLowerCase()]=!0;p=B[g]=m}l=p;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:l&&c.l in l&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?e:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return d||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var f=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+f+"Attr",
g:"_get"+f+"Attr",l:f.toLowerCase()}},_set:function(a,b){var f=this[a];this[a]=b;this._created&&b!==f&&(this._watchCallbacks&&this._watchCallbacks(a,f,b),this.emit("attrmodified-"+a,{detail:{prevValue:f,newValue:b}}))},_get:function(a){return this[a]},emit:function(b,f,c){f=f||{};void 0===f.bubbles&&(f.bubbles=!0);void 0===f.cancelable&&(f.cancelable=!0);f.detail||(f.detail={});f.detail.widget=this;var e,d=this["on"+b];d&&(e=d.apply(this,c?c:[f]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,
b.toLowerCase(),f);return e},on:function(b,f){var c=this._onMap(b);return c?n.after(this,c,f,!0):this.own(a(this.domNode,b,f))[0]},_onMap:function(a){var b=this.constructor,f=b._onMap;if(!f){var f=b._onMap={},c;for(c in b.prototype)/^on/.test(c)&&(f[c.replace(/^on/,"").toLowerCase()]=c)}return f["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?w.findWidgets(this.containerNode):
[]},getParent:function(){return w.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,f){return this.own(r.connect(a,b,this,f))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(t.subscribe(a,f.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:s.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=v.get(this.domNode,"display")},placeAt:function(a,b){var f=!a.tagName&&
w.byId(a);f&&f.addChild&&(!b||"number"===typeof b)?f.addChild(this,b):(f=f?f.containerNode&&!/after|before|replace/.test(b||"")?f.containerNode:f.domNode:l.byId(a,this.ownerDocument),c.place(this.domNode,f,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(f.hitch(this,function(){c&&(c=null,this._destroyed||f.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});g("dojo-bidi")&&k.extend(y);
return k})},"esri/layers/FeatureLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all esri/kernel esri/lang esri/request esri/config esri/deferredUtils esri/SpatialReference esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/jsonUtils esri/renderers/SimpleRenderer esri/renderers/UniqueValueRenderer esri/renderers/jsonUtils esri/tasks/QueryTask esri/tasks/query esri/tasks/FeatureSet esri/tasks/StatisticDefinition esri/geometry/Extent esri/geometry/jsonUtils esri/geometry/normalizeUtils esri/geometry/scaleUtils esri/layers/GraphicsLayer esri/layers/Field esri/layers/TimeInfo esri/layers/FeatureType esri/layers/FeatureTemplate esri/layers/FeatureEditResult esri/layers/LabelClass esri/layers/SnapshotMode esri/layers/OnDemandMode esri/layers/SelectionMode esri/layers/TrackManager dojo/i18n!esri/nls/jsapi dojo/has!extend-esri?esri/layers/agscommon".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a,p,u,t,z,x,y,w,A,B,G,N,K,W,S,Z,T,ga,C,D,E,U,J,F,H,X,M,V,O,P){var ha=p.defaults,I=h(D,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],
"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(b,c){this.i18n=s.getLocalization("esri","jsapi");c=c||{};this._outFields=c.outFields;
this._loadCallback=c.loadCallback;var e=c._usePatch;this._usePatch=null===e||void 0===e?!0:e;this._trackIdField=c.trackIdField;this.objectIdField=c.objectIdField;this._maxOffset=null!=c.maxAllowableOffset?c.maxAllowableOffset:this.maxAllowableOffset;this._optEditable=c.editable;this._optAutoGen=c.autoGeneralize;this.editSummaryCallback=c.editSummaryCallback;this.userId=c.userId;this.userIsAdmin=c.userIsAdmin;this.useMapTime=c.hasOwnProperty("useMapTime")?!!c.useMapTime:!0;this.source=c.source;this.gdbVersion=
c.gdbVersion;this.orderByFields=c.orderByFields;this.maxPointCountForAuto=null!=c.maxPointCountForAuto?c.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=c.maxRecordCountForAuto?c.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=c.maxVertexCountForAuto?c.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=null!=c.generalizeForScale?c.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=c.queryPagination?
c.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var d=I;switch(this.mode=f.isDefined(c.mode)?c.mode:d.MODE_ONDEMAND){case d.MODE_SNAPSHOT:this.currentMode=d.MODE_SNAPSHOT;this._mode=new M(this);this._isSnapshot=!0;break;case d.MODE_ONDEMAND:case d.MODE_AUTO:this.currentMode=d.MODE_ONDEMAND;this._tileWidth=c.tileWidth||512;this._tileHeight=c.tileHeight||512;
this._mode=new V(this);this.latticeTiling=c.latticeTiling;break;case d.MODE_SELECTION:this.currentMode=d.MODE_SELECTION,this._mode=new O(this),this._isSelOnly=!0}this._initLayer=n.hitch(this,this._initLayer);this._selectHandler=n.hitch(this,this._selectHandler);this._editable=!1;if(n.isObject(b)&&b.layerDefinition)return this._collection=!0,this.mode=d.MODE_SNAPSHOT,this._initLayer(b),this;this._task=new N(this.url,{source:this.source,gdbVersion:this.gdbVersion});e=this._url.path;this._fserver=!1;
-1!==e.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===d.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(d=c.resourceInfo)?this._initLayer(d):(this.source&&(d={source:this.source.toJson()},this._url.query=n.mixin(this._url.query,{layer:r.toJson(d)})),this.gdbVersion&&(this._url.query=n.mixin(this._url.query,{gdbVersion:this.gdbVersion})),a({url:e,content:n.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},
_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this.currentMode=I.MODE_SNAPSHOT,this._mode=new M(this),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);if(a.hasOwnProperty("capabilities")){var c=this.capabilities=a.capabilities;c&&-1!==c.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||
(this._editable=this._fserver);f.isDefined(this._optEditable)&&(this._editable=this._optEditable,delete this._optEditable);this._json=r.toJson(this._json);if(this.isEditable())delete this._maxOffset;else if(this.currentMode!==I.MODE_SNAPSHOT&&("esriGeometryPolyline"===a.geometryType||"esriGeometryPolygon"===a.geometryType))this._autoGeneralize=f.isDefined(this._optAutoGen)?this._optAutoGen:this.currentMode===I.MODE_ONDEMAND,delete this._optAutoGen;var c=a.effectiveMinScale||a.minScale,d=a.effectiveMaxScale||
a.maxScale;!this._hasMin&&c&&this.setMinScale(c);!this._hasMax&&d&&this.setMaxScale(d);this.layerId=a.id;this.name=a.name;this.description=a.description;this.copyright=a.copyrightText;this.type=a.type;this.geometryType=a.geometryType;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new Z(a.extent);this.initialExtent=new Z(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new t(this.fullExtent.spatialReference.toJson()));
this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;
this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;this.allowGeometryUpdates=f.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this._isTable="Table"===this.type;for(var g=this.fields=
[],d=a.fields,c=0;c<d.length;c++)g.push(new E(d[c]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField){d=a.fields;for(c=0;c<d.length;c++)if(g=d[c],"esriFieldTypeOID"===g.type){this.objectIdField=g.name;break}}this.objectIdField||console.debug("esri.layers.FeatureLayer: "+f.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!f.isDefined(this._nextId)){d=this.objectIdField;g=-1;if(this._collection&&d)for(var p=(c=this._featureSet)&&c.features,l=
p?p.length:0,m,c=0;c<l;c++)m=(m=p[c].attributes)&&m[d],m>g&&(g=m);this._nextId=g+1}this.globalIdField=a.globalIdField;if(c=this.typeIdField=a.typeIdField)if(c=!this._getField(c)&&this._getField(c,!0))this.typeIdField=c.name;this.visibilityField=a.visibilityField;if(d=a.defaultSymbol)this.defaultSymbol=w.fromJson(d);var u=this.types=[],s=a.types,q,v,g=(c=this.editFieldsInfo)&&c.creatorField,p=c&&c.editorField;m=g||p;l=[];if(s)for(c=0;c<s.length;c++)q=new J(s[c]),v=q.templates,m&&(v&&v.length)&&(l=
l.concat(v)),u.push(q);s=a.templates;q=this.templates=[];if(s)for(c=0;c<s.length;c++)u=new F(s[c]),m&&l.push(u),q.push(u);for(c=0;c<l.length;c++)if(m=n.getObject("prototype.attributes",!1,l[c]))g&&delete m[g],p&&delete m[p];if(c=a.timeInfo)this.timeInfo=new U(c),this._startTimeField=c.startTimeField,this._endTimeField=c.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?c.trackIdField=this._trackIdField:this._trackIdField=c.trackIdField;this.hasAttachments=
!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var c=a.drawingInfo,h;if(g=c&&c.labelingInfo)this.labelingInfo=k.map(g,function(a){return new X(a)}),this._fixLabelExpr();if(!this.renderer)if(c&&c.renderer){if(h=c.renderer,this.setRenderer(G.fromJson(h)),"classBreaks"===h.type&&this.renderer.setMaxInclusive(!0),!this._collection){var K=h.type,d=[];h=this.renderer;switch(K){case "simple":d.push(h.symbol);break;case "uniqueValue":case "classBreaks":d.push(h.defaultSymbol),
d=d.concat(k.map(h.infos,function(a){return a.symbol}))}var d=k.filter(d,f.isDefined),N=this._url.path+"/images/",S=this._getToken();k.forEach(d,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=N+b),S&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+S))})}}else if(d)s=this.types,0<s.length?(h=new B(this.defaultSymbol,this.typeIdField),k.forEach(s,function(a){h.addValue(a.id,a.symbol)})):h=new A(this.defaultSymbol),this.setRenderer(h);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":K=
new z;break;case "esriGeometryPolyline":K=new x;break;case "esriGeometryPolygon":K=new y}this.setRenderer(K?new A(K):null)}K=c&&c.transparency||0;!this.hasOwnProperty("opacity")&&0<K&&(this.opacity=1-K/100);this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);if((e("ie")||e("safari"))&&this.isEditable()&&10.02>this.version)this._ts=!0;this.statistics=
a.statistics;this._fixRendererFields();this._checkFields();this._updateCaps();var T=function(){this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?(K=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new W(K)),this._fcAdded=!0,T.call(this)):this._forceIdentity(this._limitPromise?function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});this._limitPromise.always(function(){a._limitPromise=null;T.call(a)})}:
T)}},onRendererChange:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||!a.observationRenderer);if(a){var b=[],a=k.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],f.isDefined);k.forEach(a,function(a){n.isFunction(a.attributeField)||b.push(a.attributeField);b.push(a.attributeField2);b.push(a.attributeField3)},this);this._rendererFields=k.filter(b,f.isDefined)}else this._rendererFields=[];this.loaded&&(this._fixRendererFields(),
this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||!a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&a.trackRenderer)},_setMap:function(a){var b=this.inherited(arguments),
c=this._mode,f=this;c&&c.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=f._selectedFeatures[a&&a[f.objectIdField]])&&a.attr("data-selected","")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);d.disconnect(this._zoomConnect);d.disconnect(this._addHandle);
this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){var a=this._mode;a&&a.refresh()},getOutFields:function(){return k.filter(this._getOutFields(),function(a){return"*"===a||!!this._getField(a)},this)},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=a,this;var b=this._editable;
this._editable=a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return b;var c=a&&a.feature;a=a&&a.userId;var f=k.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],n.trim),e=-1<k.indexOf(f,"editing"),d=e&&-1<k.indexOf(f,"create"),b=e&&-1<k.indexOf(f,"update"),f=e&&-1<k.indexOf(f,"delete"),g=this.ownershipBasedAccessControlForFeatures,p=this.editFieldsInfo,
m=p&&p.creatorField,p=p&&p.realm,c=(c=c&&c.attributes)&&m?c[m]:void 0,l=!!this.userIsAdmin,m=!g||l||!(!g.allowOthersToUpdate&&!g.allowUpdateToOthers),g=!g||l||!(!g.allowOthersToDelete&&!g.allowDeleteToOthers);if(l||e&&!d&&!b&&!f)d=b=f=!0;e={canCreate:d,canUpdate:b,canDelete:f};null===c?(e.canUpdate=b&&m,e.canDelete=f&&g):""!==c&&c&&((a=a||this.getUserId())&&p&&(a=a+"@"+p),a.toLowerCase()!==c.toLowerCase()&&(e.canUpdate=b&&m,e.canDelete=f&&g));return e},getUserId:function(){var a;this.loaded&&(a=this.credential&&
this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,b,c){c=f.isDefined(c)?c:(new Date).getTime();var e="";c=this.getEditInfo(a,b,c);(b=b&&b.callback||this.editSummaryCallback)&&(c=b(a,c)||"");if(n.isString(c))e=c;else{if(c){a=c.action;b=c.userId;var d=c.timeValue,g=0;a&&g++;b&&g++;f.isDefined(d)&&g++;1<g&&(e=("edit"===a?"edit":"create")+(b?"User":"")+(f.isDefined(d)?
c.displayPattern:""))}e=e&&f.substitute(c,this.i18n.layers.FeatureLayer[e])}return e},getEditInfo:function(a,b,c){if(this.loaded){c=f.isDefined(c)?c:(new Date).getTime();b=b&&b.action||"last";var e=this.editFieldsInfo,d=e&&e.creatorField,g=e&&e.creationDateField,p=e&&e.editorField,e=e&&e.editDateField,p=(a=a&&a.attributes)&&p?a[p]:void 0,e=a&&e?a[e]:null,d=this._getEditData(a&&d?a[d]:void 0,a&&g?a[g]:null,c);c=this._getEditData(p,e,c);var m;switch(b){case "creation":m=d;break;case "edit":m=c;break;
case "last":m=c||d}m&&(m.action=m===c?"edit":"creation");return m}},_getEditData:function(a,b,c){var e,d,g;f.isDefined(b)&&(d=c-b,g=0>d?"Full":6E4>d?"Seconds":12E4>d?"Minute":36E5>d?"Minutes":72E5>d?"Hour":864E5>d?"Hours":6048E5>d?"WeekDay":"Full");if(void 0!==a||g)e=e||{},e.userId=a,g&&(a=l.format,c=new Date(b),e.minutes=Math.floor(d/6E4),e.hours=Math.floor(d/36E5),e.weekDay=a(c,{datePattern:"EEEE",selector:"date"}),e.formattedDate=a(c,{selector:"date"}),e.formattedTime=a(c,{selector:"time"}),e.displayPattern=
g,e.timeValue=b);return e},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(a){this.isEditable()||(this._maxOffset=a);return this},getMaxAllowableOffset:function(){return this._maxOffset},setAutoGeneralize:function(a){if(this.loaded){if(!this.isEditable()&&this.currentMode!==I.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType))if(this._autoGeneralize=a){if((a=this._map)&&a.loaded)this._maxOffset=Math.floor(a.extent.getWidth()/
a.width)}else delete this._maxOffset}else this._optAutoGen=a;return this},setGDBVersion:function(a){if(!this._collection&&a!==this.gdbVersion&&(a||this.gdbVersion))this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=n.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange();return this},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},
setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=
a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,c,f){b=b||I.SELECTION_NEW;a=this._getShallowClone(a);var e=this._map,d,g=this,p=u._fixDfd(new q(u._dfdCanceller));a.outFields=this.getOutFields();a.returnGeometry=!0;e&&(a.outSpatialReference=new t(e.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return d={features:[]},this._selectHandler(d,b,c,f,p),p;if(e=this._canDoClientSideQuery(a))p._pendingDfd=v(this._doQuery(a,e)),p._pendingDfd.then(function(a){d=
{features:a};g._selectHandler(d,b,c,f,p)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,f,p,!0),p;var m=this;this._ts&&(a._ts=(new Date).getTime());(p._pendingDfd=this._task.execute(a)).addCallbacks(function(a){m._selectHandler(a,b,c,f,p)},function(a){m._resolve([a],null,f,p,!0)})}return p},getSelectedFeatures:function(){var a=this._selectedFeatures,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},clearSelection:function(a){var b=
this._selectedFeatures,c=this._mode,f;for(f in b)b.hasOwnProperty(f)&&(this._unSelectFeatureIIf(f,c),c._removeFeatureIIf(f));this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=a){var b=this._selectedFeatures,c;for(c in b)b.hasOwnProperty(c)&&b[c].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],
applyEdits:function(b,c,f,e,d,g){var p=g.assembly,m=g.dfd;this._applyNormalized(b,p&&p[0]);this._applyNormalized(c,p&&p[1]);this.onBeforeApplyEdits(b,c,f);var l={},t=this.objectIdField,p={f:"json"},u=!1;if(this._collection)g={},g.addResults=b?k.map(b,function(){u=!0;return{objectId:this._nextId++,success:!0}},this):null,g.updateResults=c?k.map(c,function(a){u=!0;var b=a.attributes[t];l[b]=a;return{objectId:b,success:!0}},this):null,g.deleteResults=f?k.map(f,function(a){u=!0;return{objectId:a.attributes[t],
success:!0}},this):null,u&&this._editHandler(g,b,l,e,d,m);else{b&&0<b.length&&(p.adds=this._convertFeaturesToJson(b,0,1),u=!0);if(c&&0<c.length){for(g=0;g<c.length;g++){var s=c[g];l[s.attributes[t]]=s}p.updates=this._convertFeaturesToJson(c,0,0,1);u=!0}if(f&&0<f.length){c=[];for(g=0;g<f.length;g++)c.push(f[g].attributes[t]);p.deletes=c.join(",");u=!0}if(u){var w=this;return a({url:this._url.path+"/applyEdits",content:n.mixin(p,this._url.query),callbackParamName:"callback",load:function(a){w._editHandler(a,
b,l,e,d,m)},error:function(a){w._resolve([a],null,d,m,!0)}},{usePost:!0})}}},queryFeatures:function(a,b,c){return this._query("execute","onQueryFeaturesComplete",a,b,c)},queryRelatedFeatures:function(a,b,c){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",a,b,c)},queryIds:function(a,b,c){return this._query("executeForIds","onQueryIdsComplete",a,b,c)},queryCount:function(a,b,c){return this._query("executeForCount","onQueryCountComplete",a,b,c)},queryExtent:function(a,
b,c){return this._query("executeForExtent","onQueryExtentComplete",a,b,c)},queryAttachmentInfos:function(c,f,e){var d=this._url.path+"/"+c+"/attachments",g=new q(u._dfdCanceller),p=this;g._pendingDfd=a({url:d,content:n.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(a){a=a.attachmentInfos;var e;k.forEach(a,function(a){e=b.objectToQuery({gdbVersion:p._url.query&&p._url.query.gdbVersion,layer:p._url.query&&p._url.query.layer,token:p._getToken()});a.url=d+"/"+a.id+(e?"?"+
e:"");a.objectId=c});p._resolve([a],"onQueryAttachmentInfosComplete",f,g)},error:function(a){p._resolve([a],null,e,g,!0)}});return g},addAttachment:function(a,b,c,f){return this._sendAttachment("add",a,b,c,f)},updateAttachment:function(a,b,f,e,d){f.appendChild(c.create("input",{type:"hidden",name:"attachmentId",value:b}));return this._sendAttachment("update",a,f,e,d)},deleteAttachments:function(b,c,f,e){var d=this._url.path+"/"+b+"/deleteAttachments",g=new q(u._dfdCanceller),p=this;c={f:"json",attachmentIds:c.join(",")};
g._pendingDfd=a({url:d,content:n.mixin(c,this._url.query),callbackParamName:"callback",load:n.hitch(this,function(a){a=a.deleteAttachmentResults;a=k.map(a,function(a){a=new H(a);a.attachmentId=a.objectId;a.objectId=b;return a});p._resolve([a],"onDeleteAttachmentsComplete",f,g)}),error:function(a){p._resolve([a],null,e,g,!0)}},{usePost:!0});return g},addType:function(a){var b=this.types;if(b){if(k.some(b,function(b){return b.id==a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=
!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var c=-1;k.some(b,function(b,f){return b.id==a?(c=f,!0):!1});if(-1<c)return this._typesDirty=!0,b.splice(c,1)[0]}}},toJson:function(){var a=this._json;if(a=n.isString(a)?r.fromJson(a):n.clone(a)){var a=a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,c=this._collection;if(c&&this._typesDirty){b.types=k.map(this.types||[],function(a){return a.toJson()});var f=this.renderer,e=b.drawingInfo;f&&!e&&(e=b.drawingInfo={});
e&&(f&&-1===f.declaredClass.indexOf("TemporalRenderer"))&&(e.renderer=f.toJson())}f=null;if(!c||this._fcAdded)f={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};a.featureSet=n.mixin({},a.featureSet||{},f);c&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},
onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(a){var b=this,c=this._url&&this._url.path;(this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&
c&&m.id&&m.id._hasPortalSession()&&m.id._doPortalSignIn(c)?m.id.getCredential(c).then(function(){b._findCredential();a.call(b)},function(){a.call(b)}):a.call(this)},_checkMode:function(a){var b=this.geometryType,c=this.maxRecordCount;a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;if(this.mode===I.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b)&&c>=this.maxRecordCountForAuto||
"esriGeometryPoint"===b&&c>=this.maxPointCountForAuto))this.currentMode=I.MODE_SNAPSHOT,this._mode=new M(this),this._isSnapshot=!0,this._autoGeneralize=!1},_queryLimit:function(){var a=this,b=new q;this._limitPromise=b.promise;setTimeout(function(){var c=new K,f=new S;f.statisticType="exceedslimit";f.maxPointCount=a.maxPointCountForAuto;f.maxRecordCount=a.maxRecordCountForAuto;f.maxVertexCount=a.maxVertexCountForAuto;f.outStatisticFieldName="exceedslimit";c.outStatistics=[f];a.queryFeatures(c).promise.then(function(a){b.resolve(a)},
function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=n.trim(this.capabilities||""),c=k.map(b?b.split(","):[],n.trim),f=k.map(b?b.toLowerCase().split(","):[],n.trim),b=k.indexOf(f,"editing"),e,f={Create:k.indexOf(f,"create"),Update:k.indexOf(f,"update"),Delete:k.indexOf(f,"delete")};if(a&&-1===b)c.push("Editing");else if(!a&&-1<b){a=[b];for(e in f)-1<f[e]&&a.push(f[e]);a.sort();for(e=a.length-1;0<=e;e--)c.splice(a[e],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},
onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);this._toggleTime(!0);this._updateMaxOffset();var b=this._mode,c=this._map,f=this._getRenderer();if(a.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo&&(this._trackIdField||f&&(f.latestObservationRenderer||f.trackRenderer)))this._trackManager=new P(this),this._trackManager.initialize(c);if(this.mode===
I.MODE_AUTO&&this.currentMode===I.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType)&&!this.getMaxAllowableOffset())f=this.generalizeForScale,f=this.maxScale?this.maxScale:this.minScale?Math.min(f,this.minScale):Math.min(f,C.getScale(c,this.initialExtent)),this.setMaxAllowableOffset(c.extent.getWidth()/c.width/c.getScale()*f);this._zoomConnect=d.connect(c,"onZoomEnd",this,this._updateMaxOffset)}b&&(a.firstOccurrence?b.startup():b.resume())},_updateMaxOffset:function(){var a=
this._map;a&&a.loaded&&this._autoGeneralize&&(this._maxOffset=Math.floor(a.extent.getWidth()/a.width))},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&this.useMapTime&&b?(this._mapTimeExtent=b.timeExtent,this._timeConnect||(this._timeConnect=d.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,d.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=
this._timeOffset,c=this._timeOffsetUnits;return a&&b&&c?a.offset(-1*b,c):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):a||b},_getTimeFilter:function(a){var b=this.getTimeDefinition(),c;if(b&&(c=this._getTimeOverlap(b,null),!c))return[!1];if(a){if(a=c?this._getTimeOverlap(a,c):a,!a)return[!1]}else a=c;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);
a.maxAllowableOffset=this._maxOffset;b&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());if(this.timeInfo){var c=this._getTimeFilter(a.timeExtent);if(c[0])a.timeExtent=c[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,c=a.attributes,f=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(f&&c&&c.hasOwnProperty(f))a[c[f]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},
_canDoClientSideQuery:function(a){var b=[],c=this._map;if(!(this._isTable||!c&&!this._collection))if(!a.text&&!(a.where&&a.where!==this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length||a.outStatistics)){var f=this._isSnapshot,e=this._isSelOnly,d=a.geometry;if(d)if(!e&&a.spatialRelationship===K.SPATIAL_REL_INTERSECTS&&"extent"===d.type&&(f||c.extent.contains(d)))b.push(1);else return;if(c=a.objectIds)if(f)b.push(2);else{var d=c.length,g=this._mode,p=0,m;for(m=0;m<d;m++)g._getFeature(c[m])&&
p++;if(p===d)b.push(2);else return}if(this.timeInfo)if(a=a.timeExtent,c=this._mapTimeExtent,f)a&&b.push(3);else if(e){if(a)return}else if(c)if(-1!==k.indexOf(b,2))a&&b.push(3);else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_doQuery:function(a,b,c){var f=[],e=this._mode,d=this.objectIdField,g=this,p,m,l=new q,t=new q,u=function(a,b){if(!a.length||!b.length)return a.length?a:b;var c,f,e={};a.length>b.length?(f=a,c=b):(f=b,c=a);for(var g=f.length,p=c.length,m;g--;)m=
f[g],e[m.attributes[d]]=!0;for(;p--;)m=c[p],e[m.attributes[d]]||f.push(m);return f};if(-1!==k.indexOf(b,1)){m=this.graphics;p=m.length;var s=this.spatialIndex||this._map&&this._map.spatialIndex,w,x=a.geometry._normalize(null,!0);null==s&&ha.autoSpatialIndexing?w=(this._map||this).addPlugin("esri/plugins/spatialIndex").then(n.hitch(this,n.partial(this._getFromIndex,x,s)),function(a){t.resolve(n.hitch(this,n.partial(this._filterByExtent,m,x)))}):s&&(w=this._getFromIndex(x,s));w?w.then(function(a){for(var b=
0;b<a.length;b++)a[b].results&&(f=f.concat(a[b].results));t.resolve(f)}).otherwise(function(a){t.reject(a)}):t.resolve(this._filterByExtent(m,x))}else t.resolve([]);t.then(function(f){var m=[];if(-1!==k.indexOf(b,2)){var t=a.objectIds;for(p=t.length;p--;){var s=e._getFeature(t[p]);s&&m.push(s)}m=u(f,m)}else m=f;-1!==k.indexOf(b,3)&&this.timeInfo&&(f=a.timeExtent,m=g._filterByTime(m,f.startTime,f.endTime).match);c&&(m=k.map(m,function(a){return a.attributes[d]},this));l.resolve(m)});return l},_getFromIndex:function(a,
b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var c=this.id;return g(k.map(a,function(a){return b.intersects(a,c)}))},_filterByExtent:function(a,b){for(var c=[],f=0,e=a.length;f<e;f++){var d=a[f],g=d.geometry;g&&(this.normalization&&b.length?(b[0].intersects(g)||b[1].intersects(g))&&c.push(d):b.intersects(g)&&c.push(d))}return c},_filterByTime:function(a,b,c){var e=this._startTimeField,d=this._endTimeField,g;this._twoTimeFields||(g=e||d);var p=f.isDefined,m=[],l=[],
t,u=a.length,s,w;b=b?b.getTime():-Infinity;c=c?c.getTime():Infinity;if(g)for(t=0;t<u;t++)s=a[t],w=s.attributes,e=w[g],e>=b&&e<=c?m.push(s):l.push(s);else for(t=0;t<u;t++)s=a[t],w=s.attributes,g=w[e],w=w[d],g=p(g)?g:-Infinity,w=p(w)?w:Infinity,g>=b&&g<=c||w>=b&&w<=c||b>=g&&c<=w?m.push(s):l.push(s);return{match:m,noMatch:l}},_resolve:function(a,b,c,f,e){b&&this[b].apply(this,a);c&&c.apply(null,a);f&&u._resDfd(f,a,e)},_getShallowClone:function(a){var b=new K,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);
return b},_query:function(a,b,c,f,e){var d=this,g=this._map,p=new q(u._dfdCanceller),m=c,l=function(c,e){if(!e&&"execute"===a&&!d._isTable){var g=c.features,m=d._mode,l=d.objectIdField,t;for(t=g.length-1;0<=t;t--){var s=m._getFeature(g[t].attributes[l]);s&&g.splice(t,1,s)}}d._resolve([c],b,f,p)};if("executeRelationshipQuery"!==a){m=this._getShallowClone(c);m.outFields=this.getOutFields();m.returnGeometry=c.hasOwnProperty("returnGeometry")?c.returnGeometry:!c.outStatistics;var s;g&&(m.outSpatialReference=
new t(g.spatialReference.toJson()));if(!this._applyQueryFilters(m,"execute"===a)){switch(a){case "execute":s=new W({features:[]});break;case "executeForIds":s=[];break;case "executeForCount":s=0;break;case "executeForExtent":s={}}l(s,!0);return p}if(c="executeForExtent"!==a&&this._canDoClientSideQuery(m))return p._pendingDfd=v(this._doQuery(m,c,"executeForIds"===a||"executeForCount"===a)),p._pendingDfd.then(function(b){switch(a){case "execute":s=new W;s.features=b;break;case "executeForIds":s=b;break;
case "executeForCount":s=b.length}l(s,!0)}),p}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,e,p,!0),p;this._ts&&(m._ts=(new Date).getTime());(p._pendingDfd=this._task[a](m)).addCallbacks(l,function(a){d._resolve([a],null,e,p,!0)});return p},_convertFeaturesToJson:function(a,b,c,f){var e=[],d=this._selectionSymbol,g=this.visibilityField,p,m=this.objectIdField;if(this.loaded&&(c||f))p=k.filter(this.fields,function(a){return!1===a.editable&&(!f||
a.name!==m)});for(c=0;c<a.length;c++){var l=a[c],t={},s=l.geometry,u=l.attributes,w=l.symbol;if(s&&(!f||!this.loaded||this.allowGeometryUpdates))t.geometry=s.toJson();g?(t.attributes=u=n.mixin({},u),u[g]=l.visible?1:0):u&&(t.attributes=n.mixin({},u));t.attributes&&(p&&p.length)&&k.forEach(p,function(a){delete t.attributes[a.name]});w&&w!==d&&(t.symbol=w.toJson());e.push(t)}return b?e:r.toJson(e)},_selectHandler:function(a,b,c,f,e){var d;f=I;switch(b){case f.SELECTION_NEW:this.clearSelection(!0);d=
!0;break;case f.SELECTION_ADD:d=!0;break;case f.SELECTION_SUBTRACT:d=!1}f=a.features;var g=this._mode,p=[],m=this.objectIdField,l,t;if(d)for(d=0;d<f.length;d++)l=f[d],t=l.attributes[m],l=g._addFeatureIIf(t,l),p.push(l),this._selectFeatureIIf(t,l,g);else for(d=0;d<f.length;d++)l=f[d],t=l.attributes[m],this._unSelectFeatureIIf(t,g),t=g._removeFeatureIIf(t),p.push(t||l);this._isSelOnly&&g._applyTimeFilter(!0);this._resolve([p,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",
c,e);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,b,c){var f=this._selectedFeatures,e=f[a];e||(c._incRefCount(a),f[a]=b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return e||b},_unSelectFeatureIIf:function(a,b){var c=this._selectedFeatures[a];c&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(c),c.attr("data-selected")));return c},_isSelected:function(a){},_setSelectSymbol:function(a){var b=
this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),a=k.filter(a,function(a,b,c){return!!a&&k.indexOf(c,a)===b}),b=n.clone(this._outFields);if(b){if(-1!==k.indexOf(b,"*"))return b;
k.forEach(a,function(a){-1===k.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=a||this._getOutFields();k.forEach(b,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+f.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!a&&(!this._isTable&&!this._fserver&&!this._collection)&&(k.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+
f.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},_fixLabelExpr:function(){var a=/\[([^\[\]]+)\]/ig,b,c=this,f=function(a,b){var f=c._getField(b,!0);return"["+(f&&f.name||b)+"]"};k.forEach(this.labelingInfo,function(c){if(b=c.labelExpression)c.labelExpression=b.replace(a,f)})},_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;
if(a&&0<this.fields.length){var b=[],c,e,a=k.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],f.isDefined),d=[].concat(a);k.forEach(a,function(a){k.forEach(a.rendererInfos,function(a){a.renderer&&d.push(a.renderer)})});k.forEach(d,function(a){if((e=a.attributeField)&&!n.isFunction(e))if(c=!this._getField(e)&&this._getField(e,!0))a.attributeField=c.name;if(e=a.attributeField2)if(c=!this._getField(e)&&this._getField(e,!0))a.attributeField2=c.name;if(e=a.attributeField3)if(c=
!this._getField(e)&&this._getField(e,!0))a.attributeField3=c.name;n.isFunction(a.attributeField)||b.push(a.attributeField);b.push(a.attributeField2);b.push(a.attributeField3);if((e=a.rotationInfo&&a.rotationInfo.field)&&!n.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=a.rotationInfo.field=c.name;b.push(e)}if(a.proportionalSymbolInfo){if((e=a.proportionalSymbolInfo.field)&&!n.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=a.proportionalSymbolInfo.field=c.name;b.push(e);
this._orderBy||(this._orderBy=[e+" DESC"])}if((e=a.proportionalSymbolInfo.normalizationField)&&!n.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=a.proportionalSymbolInfo.normalizationField=c.name;b.push(e)}}if(a.colorInfo){if((e=a.colorInfo.field)&&!n.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=a.colorInfo.field=c.name;b.push(e)}if((e=a.colorInfo.normalizationField)&&!n.isFunction(e)){if(c=!this._getField(e)&&this._getField(e,!0))e=a.colorInfo.normalizationField=
c.name;b.push(e)}}if(!this._orderBy&&a.addBreak&&!n.isFunction(a.attributeField)&&(a.backgroundFillSymbol||this._hasSizeDiff(a)))this._orderBy=[a.attributeField+" DESC"]},this);this._rendererFields=k.filter(b,f.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,c=-Number.MAX_VALUE,f,e;k.forEach(a.infos,function(a){if(e=a.symbol){f=0;switch(e.type){case "simplemarkersymbol":f=e.size;break;case "picturemarkersymbol":f=(e.width+e.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":f=
e.width;break;case "simplefillsymbol":case "picturefillsymbol":f=e.outline&&e.outline.width}f&&(b=Math.min(b,f),c=Math.max(c,f))}});return b!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&a?k.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var c=this.fields;if(!c||0===c.length)return null;var f;b&&(a=a.toLowerCase());k.some(c,
function(c){var e=!1;(e=b?c&&c.name.toLowerCase()===a?!0:!1:c&&c.name===a?!0:!1)&&(f=c);return e});return f},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:k.map(k.filter(this.fields,function(a){return!!(a&&"esriFieldTypeDate"===a.type)}),function(a){return a.name})});return this._dtOpts},_applyNormalized:function(a,b){a&&b&&k.forEach(a,function(a,c){a&&b[c]&&a.setGeometry(b[c])})},_editHandler:function(a,b,c,f,e,d){e=a.addResults;var g=a.updateResults;a=a.deleteResults;var p,m,l,
t,s=this.objectIdField,u=this._mode,w=this._isTable;p=this.editFieldsInfo;var x=this.getOutFields()||[],q=p&&p.creatorField,y=p&&p.creationDateField,v=p&&p.editorField,A=p&&p.editDateField;p=p&&p.realm;-1===k.indexOf(x,"*")&&(q&&-1===k.indexOf(x,q)&&(q=null),y&&-1===k.indexOf(x,y)&&(y=null),v&&-1===k.indexOf(x,v)&&(v=null),A&&-1===k.indexOf(x,A)&&(A=null));var x=y||A?(new Date).getTime():null,z=q||v?this.getUserId():void 0;z&&p&&(z=z+"@"+p);if(e)for(p=0;p<e.length;p++)e[p]=new H(e[p]),w||(m=e[p],
m.success&&(m=m.objectId,l=b[p],(t=l._graphicsLayer)&&t!==this&&t.remove(l),t=l.attributes||{},t[s]=m,q&&(t[q]=z),v&&(t[v]=z),y&&(t[y]=x),A&&(t[A]=x),l.setAttributes(t),u._init&&u.drawFeature(l)));if(g)for(p=0;p<g.length;p++)if(g[p]=new H(g[p]),!w&&(m=g[p],m.success)){m=m.objectId;l=c[m];if(b=u._getFeature(m))b.geometry!==l.geometry&&b.setGeometry(T.fromJson(l.geometry.toJson())),this._repaint(b,m);l=b||l;t=l.attributes||{};v&&(t[v]=z);A&&(t[A]=x);l.setAttributes(t)}if(a){c=[];for(p=0;p<a.length;p++)if(a[p]=
new H(a[p]),!w&&(m=a[p],m.success&&(m=m.objectId,l=u._getFeature(m))))this._unSelectFeatureIIf(m,u)&&c.push(l),l._count=0,u._removeFeatureIIf(m);if(0<c.length)this.onSelectionComplete(c,I.SELECTION_SUBTRACT)}this._resolve([e,g,a],"onEditsComplete",f,d)},_sendAttachment:function(b,c,f,e,d){var g=this;return a({url:this._url.path+"/"+c+"/"+("add"===b?"addAttachment":"updateAttachment"),form:f,content:n.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",
handleAs:"json"}).addCallback(function(a){var f="add"===b?"onAddAttachmentComplete":"onUpdateAttachmentComplete";a=new H(a["add"===b?"addAttachmentResult":"updateAttachmentResult"]);a.attachmentId=a.objectId;a.objectId=c;g._resolve([a],f,e);return a}).addErrback(function(a){g._resolve([a],null,d,null,!0)})},_repaint:function(a,b,c){b=f.isDefined(b)?b:a.attributes[this.objectIdField];(!(b in this._selectedFeatures)||!this._selectionSymbol)&&a.setSymbol(a.symbol,c)},_getKind:function(a){var b=this._trackManager;
return b?b.isLatestObservation(a)?1:0:0}});n.mixin(I,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});ga._createWrappers(I);e("extend-esri")&&n.setObject("layers.FeatureLayer",I,m);return I})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/geometry/jsonUtils esri/tasks/FeatureSet".split(" "),
function(h,d,n,k,r,q){h=h(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(d){d.catalogItems&&(this.catalogItems=new q(d.catalogItems));d.location&&(this.location=r.fromJson(d.location));this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.properties=d.properties}});n("extend-esri")&&d.setObject("tasks.ImageServiceIdentifyResult",h,k);return h})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred esri/kernel esri/urlUtils esri/SpatialReference esri/layers/TileInfo esri/layers/TiledMapServiceLayer esri/geometry/Extent esri/request".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f){h=h(g,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(a){try{a=d.mixin({bingMapsKey:null,culture:"en-US"},a||{});var b=window.location.protocol;"file:"===b&&(b="http:");this.url=b+"//dev.virtualearth.net/REST/v1";this._url=c.urlToObject(this.url);this.spatialReference=new s({wkid:102100});this.tileInfo=new v({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=this.fullExtent=new m(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new s({wkid:102100}));d.mixin(this,a);this.hasAttributionData=this.showAttribution;this._initLayer=d.hitch(this,this._initLayer);this._errorHandler=d.hitch(this,this._errorHandler);this._getTileInfo=d.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(f){throw this.onError(f),f;}},_unsetMap:function(a,b){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var a=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var b=this.resourceInfo;!this.loaded&&b?this._initLayer(b):f({url:a,content:d.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(a,
b){if(200!==a.statusCode){var c=Error();c.code=a.statusCode;c.message=a.statusDescription;c.details=a.errorDetails;c.authenticationResultCode=a.authenticationResultCode;this.onError(c)}else try{this.resourceInfo=n.toJson(a);var c=a.resourceSets[0].resources[0],f=c.imageUrl.replace("{","${");this.tileServers=k.map(c.imageUrlSubdomains,function(a){var b=window.location.protocol;"file:"===b&&(b="http:");return l.substitute(f,{subdomain:a}).replace("http:",b)});this._tsLength=this.tileServers.length;
if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var e=this.loadCallback;e&&(delete this.loadCallback,e(this))}}catch(d){this.onError(d)}},getAttributionData:function(){var a=new e,b=n.fromJson(this.resourceInfo),c;this.hasAttributionData&&b&&(c=d.getObject("resourceSets.0.resources.0.imageryProviders",!1,b));c?a.callback({contributors:c}):(b=Error("Layer does not have attribution data"),
b.log=r.isDebug,a.errback(b));return a},getTileUrl:function(a,b,c){return l.substitute(this.tileServers[b%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(a,b,c),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(a,b,c){var f="",e,d;for(d=a;0<d;d--)a="0",e=1<<d-1,0!=(c&e)&&a++,0!=(b&e)&&(a++,a++),f+=a;return f},setMapStyle:function(a){this.mapStyle=a;this._getTileInfo()},setCulture:function(a){this.culture=a;this._getTileInfo()},setBingMapsKey:function(a){this.bingMapsKey=
a},onMapStyleChange:function(){}});d.mixin(h,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});q("extend-esri")&&d.setObject("virtualearth.VETiledLayer",h,b);return h})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(h,d,n,k,r,q,l,e,b,c){function s(b,c,f){return a&&f?function(a,b){return q(a,f,b)}:m?function(a,f){var e=q(a,c,f),d=q(a,b,function(a){(!B||
(new Date).getTime()>B+1E3)&&f.call(this,a)});return{remove:function(){e.remove();d.remove()}}}:function(a,c){return q(a,b,c)}}function v(a){do if(a.dojoClick)return a.dojoClick;while(a=a.parentNode)}function g(a,b,f){if(u=!a.target.disabled&&v(a.target))t=a.target,z=a.touches?a.touches[0].pageX:a.clientX,x=a.touches?a.touches[0].pageY:a.clientY,y=("object"==typeof u?u.x:"number"==typeof u?u:0)||4,w=("object"==typeof u?u.y:"number"==typeof u?u:0)||4,p||(p=!0,c.doc.addEventListener(b,function(a){u=
u&&a.target==t&&Math.abs((a.touches?a.touches[0].pageX:a.clientX)-z)<=y&&Math.abs((a.touches?a.touches[0].pageY:a.clientY)-x)<=w},!0),c.doc.addEventListener(f,function(a){if(u){A=(new Date).getTime();var b=a.target;"LABEL"===b.tagName&&(b=n.byId(b.getAttribute("for"))||b);setTimeout(function(){q.emit(b,"click",{bubbles:!0,cancelable:!0,_dojo_click:!0})})}},!0),a=function(a){c.doc.addEventListener(a,function(b){!b._dojo_click&&((new Date).getTime()<=A+1E3&&!("INPUT"==b.target.tagName&&k.contains(b.target,
"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"==a&&(("INPUT"!=b.target.tagName||"radio"==b.target.type||"checkbox"==b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&b.preventDefault())},!0)},a("click"),a("mousedown"),a("mouseup"))}var m=l("touch"),f=5>l("ios"),a=navigator.msPointerEnabled,p,u,t,z,x,y,w,A,B,G;m&&(a?b(function(){c.doc.addEventListener("MSPointerDown",function(a){g(a,"MSPointerMove",
"MSPointerUp")},!0)}):b(function(){function a(b){var c=r.delegate(b,{bubbles:!0});6<=l("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}G=c.body();c.doc.addEventListener("touchstart",function(a){B=(new Date).getTime();var b=G;G=a.target;q.emit(b,"dojotouchout",{relatedTarget:G,bubbles:!0});q.emit(G,"dojotouchover",{relatedTarget:b,bubbles:!0});g(a,"touchmove","touchend")},
!0);q(c.doc,"touchmove",function(b){B=(new Date).getTime();var e=c.doc.elementFromPoint(b.pageX-(f?0:c.global.pageXOffset),b.pageY-(f?0:c.global.pageYOffset));e&&(G!==e&&(q.emit(G,"dojotouchout",{relatedTarget:e,bubbles:!0}),q.emit(e,"dojotouchover",{relatedTarget:G,bubbles:!0}),G=e),q.emit(e,"dojotouchmove",a(b)))});q(c.doc,"touchend",function(b){B=(new Date).getTime();var e=c.doc.elementFromPoint(b.pageX-(f?0:c.global.pageXOffset),b.pageY-(f?0:c.global.pageYOffset))||c.body();q.emit(e,"dojotouchend",
a(b))})}));d={press:s("mousedown","touchstart","MSPointerDown"),move:s("mousemove","dojotouchmove","MSPointerMove"),release:s("mouseup","dojotouchend","MSPointerUp"),cancel:s(e.leave,"touchcancel",m?"MSPointerCancel":null),over:s("mouseover","dojotouchover","MSPointerOver"),out:s("mouseout","dojotouchout","MSPointerOut"),enter:e._eventHandler(s("mouseover","dojotouchover","MSPointerOver")),leave:e._eventHandler(s("mouseout","dojotouchout","MSPointerOut"))};return h.touch=d})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(h,d,n,k,r){h=h(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(d){d&&(this.name=d.name,this.title=d.title,this.description=d.description,this.extent=d.extent,this.legendURL=d.legendURL,this.subLayers=d.subLayers?d.subLayers:[],this.allExtents=d.allExtents?d.allExtents:[],this.spatialReferences=d.spatialReferences?
d.spatialReferences:[])},clone:function(){var d={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},l;this.extent&&(d.extent=this.extent.getExtent());d.subLayers=[];n.forEach(this.subLayers,function(e){d.subLayers.push(e.clone())});d.allExtents=[];for(l in this.allExtents)l=parseInt(l,10),isNaN(l)||(d.allExtents[l]=this.allExtents[l].getExtent());d.spatialReferences=[];n.forEach(this.spatialReferences,function(e){d.spatialReferences.push(e)});return d}});k("extend-esri")&&
d.setObject("layers.WMSLayerInfo",h,r);return h})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(h,d,n,k,r){return n("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,_beforeFillContent:function(){if(this.widgetsInTemplate){var d=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);r.parse(d,{noStart:!this._earlyTemplatedStartup,
template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(k.hitch(this,function(d){this._startupWidgets=d;for(var e=0;e<d.length;e++)this._processTemplateNode(d[e],function(b,c){return b[c]},function(b,c,e){return c in b?b.connect(b,c,e):b.on(c,e,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(d,l,e){return l(d,"dojoType")||l(d,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){h.forEach(this._startupWidgets,function(d){d&&(!d._started&&d.startup)&&d.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(h,d,n,k,r){h=h(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(k){d.mixin(this,
k);r.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});n("extend-esri")&&d.setObject("layers.KMLFolder",h,k);return h})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script esri/kernel".split(" "),function(h,d,n,k,r,q,l){d=d(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(h._scopeName||"dojo")+"IoScript"},initialize:function(e){this.map=e;this._init=!0},startup:function(){},
propertyChangeHandler:function(e){},destroy:function(){this._init=!1},drawFeature:function(e){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(e){(e=this._featureMap[e])&&e._count++},_decRefCount:function(e){(e=this._featureMap[e])&&e._count--},_getFeature:function(e){return this._featureMap[e]},_addFeatureIIf:function(e,b){var c=this._featureMap,d=c[e],l=this.featureLayer;d||(c[e]=b,l._add(b),b._count=0);return d||b},_removeFeatureIIf:function(e){var b=this._featureMap[e],
c=this.featureLayer;if(b){if(b._count)return;delete this._featureMap[e];c._remove(b)}return b},_clearIIf:function(){var e;e=this.featureLayer;var b=e.graphics,c=e._selectedFeatures,d=e.objectIdField;for(e=b.length-1;0<=e;e--){var l=b[e],g=l.attributes[d];g in c?l._count=1:(l._count=0,this._removeFeatureIIf(g))}},_isPending:function(e){return q[this._prefix+e]?!0:!1},_cancelPendingRequest:function(e,b){if(e=e||q[this._prefix+b])try{e.cancel(),q._validCheck(e)}catch(c){}},_purgeRequests:function(){q._validCheck(null)},
_toggleVisibility:function(e){var b=this.featureLayer,c=b.graphics,d=e?"show":"hide",l,g=c.length;e=e&&b._ager;for(l=0;l<g;l++){var m=c[l];m[d]();e&&b._repaint(m)}},_applyTimeFilter:function(e){var b=this.featureLayer;if(b.timeInfo&&!b.suspended){e||b._fireUpdateStart();var c=b._trackManager;c&&c.clearTracks();var d=b.getTimeDefinition(),l=b._getOffsettedTE(b._mapTimeExtent);l?(l=b._getTimeOverlap(d,l))?(d=b._filterByTime(b.graphics,l.startTime,l.endTime),c&&c.addFeatures(d.match),k.forEach(d.match,
function(c){var e=c._shape;c.visible||(c.show(),(e=c._shape)&&e._moveToFront());b._ager&&e&&b._repaint(c)}),k.forEach(d.noMatch,function(b){b.visible&&b.hide()})):this._toggleVisibility(!1):(c&&c.addFeatures(b.graphics),this._toggleVisibility(!0));c&&(c.moveLatestToFront(),c.drawTracks());e||b._fireUpdateEnd()}}});r("extend-esri")&&n.setObject("layers._RenderMode",d,l);return d})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/lang esri/symbols/jsonUtils esri/layers/RangeDomain esri/layers/CodedValueDomain esri/layers/InheritedDomain esri/layers/FeatureTemplate".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s){h=h(null,{declaredClass:"esri.layers.FeatureType",constructor:function(k){if(k&&d.isObject(k)){this.id=k.id;this.name=k.name;var g=k.symbol;g&&(this.symbol=l.fromJson(g));var g=k.domains,m,f=this.domains={};for(m in g)if(g.hasOwnProperty(m)){var a=g[m];switch(a.type){case "range":f[m]=new e(a);break;case "codedValue":f[m]=new b(a);break;case "inherited":f[m]=new c(a)}}if(m=k.templates){g=this.templates=[];for(k=0;k<m.length;k++)g.push(new s(m[k]))}}},toJson:function(){var b=
{id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,e=this.domains,f=this.templates,a=q.fixJson;if(e){var d=b.domains={};for(c in e)e.hasOwnProperty(c)&&(d[c]=e[c]&&e[c].toJson());a(d)}f&&(b.templates=n.map(f,function(a){return a.toJson()}));return a(b)}});k("extend-esri")&&d.setObject("layers.FeatureType",h,r);return h})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/graphic esri/geometry/Polyline esri/layers/GraphicsLayer".split(" "),
function(h,d,n,k,r,q,l,e){h=h(null,{declaredClass:"esri.layers._TrackManager",constructor:function(b){this.layer=b;this.trackMap={}},initialize:function(b){this.map=b;var c=this.layer,d=c._getRenderer(),d=d&&d.trackRenderer;if("esriGeometryPoint"===c.geometryType){var l=this.container=new e._GraphicsLayer({id:c.id+"_tracks",_child:!0});l.loaded=!0;l.onLoad(l);l._setMap(b,c._div);l.setRenderer(d)}},addFeatures:function(b){var c,e=this.trackMap,d=this.layer,g=d._trackIdField,m,f;n.forEach(b,function(a){m=
a.attributes;c=m[g];f=e[c]=e[c]||[];f.push(a)});var a=d._startTimeField,p=d.objectIdField;b=function(b,c){var f=b.attributes[a],e=c.attributes[a];return f===e?b.attributes[p]<c.attributes[p]?-1:1:f<e?-1:1};for(c in e)e[c].sort(b)},drawTracks:function(){var b=this.container;if(b){var c=this.trackMap,e=this.map.spatialReference,d,g,m,f,a,p=this.layer._trackIdField;for(d in c){g=c[d];m=[];for(f=g.length-1;0<=f;f--)(a=g[f].geometry)&&m.push([a.x,a.y]);g={};g[p]=d;0<m.length&&b.add(new q(new l({paths:[m],
spatialReference:e}),null,g))}}},moveLatestToFront:function(){n.forEach(this.getLatestObservations(),function(b){var c=b._shape;c&&c._moveToFront();this._repaint(b,null,!0)},this.layer)},getLatestObservations:function(){var b=[],c=this.layer._getRenderer(),e=this.trackMap,d;if(!c.latestObservationRenderer)return b;for(d in e)c=e[d],b.push(c[c.length-1]);return b},clearTracks:function(){var b=this.getLatestObservations();this.trackMap={};var c=this.container;c&&c.clear();n.forEach(b,function(b){this._repaint(b,
null,!0)},this.layer)},isLatestObservation:function(b){var c=this.trackMap[b.attributes[this.layer._trackIdField]];return c?c[c.length-1]===b:!1},destroy:function(){var b=this.container;b&&(b.clear(),b._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});k("extend-esri")&&d.setObject("layers._TrackManager",h,r);return h})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/SpatialReference esri/geometry/Extent esri/geometry/Polyline".split(" "),
function(h,d,n,k,r,q,l,e){h=h(null,{declaredClass:"esri.layers._GridLayout",constructor:function(b,c,e,d){this.origin=b;this.cellWidth=c.width;this.cellHeight=c.height;this.mapWidth=e.width;this.mapHeight=e.height;this.srInfo=d},setResolution:function(b){this._resolution=(b.xmax-b.xmin)/this.mapWidth;this.srInfo&&(b=Math.round(2*this.srInfo.valid[1]/this._resolution),b=Math.round(b/this.cellWidth),this._frameStats=[b,0,b-1])},getCellCoordinates:function(b){var c=this._resolution,e=this.origin;return{row:Math.floor((e.y-
b.y)/(this.cellHeight*c)),col:Math.floor((b.x-e.x)/(this.cellWidth*c))}},normalize:function(b){var c=this._frameStats;if(c){var e=c[0],d=c[1],c=c[2];b<d?(b%=e,b=b<d?b+e:b):b>c&&(b%=e)}return b},intersects:function(b,c){var e=this.srInfo;return e?n.some(c._getParts(e),function(c){return b.intersects(c.extent)}):b.intersects(c)},getCellExtent:function(b,c){var e=this._resolution,d=this.origin,g=this.cellWidth,m=this.cellHeight;return new l(c*g*e+d.x,d.y-(b+1)*m*e,(c+1)*g*e+d.x,d.y-b*m*e,new q(d.spatialReference.toJson()))},
getLatticeID:function(b){var c=this.getCellCoordinates({x:b.xmin,y:b.ymax}),e=this.getCellCoordinates({x:b.xmax,y:b.ymin});b=c.row;var d=e.row,c=this.normalize(c.col),e=this.normalize(e.col);return b+"_"+d+"_"+c+"_"+e},sorter:function(b,c){return b<c?-1:1},getCellsInExtent:function(b,c){var d=this.getCellCoordinates({x:b.xmin,y:b.ymax}),l=this.getCellCoordinates({x:b.xmax,y:b.ymin}),g=d.row,m=l.row,d=d.col,l=l.col,f=[],a,p,u,t=[],k=[],x,y,w,A=[];for(a=g;a<=m;a++)for(p=d;p<=l;p++)u=this.normalize(p),
b=this.getCellExtent(a,u),f.push({row:a,col:u,extent:b,resolution:this._resolution}),c&&(t.push(b.xmin,b.xmax),k.push(b.ymin,b.ymax));d=this.normalize(d);l=this.normalize(l);t.sort(this.sorter);k.sort(this.sorter);p=t.length;for(a=p-1;0<=a;a--)a<p-1&&t[a]===t[a+1]&&t.splice(a,1);p=k.length;for(a=p-1;0<=a;a--)a<p-1&&k[a]===k[a+1]&&k.splice(a,1);if(t.length&&k.length){u=t[0];x=t[t.length-1];y=k[0];w=k[k.length-1];p=t.length;for(a=0;a<p;a++)A.push([[t[a],w],[t[a],y]]);p=k.length;for(a=0;a<p;a++)A.push([[u,
k[a]],[x,k[a]]]);a=new e({paths:A,spatialReference:this.origin.spatialReference.toJson()});f.push({latticeID:g+"_"+m+"_"+d+"_"+l,lattice:a,resolution:this._resolution})}return{minRow:g,maxRow:m,minCol:d,maxCol:l,cells:f}}});k("extend-esri")&&d.setObject("layers._GridLayout",h,r);return h})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(h,d,n){var k={};h.setObject("dojo.data.util.simpleFetch",k);k.errorHandler=function(k,h){h.onError&&
h.onError.call(h.scope||d.global,k,h)};k.fetchHandler=function(k,h){var l=h.abort||null,e=!1,b=h.start?h.start:0,c=h.count&&Infinity!==h.count?b+h.count:k.length;h.abort=function(){e=!0;l&&l.call(h)};var s=h.scope||d.global;h.store||(h.store=this);h.onBegin&&h.onBegin.call(s,k.length,h);h.sort&&k.sort(n.createSortFunction(h.sort,this));if(h.onItem)for(var v=b;v<k.length&&v<c;++v){var g=k[v];e||h.onItem.call(s,g,h)}h.onComplete&&!e&&(v=null,h.onItem||(v=k.slice(b,c)),h.onComplete.call(s,v,h))};k.fetch=
function(d){d=d||{};d.store||(d.store=this);this._fetchItems(d,h.hitch(this,"fetchHandler"),h.hitch(this,"errorHandler"));return d};return k})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(h,d,n,k,r,q){d=d("dojox.data.CsvStore",null,{constructor:function(d){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=
!1;d.url&&(this.url=d.url);this._csvData=d.data;d.label?this.label=d.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=d.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in d&&(this.separator=d.separator);"urlPreventCache"in d&&(this.urlPreventCache=d.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",
separator:",",urlPreventCache:!1,_assertIsItem:function(d){if(!this.isItem(d))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(d){d=this.getIdentity(d);this.identifier&&(d=this._idMap[d]);return d},getValue:function(d,e,b){this._assertIsItem(d);var c=b;if("string"===typeof e)e=this._attributeIndexes[e],null!=e&&(c=this._dataArray[this._getIndex(d)][e]||b);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
return c},getValues:function(d,e){var b=this.getValue(d,e);return b?[b]:[]},getAttributes:function(d){this._assertIsItem(d);var e=[];d=this._dataArray[this._getIndex(d)];for(var b=0;b<d.length;b++)""!==d[b]&&e.push(this._attributes[b]);return e},hasAttribute:function(d,e){this._assertIsItem(d);if("string"===typeof e){var b=this._attributeIndexes[e],c=this._dataArray[this._getIndex(d)];return"undefined"!==typeof b&&b<c.length&&""!==c[b]}throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
},containsValue:function(d,e,b){var c=void 0;"string"===typeof b&&(c=r.patternToRegExp(b,!1));return this._containsValue(d,e,b,c)},_containsValue:function(d,e,b,c){d=this.getValues(d,e);for(e=0;e<d.length;++e){var k=d[e];if("string"===typeof k&&c)return null!==k.match(c);if(b===k)return!0}return!1},isItem:function(d){if(d&&d[this._storeProp]===this)if(d=d[this._idProp],this.identifier){if(this._dataArray[this._idMap[d]])return!0}else if(0<=d&&d<this._dataArray.length)return!0;return!1},isItemLoaded:function(d){return this.isItem(d)},
loadItem:function(d){},getFeatures:function(){return this._features},getLabel:function(d){if(this.label&&this.isItem(d))return this.getValue(d,this.label)},getLabelAttributes:function(d){return this.label?[this.label]:null},_fetchItems:function(d,e,b){var c=this,k=function(a,b){var f=null;if(a.query){var d,g,f=[],m=a.queryOptions?a.queryOptions.ignoreCase:!1,l={};for(d in a.query)g=a.query[d],"string"===typeof g&&(l[d]=r.patternToRegExp(g,m));for(m=0;m<b.length;++m){var k=!0,h=b[m];for(d in a.query)g=
a.query[d],c._containsValue(h,d,g,l[d])||(k=!1);k&&f.push(h)}}else f=b.slice(0,b.length);e(f,a)};if(this._loadFinished)k(d,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:d,filter:k});else{this._loadInProgress=!0;var h=n.get({url:c.url,handleAs:"text",preventCache:c.urlPreventCache});h.addCallback(function(a){try{c._processData(a),k(d,c._arrayOfAllItems),c._handleQueuedFetches()}catch(f){b(f,d)}});h.addErrback(function(a){c._loadInProgress=!1;if(b)b(a,
d);else throw a;});var g=null;d.abort&&(g=d.abort);d.abort=function(){h&&-1===h.fired&&h.cancel();g&&g.call(d)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,k(d,this._arrayOfAllItems)}catch(m){b(m,d)}else{var f=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(b)b(f,d);else throw f;}},close:function(d){},_getArrayOfArraysFromCsvFileContents:function(d){if(h.isString(d)){var e=RegExp("^\\s+","g"),b=RegExp("\\s+$","g"),
c=RegExp('""',"g"),k=[],n=this._splitLines(d);for(d=0;d<n.length;++d){var g=n[d];if(0<g.length){for(var g=g.split(this.separator),m=0;m<g.length;){var f=g[m].replace(e,""),a=f.replace(b,""),p=a.charAt(0),u=a.charAt(a.length-1),t=a.charAt(a.length-2),z=a.charAt(a.length-3);if(2===a.length&&'""'==a)g[m]="";else if('"'==p&&('"'!=u||'"'==u&&'"'==t&&'"'!=z)){if(m+1===g.length)return;g[m]=f+this.separator+g[m+1];g.splice(m+1,1)}else'"'==p&&'"'==u&&(a=a.slice(1,a.length-1),a=a.replace(c,'"')),g[m]=a,m+=
1}k.push(g)}}this._attributes=k.shift();for(d=0;d<this._attributes.length;d++)this._attributeIndexes[this._attributes[d]]=d;this._dataArray=k}},_splitLines:function(d){var e=[],b,c="",k=!1;for(b=0;b<d.length;b++){var h=d.charAt(b);switch(h){case '"':k=!k;c+=h;break;case "\r":k?c+=h:(e.push(c),c="",b<d.length-1&&"\n"==d.charAt(b+1)&&b++);break;case "\n":k?c+=h:(e.push(c),c="");break;default:c+=h}}""!==c&&e.push(c);return e},_processData:function(d){this._getArrayOfArraysFromCsvFileContents(d);this._arrayOfAllItems=
[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(d=0;d<this._dataArray.length;d++){var e=d;this.identifier&&(e=this._dataArray[d][this._attributeIndexes[this.identifier]],this._idMap[e]=d);this._arrayOfAllItems.push(this._createItemFromIdentity(e))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(d){var e={};e[this._storeProp]=this;e[this._idProp]=
d;return e},getIdentity:function(d){return this.isItem(d)?d[this._idProp]:null},fetchItemByIdentity:function(d){var e,b=d.scope?d.scope:k.global;if(this._loadFinished)e=this._createItemFromIdentity(d.identity),this.isItem(e)||(e=null),d.onItem&&d.onItem.call(b,e);else{var c=this;if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:d}):(this._loadInProgress=!0,e=n.get({url:c.url,handleAs:"text"}),e.addCallback(function(e){try{c._processData(e);var g=c._createItemFromIdentity(d.identity);
c.isItem(g)||(g=null);d.onItem&&d.onItem.call(b,g);c._handleQueuedFetches()}catch(m){d.onError&&d.onError.call(b,m)}}),e.addErrback(function(c){this._loadInProgress=!1;d.onError&&d.onError.call(b,c)}));else if(this._csvData)try{c._processData(c._csvData),c._csvData=null,e=c._createItemFromIdentity(d.identity),c.isItem(e)||(e=null),d.onItem&&d.onItem.call(b,e)}catch(h){d.onError&&d.onError.call(b,h)}}},getIdentityAttributes:function(d){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<
this._queuedFetches.length){for(var d=0;d<this._queuedFetches.length;d++){var e=this._queuedFetches[d],b=e.filter,c=e.args;b?b(c,this._arrayOfAllItems):this.fetchItemByIdentity(e.args)}this._queuedFetches=[]}}});h.extend(d,q);return d})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(h,d,n,k,r){h=h(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,
outputPixelType:null,constructor:function(k){d.isObject(k)&&(d.mixin(this,k),k.rasterFunction&&(this.functionName=k.rasterFunction),k.rasterFunctionArguments?this.functionArguments=k.rasterFunctionArguments:k.arguments&&(this.functionArguments=k.arguments))},toJson:function(){return r.filter({rasterFunction:this.functionName,rasterFunctionArguments:this.functionArguments||this.arguments,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(d){if(null!==
d&&void 0!==d)return!0})}});n("extend-esri")&&d.setObject("layers.RasterFunction",h,k);return h})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(h,d){var n={};h.setObject("dojo.date.stamp",n);n.fromISOString=function(k,h){n._isoRegExp||(n._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var q=n._isoRegExp.exec(k),l=null;if(q){q.shift();q[1]&&q[1]--;q[6]&&(q[6]*=1E3);h&&(h=new Date(h),d.forEach(d.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),
function(b){return h["get"+b]()}),function(b,d){q[d]=q[d]||b}));l=new Date(q[0]||1970,q[1]||0,q[2]||1,q[3]||0,q[4]||0,q[5]||0,q[6]||0);100>q[0]&&l.setFullYear(q[0]||1970);var e=0,b=q[7]&&q[7].charAt(0);"Z"!=b&&(e=60*(q[8]||0)+(Number(q[9])||0),"-"!=b&&(e*=-1));b&&(e-=l.getTimezoneOffset());e&&l.setTime(l.getTime()+6E4*e)}return l};n.toISOString=function(d,h){var n=function(b){return 10>b?"0"+b:b};h=h||{};var l=[],e=h.zulu?"getUTC":"get",b="";"time"!=h.selector&&(b=d[e+"FullYear"](),b=["0000".substr((b+
"").length)+b,n(d[e+"Month"]()+1),n(d[e+"Date"]())].join("-"));l.push(b);if("date"!=h.selector){b=[n(d[e+"Hours"]()),n(d[e+"Minutes"]()),n(d[e+"Seconds"]())].join(":");e=d[e+"Milliseconds"]();h.milliseconds&&(b+="."+(100>e?"0":"")+n(e));if(h.zulu)b+="Z";else if("time"!=h.selector)var e=d.getTimezoneOffset(),c=Math.abs(e),b=b+((0<e?"-":"+")+n(Math.floor(c/60))+":"+n(c%60));l.push(b)}return l.join("T")};return n})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),
function(h,d,n,k,r,q,l){q.extend(h,{waiRole:"",waiState:""});return r("dijit._Templated",[d,n],{widgetsInTemplate:!1,constructor:function(){l.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(d,b){var c=this.inherited(arguments),h=b(d,"waiRole");h&&d.setAttribute("role",h);(h=b(d,"waiState"))&&k.forEach(h.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),d.setAttribute("aria-"+
b[0],b[1]))});return c}})})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated esri/kernel esri/dijit/_EventedWidget dojo/i18n!esri/nls/jsapi dojo/NodeList-dom".split(" "),function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a,p,u){var t=0;d=d([p,m,f],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=
k.mixin({},u.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);var a=this.template,d=this.graphic,f=a.getComponents(d),e=this.showTitle?f.title:"",g=f.description,p=f.fields,m=f.mediaInfos,t=this.domNode,h=this._nls;this._prevMedia.title=h.NLS_prevMedia;this._nextMedia.title=h.NLS_nextMedia;c.set(this._title,"innerHTML",e);e||s.add(this._title,"hidden");!g&&p&&(g="",r.forEach(p,function(a){g+="\x3ctr valign\x3d'top'\x3e";g+="\x3ctd class\x3d'attrName'\x3e"+a[0]+"\x3c/td\x3e";g+="\x3ctd class\x3d'attrValue'\x3e"+
a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+h.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";g+="\x3c/tr\x3e"}),g&&(g="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+g+"\x3c/table\x3e"));c.set(this._description,"innerHTML",g);g||s.add(this._description,"hidden");q.query("a",this._description).forEach(function(a){c.set(a,"target","_blank")});e&&g?q.query(".mainSection .hzLine",t).removeClass("hidden"):e||g?q.query(".mainSection .hzLine",
t).addClass("hidden"):q.query(".mainSection",t).addClass("hidden");if(a=this._dfd=a.getAttachments(d))a.addBoth(k.hitch(this,this._attListHandler,a)),c.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+h.NLS_searching+"...\x3c/li\x3e"),q.query(".attachmentsSection",t).removeClass("hidden");m&&m.length&&(q.query(".mediaSection",t).removeClass("hidden"),b.setSelectable(this._mediaFrame,!1),this._mediaInfos=m,this._mediaPtr=0,this._updateUI(),this._displayMedia());f.editSummary&&(c.set(this._editSummary,
"innerHTML",f.editSummary),m&&m.length&&s.remove(this._mediaBreak,"hidden"),s.remove(this._editSummarySection,"hidden"))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),
this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,b=a.length,d=this.domNode,f=this._prevMedia,e=this._nextMedia;if(1<b){var g=0,p=0;r.forEach(a,function(a){"image"===a.type?g++:-1!==a.type.indexOf("chart")&&p++});g&&(c.set(this._imageCount,"innerHTML",g),q.query(".summary .image",d).removeClass("hidden"));p&&(c.set(this._chartCount,"innerHTML",p),q.query(".summary .chart",d).removeClass("hidden"))}else q.query(".summary",d).addClass("hidden"),s.add(f,"hidden"),s.add(e,"hidden");a=
this._mediaPtr;0===a?s.add(f,"hidden"):s.remove(f,"hidden");a===b-1?s.add(e,"hidden"):s.remove(e,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],b=a.title,d=a.caption,f=q.query(".mediaSection .hzLine",this.domNode)[0];c.set(this._mediaTitle,"innerHTML",b);s[b?"remove":"add"](this._mediaTitle,"hidden");c.set(this._mediaCaption,"innerHTML",d);s[d?"remove":"add"](this._mediaCaption,"hidden");s[b&&d?"remove":"add"](f,"hidden");this._rid=null;if("image"===
a.type)this._showImage(a.value);else{var e=this,b=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],d=a.value.theme||this.chartTheme||"esri/dijit/Rainbow";k.isString(d)&&(d=d.replace(/\./gi,"/"),-1===d.indexOf("/")&&(d="dojox/charting/themes/"+d),b.push(d));try{var g=this._rid=t++;h(b,function(b,c,d){g===e._rid&&(e._rid=null,e._showChart(a.type,a.value,b,c,d))})}catch(p){console.log("PopupRenderer: error loading modules")}}},_showImage:function(a){s.add(this._mediaFrame,"image");var b=
g.get(this._gallery,"height"),d="\x3cimg class\x3d'esriPopupMediaImage' src\x3d'"+a.sourceURL+"' /\x3e";a.linkURL&&(d="\x3ca target\x3d'_blank' href\x3d'"+a.linkURL+"'\x3e"+d+"\x3c/a\x3e");c.set(this._mediaFrame,"innerHTML",d);var f=q.query(".esriPopupMediaImage",this._mediaFrame)[0],e=this,p;p=n.connect(f,"onload",function(){n.disconnect(p);p=null;e._imageLoaded(f,b)})},_showChart:function(a,b,c,d,f){s.remove(this._mediaFrame,"image");c=this._chart=new c(v.create("div",{"class":"chart"},this._mediaFrame),
{margins:{l:4,t:4,r:4,b:4}});f&&c.setTheme(f);switch(a){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",b.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});r.forEach(b.fields,function(a,b){a.x=b+1});c.addSeries("Series A",b.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",gap:3});c.addAxis("y",
{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",b.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",b.fields)}this._action=new d(c);c.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=
null);c.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),g.set(a,"marginTop",c+"px"))},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var d="";!(b instanceof Error)&&(b&&b.length)&&r.forEach(b,function(a){d+="\x3cli\x3e";d+="\x3ca href\x3d'"+a.url+"' target\x3d'_blank'\x3e"+(a.name||"[No name]")+"\x3c/a\x3e";d+="\x3c/li\x3e"});c.set(this._attachmentsList,"innerHTML",d||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}}});
l("extend-esri")&&k.setObject("dijit._PopupRenderer",d,a);return d})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(h){var d={};h.setObject("dojo.data.util.sorter",d);d.basicComparator=function(d,k){var h=-1;null===d&&(d=void 0);null===k&&(k=void 0);if(d==k)h=0;else if(d>k||null==d)h=1;return h};d.createSortFunction=function(h,k){function r(b,c,d,a){return function(e,k){var t=a.getValue(e,b),h=a.getValue(k,b);return c*d(t,h)}}for(var q=[],l,e=k.comparatorMap,b=d.basicComparator,
c=0;c<h.length;c++){l=h[c];var s=l.attribute;if(s){l=l.descending?-1:1;var v=b;e&&("string"!==typeof s&&"toString"in s&&(s=s.toString()),v=e[s]||b);q.push(r(s,l,v,k))}}return function(b,c){for(var d=0;d<q.length;){var a=q[d++](b,c);if(0!==a)return a}return 0}};return d})},"esri/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style esri/kernel esri/config esri/sniff esri/domUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/layers/layer".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g){var m=h([g],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(b){this.inherited(arguments,[null,b]);this._mapImages=[];var a=n.hitch;this._panStart=a(this,this._panStart);this._pan=a(this,this._pan);this._extentChange=a(this,this._extentChange);this._zoom=a(this,this._zoom);this._zoomStart=a(this,this._zoomStart);this._scale=a(this,this._scale);this._resize=a(this,this._resize);d.connect(this,"onSuspend",this,this._onSuspend);
d.connect(this,"onResume",this,this._onResume);this.loaded=!0;this.onLoad(this)},opacity:1,_transform:l._getDOMAccessor("transform"),addImage:function(b){var a=this._mapImages.push(b),a=a-1;b._idx=a;b._layer=this;this._div&&this._createImage(b,a)},removeImage:function(b){if(b){var a=b._idx,c=this._mapImages;if(c[a]===b){delete c[a];if(a=b._node)this._clearEvents(a),a.e_idx=a.e_bl=a.e_tr=a.e_l=a.e_t=a.e_w=a.e_h=null,a.parentNode&&(a.parentNode.removeChild(a),r.destroy(a));b._node=b._idx=b._layer=null}}},
removeAllImages:function(){var b=this._mapImages,a,c=b.length;for(a=0;a<c;a++){var d=b[a];d&&this.removeImage(d)}this._mapImages=[]},getImages:function(){var b=this._mapImages,a=[],c,d=b.length;for(c=0;c<d;c++)b[c]&&a.push(b[c]);return a},setOpacity:function(b){this.opacity!=b&&(this._opacityChanged(this.opacity=b),this.onOpacityChange())},onOpacityChange:function(){},_opacityChanged:function(c){var a=this._div,d,e;if(a)if(!b("ie")||8<b("ie"))q.set(a,"opacity",c);else{e=a.childNodes;d=e.length;for(a=
0;a<d;a++)q.set(e[a],"opacity",c)}},_createImage:function(c,a){var e=r.create("img");q.set(e,{position:"absolute"});8>=b("ie")&&q.set(e,"opacity",this.opacity);if(c.rotation){var g="rotate("+(360-c.rotation)+"deg)";9>b("ie")||(q.set(e,this._transform,g),q.set(e,"transform",g))}c._node=e;e.e_idx=a;e.e_layer=this;e.e_load=d.connect(e,"onload",m.prototype._imageLoaded);e.e_error=d.connect(e,"onerror",m.prototype._imageError);e.e_abort=d.connect(e,"onabort",m.prototype._imageError);e.src=c.href},_imageLoaded:function(b,
a){var c=a||b.target||b.currentTarget,d=c.e_layer,e=d._mapImages[c.e_idx],g=d._map;g&&(g.__zooming||g.__panning||!d._sr)?d._standby.push(c):(d._clearEvents(c),e&&e._node===c&&g&&d._attach(e))},_imageError:function(b){b=b.target||b.currentTarget;var a=b.e_layer,c=a._mapImages[b.e_idx];a._clearEvents(b);c&&(c._node=null)},_clearEvents:function(b){var a=d.disconnect;a(b.e_load);a(b.e_error);a(b.e_abort);b.e_load=b.e_error=b.e_abort=b.e_layer=null},_attach:function(b){var a=b.extent,c=a.spatialReference,
d=this._sr,e=this._div,g=b._node,m=new s({x:a.xmin,y:a.ymin,spatialReference:c}),a=new s({x:a.xmax,y:a.ymax,spatialReference:c});d.equals(c)||(d.isWebMercator()&&4326===c.wkid?(m=v.geographicToWebMercator(m),a=v.geographicToWebMercator(a)):c.isWebMercator()&&4326===d.wkid&&(m=v.webMercatorToGeographic(m),a=v.webMercatorToGeographic(a)));g.e_bl=m;g.e_tr=a;b.visible&&(this._setPos(g,e._left,e._top),(this._active||e).appendChild(g))},_setPos:function(b,a,c){var d=b.e_bl,e=b.e_tr,g=this._map,d=g.toScreen(d),
e=g.toScreen(e);a=d.x-a;c=e.y-c;var m=Math.abs(e.x-d.x),d=Math.abs(d.y-e.y),e={width:m+"px",height:d+"px"},k=this._mapImages[b.e_idx];"css-transforms"===g.navigationMode?e[l._css.names.transform]=l._css.translate(a,c)+(k.rotation?" "+l._css.rotate(360-k.rotation):""):(e.left=a+"px",e.top=c+"px");q.set(b,e);b.e_l=a;b.e_t=c;b.e_w=m;b.e_h=d},managedSuspension:!0,_setMap:function(d,a){this.inherited(arguments);var e=this._div=r.create("div",null,a),g=l._css.names,m={position:"absolute"},k=d.__visibleDelta;
if(!b("ie")||8<b("ie"))m.opacity=this.opacity;"css-transforms"===d.navigationMode?(m[g.transform]=l._css.translate(k.x,k.y),q.set(e,m),e._left=k.x,e._top=k.y,m={position:"absolute",width:d.width+"px",height:d.height+"px",overflow:"visible"},this._active=r.create("div",null,e),q.set(this._active,m),this._passive=r.create("div",null,e),q.set(this._passive,m)):(e._left=0,e._top=0,q.set(e,m));this._standby=[];g=this._mapImages;k=g.length;for(m=0;m<k;m++){var h=g[m];h._node||this._createImage(h,h._idx)}c.hide(e);
return e},_unsetMap:function(b,a){this._disconnect();var c=this._div;if(c){var d=this._mapImages,e,g=d.length;for(e=0;e<g;e++){var m=d[e];if(m){var k=m._node;k&&(this._clearEvents(k),k.e_idx=k.e_bl=k.e_tr=k.e_l=k.e_t=k.e_w=k.e_h=null);m._node=null}}a.removeChild(c);r.destroy(c)}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments)},_onSuspend:function(){this._disconnect();c.hide(this._div)},_onResume:function(b){b.firstOccurrence&&(this._sr=this._map.spatialReference,
this._processStandbyList());b=this._map;var a=this._div,d=b.__visibleDelta;"css-transforms"===b.navigationMode&&(a._left=d.x,a._top=d.y,q.set(a,l._css.names.transform,l._css.translate(a._left,a._top)));this._redraw("css-transforms"===b.navigationMode);this._connect(b);c.show(a)},_connect:function(b){if(!this._connections){var a=d.connect,c="css-transforms"===b.navigationMode;this._connections=[a(b,"onPanStart",this._panStart),a(b,"onPan",this._pan),a(b,"onExtentChange",this._extentChange),c&&a(b,
"onZoomStart",this._zoomStart),c?a(b,"onScale",this._scale):a(b,"onZoom",this._zoom),c&&a(b,"onResize",this._resize)]}},_disconnect:function(){this._connections&&(k.forEach(this._connections,d.disconnect),this._connections=null)},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top},_pan:function(b,a){var c=this._div;c._left=this._panL+a.x;c._top=this._panT+a.y;"css-transforms"===this._map.navigationMode?q.set(c,l._css.names.transform,l._css.translate(c._left,c._top)):q.set(c,
{left:c._left+"px",top:c._top+"px"})},_extentChange:function(b,a,c){c?this._redraw("css-transforms"===this._map.navigationMode):a&&this._pan(b,a);this._processStandbyList()},_processStandbyList:function(){var b,a=this._standby;if(a&&a.length)for(b=a.length-1;0<=b;b--)this._imageLoaded(null,a[b]),a.splice(b,1)},_redraw:function(b){if(b){b=this._passive;var a=l._css.names;q.set(b,a.transition,"none");this._moveImages(b,this._active);q.set(b,a.transform,"none")}b=this._active||this._div;var a=this._div._left,
c=this._div._top,d,e=b.childNodes.length,g;for(d=0;d<e;d++)g=b.childNodes[d],this._setPos(g,a,c)},_zoom:function(b,a,c){b=this._div;var d=b._left,e=b._top,g,m=b.childNodes.length,k;for(g=0;g<m;g++){k=b.childNodes[g];var h=k.e_w*a,l=k.e_h*a,n=(c.x-d-k.e_l)*(h-k.e_w)/k.e_w,s=(c.y-e-k.e_t)*(l-k.e_h)/k.e_h,n=isNaN(n)?0:n,s=isNaN(s)?0:s;q.set(k,{left:k.e_l-n+"px",top:k.e_t-s+"px",width:h+"px",height:l+"px"})}},_zoomStart:function(){this._moveImages(this._active,this._passive)},_moveImages:function(b,a){var c=
b.childNodes,d;d=c.length;if(0<d)for(d-=1;0<=d;d--)a.appendChild(c[d])},_scale:function(b,a){var c=l._css.names,d=this._passive;q.set(d,c.transition,a?"none":c.transformName+" "+e.defaults.map.zoomDuration+"ms ease");l._css.matrix(b);q.set(d,c.transform,l._css.matrix(b))},_resize:function(b,a,c){q.set(this._active,{width:a+"px",height:c+"px"});q.set(this._passive,{width:a+"px",height:c+"px"})}});b("extend-esri")&&n.setObject("layers.MapImageLayer",m,l);return m})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/layers/MapImage".split(" "),
function(h,d,n,k,r,q){h=h([q],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(d){r.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});n("extend-esri")&&d.setObject("layers.KMLGroundOverlay",h,k);return h})},"esri/tasks/SpatialRelationship":function(){define(["dojo/_base/lang","dojo/has","esri/kernel"],function(h,d,n){var k={SPATIAL_REL_INTERSECTS:"esriSpatialRelIntersects",SPATIAL_REL_CONTAINS:"esriSpatialRelContains",SPATIAL_REL_CROSSES:"esriSpatialRelCrosses",SPATIAL_REL_ENVELOPEINTERSECTS:"esriSpatialRelEnvelopeIntersects",
SPATIAL_REL_INDEXINTERSECTS:"esriSpatialRelIndexIntersects",SPATIAL_REL_OVERLAPS:"esriSpatialRelOverlaps",SPATIAL_REL_TOUCHES:"esriSpatialRelTouches",SPATIAL_REL_WITHIN:"esriSpatialRelWithin",SPATIAL_REL_RELATION:"esriSpatialRelRelation"};d("extend-esri")&&h.setObject("tasks._SpatialRelationship",k,n);return k})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(h,
d,n,k,r,q,l,e,b){var c=r.delegate(e,{mouseenter:q.enter,mouseleave:q.leave,keypress:n._keypress}),s;n=k("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var c=b;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(b,c){return b.getAttribute(c)},this._attach)||this.searchContainerNode)&&
c.firstChild)c=c.firstChild;else{if(c==b)break;for(;!c.nextSibling;)if(c=c.parentNode,c==b)return;c=c.nextSibling}},_processTemplateNode:function(b,c,d){var e=!0,a=this.attachScope||this,p=c(b,"dojoAttachPoint")||c(b,"data-dojo-attach-point");if(p)for(var k=p.split(/\s*,\s*/);p=k.shift();)r.isArray(a[p])?a[p].push(b):a[p]=b,e="containerNode"!=p,this._attachPoints.push(p);if(c=c(b,"dojoAttachEvent")||c(b,"data-dojo-attach-event")){p=c.split(/\s*,\s*/);for(k=r.trim;c=p.shift();)if(c){var h=null;-1!=
c.indexOf(":")?(h=c.split(":"),c=k(h[0]),h=k(h[1])):c=k(c);h||(h=c);this._attachEvents.push(d(b,c,r.hitch(a,h)))}}return e},_attach:function(b,d,e){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?s||(s=h("./a11yclick")):c[d]||d;return l(b,d,e)},_detachTemplateNodes:function(){var b=this.attachScope||this;d.forEach(this._attachPoints,function(c){delete b[c]});this._attachPoints=[];d.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});r.extend(b,{dojoAttachEvent:"",dojoAttachPoint:""});return n})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/has dojo/string esri/kernel esri/urlUtils esri/SpatialReference esri/geometry/Extent esri/layers/TiledMapServiceLayer esri/layers/TileInfo".split(" "),function(h,d,n,k,r,q,l,e,b,c,s,v){h=h(s,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(d,e){e||(e={});this.urlTemplate=d;
var f=new c(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new b({wkid:102100})),a=new c(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new b({wkid:102100}));this.initialExtent=e.initialExtent||f;this.fullExtent=e.fullExtent||a;this.tileInfo=e.tileInfo?e.tileInfo:new v({rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new b(this.tileInfo.spatialReference.toJson());this.copyright=e.copyright||"";var p=new k(d),f=p.scheme+"://"+p.authority+"/";this.urlPath=d.substring(f.length);this.tileServers=e.tileServers||[];-1===p.authority.indexOf("{subDomain}")&&this.tileServers.push(f);if(e.subDomains&&0<e.subDomains.length&&1<p.authority.split(".").length){this.subDomains=e.subDomains;var h;n.forEach(e.subDomains,function(a,
b){-1<p.authority.indexOf("${subDomain}")?h=p.scheme+"://"+q.substitute(p.authority,{subDomain:a})+"/":-1<p.authority.indexOf("{subDomain}")&&(h=p.scheme+"://"+p.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(h)},this)}this.tileServers=n.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});this._levelToLevelValue=[];n.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=a.levelValue||a.level},this);this.loaded=!0;this.onLoad(this)},
getTileUrl:function(b,c,d){b=this._levelToLevelValue[b];var a=this.tileServers[c%this.tileServers.length]+q.substitute(this.urlPath,{level:b,col:d,row:c}),a=a.replace(/\{level\}/gi,b).replace(/\{row\}/gi,c).replace(/\{col\}/gi,d),a=this.addTimestampToURL(a);return e.addProxy(a)}});r("extend-esri")&&d.setObject("layers.WebTiledLayer",h,l);return h})},"dojo/promise/all":function(){define(["../_base/array","../Deferred","../when"],function(h,d,n){var k=h.some;return function(h){var q,l;h instanceof Array?
l=h:h&&"object"===typeof h&&(q=h);var e,b=[];if(q){l=[];for(var c in q)Object.hasOwnProperty.call(q,c)&&(b.push(c),l.push(q[c]));e={}}else l&&(e=[]);if(!l||!l.length)return(new d).resolve(e);var s=new d;s.promise.always(function(){e=b=null});var v=l.length;k(l,function(c,d){q||b.push(d);n(c,function(c){s.isFulfilled()||(e[b[d]]=c,0===--v&&s.resolve(e))},s.reject);return s.isFulfilled()});return s.promise}})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/SpatialReference esri/tasks/query esri/layers/RenderMode".split(" "),
function(h,d,n,k,r,q,l){h=h([l],{declaredClass:"esri.layers._SnapshotMode",constructor:function(e){this.featureLayer=e;this.pagination=e.queryPagination;this._featureMap={};this._drawFeatures=d.hitch(this,this._drawFeatures);this._queryErrorHandler=d.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(d){this._init&&(d?this.featureLayer._collection?
console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(d){var b=d.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(b,d);this._incRefCount(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var d=this.featureLayer;d._collection?(d._fireUpdateStart(),d._refresh(!0),d._fireUpdateEnd()):
this._fetchAll()},_getRequestId:function(d){return("_"+d.name+d.layerId+d._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var d=this.featureLayer;!d._collection&&!d.suspended&&(d._fireUpdateStart(),this._clearIIf(),this._sendRequest())},_sendRequest:function(d){var b=this.map,c=this.featureLayer,k=c.getDefinitionExpression(),h=new q;h.outFields=c.getOutFields();h.where=k||"1\x3d1";h.returnGeometry=!0;h.outSpatialReference=new r(b.spatialReference.toJson());h.timeExtent=c.getTimeDefinition();
h.maxAllowableOffset=c._maxOffset;c._ts&&(h._ts=(new Date).getTime());h.orderByFields=c.supportsAdvancedQueries?c.getOrderByFields():null;this.pagination&&(this._start=h.start=null==d?0:d,h.num=c.maxRecordCount);var g;c._usePatch&&(g=this._getRequestId(c),this._cancelPendingRequest(null,g));c._task.execute(h,this._drawFeatures,this._queryErrorHandler,g)},_drawFeatures:function(d){this._purgeRequests();var b=d.features,c=this.featureLayer,k=c.objectIdField,h,g=b.length,m=d.exceededTransferLimit&&!c._collection,
f,a;for(h=0;h<g;h++)f=b[h],a=f.attributes[k],this._addFeatureIIf(a,f),this._incRefCount(a);this._applyTimeFilter(!0);if(!this.pagination||!m)c._fireUpdateEnd(null,d.exceededTransferLimit?{queryLimitExceeded:!0}:null);m&&(this.pagination&&this._sendRequest(this._start+c.maxRecordCount),c.onQueryLimitExceeded())},_queryErrorHandler:function(d){this._purgeRequests();var b=this.featureLayer;b._errorHandler(d);b._fireUpdateEnd(d)}});n("extend-esri")&&d.setObject("layers._SnapshotMode",h,k);return h})},
"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(h,d,n,k,r){h=h([r],{declaredClass:"esri.layers._SelectionMode",constructor:function(d){this.featureLayer=d;this._featureMap={}},propertyChangeHandler:function(d){this._init&&0===d&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)}});n("extend-esri")&&d.setObject("layers._SelectionMode",h,k);return h})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/deferredUtils esri/urlUtils esri/Evented".split(" "),
function(h,d,n,k,r,q,l,e){h=h(e,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(b,c){b&&d.isString(b)&&(this._url=l.urlToObject(this.url=b));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=!0;this._errorHandler=d.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));b&&b.path&&(b.path=b.path.replace(c,"https:"))},
_encode:function(b,c,e){var k,g,m={},f,a;for(f in b)if("declaredClass"!==f&&(k=b[f],g=typeof k,null!==k&&void 0!==k&&"function"!==g))if(d.isArray(k)){m[f]=[];a=k.length;for(g=0;g<a;g++)m[f][g]=this._encode(k[g])}else"object"===g?k.toJson&&(g=k.toJson(e&&e[f]),"esri.tasks.FeatureSet"===k.declaredClass&&g.spatialReference&&(g.sr=g.spatialReference,delete g.spatialReference),m[f]=c?g:n.toJson(g)):m[f]=k;return m},_successHandler:function(b,c,d,e){c&&this[c].apply(this,b);d&&d.apply(null,b);e&&q._resDfd(e,
b)},_errorHandler:function(b,c,d){this.onError(b);c&&c(b);d&&d.errback(b)},setNormalization:function(b){this.normalization=b},onError:function(){}});k("extend-esri")&&(r.Task=h);return h})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(h,d,n){h.DeferredList=function(k,h,q,l,e){var b=[];d.call(this);var c=this;0===k.length&&!h&&this.resolve([0,[]]);var s=0;n.forEach(k,function(d,e){function m(d,a){b[e]=[d,a];s++;s===k.length&&c.resolve(b)}d.then(function(b){h?
c.resolve([e,b]):m(!0,b)},function(b){q?c.reject(b):m(!1,b);if(l)return null;throw b;})})};h.DeferredList.prototype=new d;h.DeferredList.prototype.gatherResults=function(d){d=new h.DeferredList(d,!1,!0,!1);d.addCallback(function(d){var k=[];n.forEach(d,function(d){k.push(d[1])});return k});return d};return h.DeferredList})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(h,d,n,k,r,q){h=k("dijit._OnDijitClickMixin",
null,{connect:function(d,e,b){return this.inherited(arguments,[d,"ondijitclick"==e?q:e,b])}});h.a11yclick=q;return h})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(h,d,n,k){function r(d){if((d.keyCode===h.ENTER||d.keyCode===h.SPACE)&&!/input|button|textarea/i.test(d.target.nodeName))for(d=d.target;d;d=d.parentNode)if(d.dojoClick)return!0}var q;n(document,"keydown",function(d){r(d)?(q=d.target,d.preventDefault()):q=null});n(document,"keyup",function(d){r(d)&&
d.target==q&&(q=null,n.emit(d.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:d.ctrlKey,shiftKey:d.shiftKey,metaKey:d.metaKey,altKey:d.altKey,_origType:d.type}))});var l=function(d,b){d.dojoClick=!0;return n(d,"click",b)};l.click=l;l.press=function(e,b){var c=n(e,k.press,function(c){("mousedown"!=c.type||d.isLeft(c))&&b(c)}),l=n(e,"keydown",function(c){(c.keyCode===h.ENTER||c.keyCode===h.SPACE)&&b(c)});return{remove:function(){c.remove();l.remove()}}};l.release=function(e,b){var c=n(e,k.release,
function(c){("mouseup"!=c.type||d.isLeft(c))&&b(c)}),l=n(e,"keyup",function(c){(c.keyCode===h.ENTER||c.keyCode===h.SPACE)&&b(c)});return{remove:function(){c.remove();l.remove()}}};l.move=k.move;return l})},"esri/layers/WMSLayer":function(){define("require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/request esri/urlUtils esri/SpatialReference esri/geometry/Extent esri/layers/DynamicMapServiceLayer esri/layers/WMSLayerInfo dojo/query".split(" "),function(h,
d,n,k,r,q,l,e,b,c,s,v,g){n=n([v],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,
3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(c,d){this.url=c=this._stripParameters(c,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=b.urlToObject(c);this._getCapabilitiesURL=c;this._initLayer=k.hitch(this,this._initLayer);this._parseCapabilities=k.hitch(this,this._parseCapabilities);this._getCapabilitiesError=k.hitch(this,this._getCapabilitiesError);d?(this.imageFormat=this._getImageFormat(d.format),this.imageTransparency=!1===d.transparent?!1:!0,this.visibleLayers=d.visibleLayers?d.visibleLayers:[],d.resourceInfo?this._readResourceInfo(d.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=
!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=h.toUrl("esri/layers")+"/../images/pixel.png"},setVisibleLayers:function(b){this.visibleLayers=(b=this._checkVisibleLayersList(b))?b:[];this.refresh(!0)},setImageFormat:function(b){this.imageFormat=this._getImageFormat(b);this.refresh(!0)},setImageTransparency:function(b){this.imageTransparency=b;this.refresh(!0)},getImageUrl:function(c,d,a,e){if(!this.visibleLayers||0===this.visibleLayers.length)e(this._blankImageURL);else{var g=
c.spatialReference.wkid;if(r.some(this._WEB_MERCATOR,function(a){return a==g})){var k=r.filter(this.spatialReferences,function(a){return r.some(this._WEB_MERCATOR,function(b){return b==a})},this);0==k.length&&(k=r.filter(this.spatialReferences,function(a){return r.some(this._WORLD_MERCATOR,function(b){return b==a})},this));g=0<k.length?k[0]:this._WEB_MERCATOR[0]}this.spatialReferences=r.filter(this.spatialReferences,function(a){return a!==g});this.spatialReferences.unshift(g);var k=c.xmin,h=c.xmax,
l=c.ymin,n=c.ymax;c={SERVICE:"WMS",REQUEST:"GetMap"};c.FORMAT=this.imageFormat;c.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";c.STYLES="";c.VERSION=this.version;c.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;c.WIDTH=d;c.HEIGHT=a;this.maxWidth<d&&(c.WIDTH=this.maxWidth);this.maxHeight<a&&(c.HEIGHT=this.maxHeight);d=g?g:NaN;isNaN(d)||("1.3.0"==this.version?c.CRS="EPSG:"+d:c.SRS="EPSG:"+d);"1.3.0"==this.version&&this._useLatLong(d)?c.BBOX=l+","+k+","+n+","+h:c.BBOX=k+","+l+","+h+
","+n;d=this.getMapURL;var w;d+=-1==d.indexOf("?")?"?":"";for(w in c)d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=w+"\x3d"+c[w];e(b.addProxy(d))}},_initLayer:function(b,d){this.spatialReference=new c(this.extent.spatialReference);this.initialExtent=new s(this.extent);this.fullExtent=new s(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))},_readResourceInfo:function(b){b.extent?
b.layerInfos?(this.extent=b.extent,this.allExtents[0]=b.extent,this.layerInfos=b.layerInfos,this.description=b.description?b.description:"",this.copyright=b.copyright?b.copyright:"",this.title=b.title?b.title:"",this.getMapURL=b.getMapURL?b.getMapURL:this._getCapabilitiesURL,this.version=b.version?b.version:"1.3.0",this.maxWidth=b.maxWidth?b.maxWidth:5E3,this.maxHeight=b.maxHeight?b.maxHeight:5E3,this.spatialReferences=b.spatialReferences?b.spatialReferences:[],this.imageFormat=this._getImageFormat(b.format),
this.setScaleRange(b.minScale,b.maxScale),this._initLayer()):console.error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo"):console.error("esri.layers.WMSLayer: unable to find the 'extent' property in resourceInfo")},_getCapabilities:function(){var b=this._url.query?this._url.query:{};b.SERVICE="WMS";b.REQUEST="GetCapabilities";var c=this._url.path+"?",a;for(a in b)c+="?"==c.substring(c.length-1,c.length)?"":"\x26",c+=a+"\x3d"+b[a];e({url:c,handleAs:"xml",headers:{"Content-Type":null},
load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(b){if(b){this.version=this._getAttributeValue("WMS_Capabilities","version",b,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",b,"1.3.0"));var c=this._getTag("Service",b);this.title=this._getTagValue("Title",c,"");if(!this.title||0==this.title.length)this.title=this._getTagValue("Name",c,"");this.copyright=this._getTagValue("AccessConstraints",c,"");this.description=
this._getTagValue("Abstract",c,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",c,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",c,5E3),10);if(c=this._getTag("Layer",b)){var a=this._getLayerInfo(c),e=0,g=null,c=this._getTag("Capability",b);r.forEach(c.childNodes,function(b){"Layer"==b.nodeName&&(0===e?g=b:(1===e&&a.name&&(a.name="",a.subLayers=[],a.subLayers.push(this._getLayerInfo(g))),a.subLayers.push(this._getLayerInfo(b))),e++)},this);if(a){this.layerInfos=a.subLayers;if(!this.layerInfos||
0==this.layerInfos.length)this.layerInfos=[a];this.extent=a.extent;this.allExtents=a.allExtents;this.spatialReferences=a.spatialReferences;0==this.spatialReferences.length&&0<this.layerInfos.length&&(this.spatialReferences=this.layerInfos[0].spatialReferences)}this.getMapURL=this._getCapabilitiesURL;if((c=d.query("DCPType",this._getTag("GetMap",b)))&&0<c.length)if((c=d.query("HTTP",c[0]))&&0<c.length)if((c=d.query("Get",c[0]))&&0<c.length)if(c=this._getAttributeValue("OnlineResource","xlink:href",
c[0],null))c.indexOf("\x26")==c.length-1&&(c=c.substring(0,c.length-1)),this.getMapURL=c;this.getMapFormats=[];0==d.query("Operation",b).length?r.forEach(d.query("Format",this._getTag("GetMap",b)),function(a){this.getMapFormats.push(a.text?a.text:a.textContent)},this):r.forEach(d.query("Operation",b),function(a){"GetMap"==a.getAttribute("name")&&r.forEach(d.query("Format",a),function(a){this.getMapFormats.push(a.text?a.text:a.textContent)},this)},this);r.some(this.getMapFormats,function(a){return-1<
a.indexOf(this.imageFormat)},this)||(this.imageFormat=this.getMapFormats[0]);this._initLayer()}else this._getCapabilitiesError({error:{message:"Response does not contain any layers."}})}else this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)")},_getCapabilitiesError:function(b,c){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",b)},_getLayerInfo:function(b){if(!b)return null;var d=new g;d.name="";d.title="";d.description=
"";d.allExtents=[];d.spatialReferences=[];d.subLayers=[];var a=this._getTag("LatLonBoundingBox",b);a&&(d.allExtents[0]=this._getExtent(a,4326));if(a=this._getTag("EX_GeographicBoundingBox",b)){var e=new s(0,0,0,0,new c({wkid:4326}));e.xmin=parseFloat(this._getTagValue("westBoundLongitude",a,0));e.ymin=parseFloat(this._getTagValue("southBoundLatitude",a,0));e.xmax=parseFloat(this._getTagValue("eastBoundLongitude",a,0));e.ymax=parseFloat(this._getTagValue("northBoundLatitude",a,0));d.allExtents[0]=
e}d.extent=d.allExtents[0];var k=-1<r.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";r.forEach(b.childNodes,function(a){if("Name"==a.nodeName)d.name=(a.text?a.text:a.textContent)||"";else if("Title"==a.nodeName)d.title=(a.text?a.text:a.textContent)||"";else if("Abstract"==a.nodeName)d.description=(a.text?a.text:a.textContent)||"";else if("BoundingBox"==a.nodeName){var b=a.getAttribute(k);b&&0===b.indexOf("EPSG:")?(b=parseInt(b.substring(5),10),0!==b&&!isNaN(b)&&(a="1.3.0"==this.version?
this._getExtent(a,b,this._useLatLong(b)):this._getExtent(a,b),d.allExtents[b]=a,d.extent||(d.extent=a))):b&&0===b.indexOf("CRS:")?(b=parseInt(b.substring(4),10),0!==b&&!isNaN(b)&&(this._CRS_TO_EPSG[b]&&(b=this._CRS_TO_EPSG[b]),d.allExtents[b]=this._getExtent(a,b))):(b=parseInt(b,10),0!==b&&!isNaN(b)&&(d.allExtents[b]=this._getExtent(a,b)))}else if(a.nodeName==k)a=(a.text?a.text:a.textContent).split(" "),r.forEach(a,function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0!==a&&
!isNaN(a)&&(this._CRS_TO_EPSG[a]&&(a=this._CRS_TO_EPSG[a]),-1==r.indexOf(d.spatialReferences,a)&&d.spatialReferences.push(a))},this);else if("Style"==a.nodeName){if(a=this._getTag("LegendURL",a))if(a=this._getTag("OnlineResource",a))d.legendURL=a.getAttribute("xlink:href")}else"Layer"===a.nodeName&&d.subLayers.push(this._getLayerInfo(a))},this);d.title=d.title||d.name;return d},_getImageFormat:function(b){switch(b?b.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";case "gif":return"image/gif";
case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(b,d,a){var e;if(b){e=new s;var g=parseFloat(b.getAttribute("minx")),k=parseFloat(b.getAttribute("miny")),h=parseFloat(b.getAttribute("maxx"));b=parseFloat(b.getAttribute("maxy"));a?(e.xmin=isNaN(k)?
-1*Number.MAX_VALUE:k,e.ymin=isNaN(g)?-1*Number.MAX_VALUE:g,e.xmax=isNaN(b)?Number.MAX_VALUE:b,e.ymax=isNaN(h)?Number.MAX_VALUE:h):(e.xmin=isNaN(g)?-1*Number.MAX_VALUE:g,e.ymin=isNaN(k)?-1*Number.MAX_VALUE:k,e.xmax=isNaN(h)?Number.MAX_VALUE:h,e.ymax=isNaN(b)?Number.MAX_VALUE:b);e.spatialReference=new c({wkid:d})}return e},_useLatLong:function(b){var c,a;for(a=0;a<this._REVERSED_LAT_LONG_RANGES.length;a++){var d=this._REVERSED_LAT_LONG_RANGES[a];if(b>=d[0]&&b<=d[1]){c=!0;break}}return c},_getTag:function(b,
c){var a=d.query(b,c);return a&&0<a.length?a[0]:null},_getTagValue:function(b,c,a){return(b=d.query(b,c))&&0<b.length?b[0].text?b[0].text:b[0].textContent:a},_getAttributeValue:function(b,c,a,e){return(b=d.query(b,a))&&0<b.length?b[0].getAttribute(c):e},_checkVisibleLayersList:function(b){if(b&&(0<b.length&&this.layerInfos&&0<this.layerInfos.length)&&"number"==typeof b[0]){var c=[];r.forEach(b,function(a){a<this.layerInfos.length&&c.push(this.layerInfos[a].name)},this);b=c}return b},_stripParameters:function(c,
d){var a=b.urlToObject(c),e,g=[];for(e in a.query)-1===r.indexOf(d,e.toLowerCase())&&g.push(e+"\x3d"+a.query[e]);return a.path+(g.length?"?"+g.join("\x26"):"")}});q("extend-esri")&&k.setObject("layers.WMSLayer",n,l);return n})},"esri/layers/CSVLayer":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/arcgis/csv esri/layers/FeatureLayer esri/geometry/Extent esri/tasks/FeatureSet".split(" "),function(h,d,n,k,r,q,l,e,b){d=d(l,{declaredClass:"esri.layers.CSVLayer",
_preventInit:!0,_fieldTypeMap:{Date:"esriFieldTypeDate",Number:"esriFieldTypeDouble",String:"esriFieldTypeString"},constructor:function(b,d){this.url=b;d=n.mixin(d,{outFields:["*"]});this.columnDelimiter=d.columnDelimiter;this.latitudeFieldName=d.latitudeFieldName;this.longitudeFieldName=d.longitudeFieldName;var e=d.layerDefinition;e||(e={fields:d.fields||[],geometryType:"esriGeometryPoint",copyrightText:d.copyright},d.fields&&h.forEach(d.fields,n.hitch(this,function(b){b.type=this._fieldTypeMap[b.type||
"String"];b.alias||(b.alias=b.name)})));this._buildCsvFcParam={url:this.url,columnDelimiter:this.columnDelimiter,layerDefinition:e};this.latitudeFieldName&&this.longitudeFieldName&&(this._buildCsvFcParam.locationInfo={locationType:"coordinates",latitudeFieldName:this.latitudeFieldName,longitudeFieldName:this.longitudeFieldName});this._projectFeatures=n.hitch(this,this._projectFeatures);this._addFeatures=n.hitch(this,this._addFeatures);this._initCSVLayer(d)},refresh:function(){this._fireUpdateStart();
this.applyEdits(null,null,this.graphics);this._loadFeatures()},_setMap:function(b){var d=this.inherited(arguments);this._fireUpdateStart();this._projectFeatures(this._csvFC).then(this._addFeatures).otherwise(this._errorHandler);this._csvFC=null;return d},_initCSVLayer:function(b){var d=this;q.buildCSVFeatureCollection(this._buildCsvFcParam).then(function(e){d._csvFC=e;var g=e.layerDefinition;g.extent=d._getFCExtent(e);d._initFeatureLayer({layerDefinition:g},b)}).otherwise(this._errorHandler)},_loadFeatures:function(){q.buildCSVFeatureCollection(this._buildCsvFcParam).then(this._projectFeatures).then(this._addFeatures).otherwise(this._errorHandler)},
_projectFeatures:function(b){return q.projectFeatureCollection(b,this._map.spatialReference)},_addFeatures:function(c){c=new b(c.featureSet);this.applyEdits(c.features,null,null);this._fireUpdateEnd()},_getFCExtent:function(b){var d;if(b&&b.featureSet&&b.featureSet.features){b=b.featureSet.features;var k=b.length;if(1<k){var g=b[0].geometry;d=new e(g.x,g.y,g.x,g.y);for(k-=1;0<k;k--)g=b[k].geometry,d.xmin=Math.min(d.xmin,g.x),d.ymin=Math.min(d.ymin,g.y),d.xmax=Math.max(d.xmax,g.x),d.ymax=Math.max(d.ymax,
g.y);0>=d.getWidth()&&0>=d.getHeight()&&(d=null)}}return d}});k("extend-esri")&&n.setObject("layers.CSVLayer",d,r);return d})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(h,d,n,k){n(function(){d("highcontrast")&&h.add(k.body(),"dijit_a11y")});return d})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(h,d,n,
k,r,q,l,e){var b=d("dijit._TemplatedMixin",e,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var d=this.declaredClass,e=this;return l.substitute(b,this,function(b,c){"!"==c.charAt(0)&&(b=k.getObject(c.substr(1),!1,e));if("undefined"==typeof b)throw Error(d+" template:"+c);return null==b?"":"!"==c.charAt(0)?b:b.toString().replace(/"/g,"\x26quot;")},this)},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=
h(this.templatePath,{sanitize:!0}));var c=b.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),d;if(k.isString(c)){if(d=n.toDom(this._stringRepl(c),this.ownerDocument),1!=d.nodeType)throw Error("Invalid template: "+c);}else d=c.cloneNode(!0);this.domNode=d}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var d=this.containerNode;if(b&&d)for(;b.hasChildNodes();)d.appendChild(b.firstChild)}});b._templateCache=
{};b.getCachedTemplate=function(c,d,e){var g=b._templateCache,k=c,f=g[k];if(f){try{if(!f.ownerDocument||f.ownerDocument==(e||document))return f}catch(a){}n.destroy(f)}c=l.trim(c);if(d||c.match(/\$\{([^\}]+)\}/g))return g[k]=c;d=n.toDom(c,e);if(1!=d.nodeType)throw Error("Invalid template: "+c);return g[k]=d};q("ie")&&r(window,"unload",function(){var c=b._templateCache,d;for(d in c){var e=c[d];"object"==typeof e&&n.destroy(e);delete c[d]}});return b})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has esri/kernel esri/request esri/deferredUtils esri/tasks/Task esri/geometry/Extent esri/geometry/Polyline esri/geometry/Polygon esri/geometry/Multipoint esri/geometry/jsonUtils".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f){h=h(c,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],
"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=d.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=a(this,this._lengthsHandler);
this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);this._trimExtendHandler=a(this,
this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJson());return{geometryType:f.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var e=f.getGeometryType(b);a=a.geometries;var g=[],k={spatialReference:c.toJson()},
h=d.mixin;n.forEach(a,function(a,b){g[b]=new e(h(a,k))});return g},_toProjectGeometry:function(a){var b=a.spatialReference.toJson();return a instanceof s?new g({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:b}):new v({paths:[[].concat(a.points)],spatialReference:b})},_fromProjectedGeometry:function(a,b,c){return"esriGeometryEnvelope"===b?(a=a.rings[0],new s(a[0][0],a[0][1],a[2][0],a[2][1],c)):new m({points:a.paths[0],spatialReference:c.toJson()})},
project:function(a,c,g,h){var l=d.mixin({},this._url.query,{f:"json"}),m;a.geometries?(h=g,g=c,c=a.outSR,m=a.geometries[0],l=d.mixin(l,a.toJson())):(m=a[0],l=d.mixin(l,{outSR:c.wkid||k.toJson(c.toJson()),inSR:m.spatialReference.wkid||k.toJson(m.spatialReference.toJson()),geometries:k.toJson(this._encodeGeometries(a))}));var n=f.getJsonType(m),w=this._projectHandler,A=this._errorHandler,q=new r(b._dfdCanceller);q._pendingDfd=e({url:this._url.path+"/project",content:l,callbackParamName:"callback",load:function(a,
b){w(a,b,n,c,g,h,q)},error:function(a){A(a,h,q)}});return q},_projectHandler:function(a,b,c,d,e,f,g){try{var k=this._decodeGeometries(a,c,d);this._successHandler([k],"onProjectComplete",e,g)}catch(h){this._errorHandler(h,f,g)}},onProjectComplete:function(){},simplify:function(a,c,g){var h=a[0].spatialReference,l=d.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:k.toJson(h.toJson()),geometries:k.toJson(this._encodeGeometries(a))}),m=f.getJsonType(a[0]),n=this._simplifyHandler,w=this._errorHandler,
A=new r(b._dfdCanceller);A._pendingDfd=e({url:this._url.path+"/simplify",content:l,callbackParamName:"callback",load:function(a,b){n(a,b,m,h,c,g,A)},error:function(a){w(a,g,A)}});return A},_simplifyHandler:function(a,b,c,d,e,f,g){try{var k=this._decodeGeometries(a,c,d);this._successHandler([k],"onSimplifyComplete",e,g)}catch(h){this._errorHandler(h,f,g)}},onSimplifyComplete:function(){},convexHull:function(a,c,f){var g=a[0].spatialReference;a=d.mixin({},this._url.query,{f:"json",sr:k.toJson(g.toJson()),
geometries:k.toJson(this._encodeGeometries(a))});var h=this._convexHullHandler,l=this._errorHandler,m=new r(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,f,m)},error:function(a){l(a,f,m)}});return m},_convexHullHandler:function(a,b,c,d,e,g){try{var k=f.fromJson(a.geometry).setSpatialReference(c);this._successHandler([k],"onConvexHullComplete",d,g)}catch(h){this._errorHandler(h,e,g)}},onConvexHullComplete:function(){},
union:function(a,c,f){var g=a[0].spatialReference;a=d.mixin({},this._url.query,{f:"json",sr:k.toJson(g.toJson()),geometries:k.toJson(this._encodeGeometries(a))});var h=this._unionHandler,m=this._errorHandler,l=new r(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/union",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,g,c,f,l)},error:function(a){m(a,f,l)}});return l},_unionHandler:function(a,b,c,d,e,g){try{var k=f.fromJson(a.geometry).setSpatialReference(c);this._successHandler([k],
"onUnionComplete",d,g)}catch(h){this._errorHandler(h,e,g)}},onUnionComplete:function(){},autoComplete:function(a,c,g,f){var h=a[0].spatialReference;a=d.mixin({},this._url.query,{f:"json",sr:k.toJson(h.toJson()),polygons:k.toJson(this._encodeGeometries(a).geometries),polylines:k.toJson(this._encodeGeometries(c).geometries)});var l=this._autoCompleteHandler,m=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=e({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(a,
b){l(a,b,h,g,f,n)},error:function(a){m(a,f,n)}});return n},_autoCompleteHandler:function(a,b,c,d,e,f){try{var k=a.geometries;a=[];var h,l=k.length;for(h=0;h<l;h++)a[h]=new g({spatialReference:c,rings:k[h].rings});this._successHandler([a],"onAutoCompleteComplete",d,f)}catch(m){this._errorHandler(m,e,f)}},onAutoCompleteComplete:function(){},reshape:function(a,c,g,h){var l=a.spatialReference;a=d.mixin({},this._url.query,{f:"json",sr:k.toJson(l.toJson()),target:k.toJson({geometryType:f.getJsonType(a),
geometry:a.toJson()}),reshaper:k.toJson(c.toJson())});var m=this._reshapeHandler,n=this._errorHandler,w=new r(b._dfdCanceller);w._pendingDfd=e({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,b){m(a,b,l,g,h,w)},error:function(a){n(a,h,w)}});return w},_reshapeHandler:function(a,b,c,d,e,g){try{var k=f.fromJson(a.geometry).setSpatialReference(c);this._successHandler([k],"onReshapeComplete",d,g)}catch(h){this._errorHandler(h,e,g)}},onReshapeComplete:function(){},cut:function(a,
c,g,h){var l=a[0].spatialReference,m=n.map(a,function(a){return a.toJson()});a=d.mixin({},this._url.query,{f:"json",sr:k.toJson(l.toJson()),target:k.toJson({geometryType:f.getJsonType(a[0]),geometries:m}),cutter:k.toJson(c.toJson())});var q=this._cutHandler,w=this._errorHandler,A=new r(b._dfdCanceller);A._pendingDfd=e({url:this._url.path+"/cut",content:a,callbackParamName:"callback",load:function(a,b){q(a,b,l,g,h,A)},error:function(a){w(a,h,A)}});return A},_cutHandler:function(a,b,c,d,e,g){try{var k=
a.geometries,h={};h.cutIndexes=a.cutIndexes;h.geometries=[];n.forEach(k,function(a){h.geometries.push(f.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onCutComplete",d,g)}catch(l){this._errorHandler(l,e,g)}},onCutComplete:function(){},intersect:function(a,c,g,h){var l=a[0].spatialReference;a=d.mixin({},this._url.query,{f:"json",sr:k.toJson(l.toJson()),geometries:k.toJson(this._encodeGeometries(a)),geometry:k.toJson({geometryType:f.getJsonType(c),geometry:c.toJson()})});var m=this._intersectHandler,
n=this._errorHandler,w=new r(b._dfdCanceller);w._pendingDfd=e({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,b){m(a,b,l,g,h,w)},error:function(a){n(a,h,w)}});return w},_intersectHandler:function(a,b,c,d,e,g){try{var k=[];n.forEach(a.geometries,function(a){k.push(f.fromJson(a).setSpatialReference(c))});this._successHandler([k],"onIntersectComplete",d,g)}catch(h){this._errorHandler(h,e,g)}},onIntersectComplete:function(){},difference:function(a,c,g,h){var l=
a[0].spatialReference;a=d.mixin({},this._url.query,{f:"json",sr:k.toJson(l.toJson()),geometries:k.toJson(this._encodeGeometries(a)),geometry:k.toJson({geometryType:f.getJsonType(c),geometry:c.toJson()})});var m=this._differenceHandler,n=this._errorHandler,w=new r(b._dfdCanceller);w._pendingDfd=e({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,b){m(a,b,l,g,h,w)},error:function(a){n(a,h,w)}});return w},_differenceHandler:function(a,b,c,d,e,g){try{var k=[];n.forEach(a.geometries,
function(a){k.push(f.fromJson(a).setSpatialReference(c))});this._successHandler([k],"onDifferenceComplete",d,g)}catch(h){this._errorHandler(h,e,g)}},onDifferenceComplete:function(){},buffer:function(a,c,g){var f=d.mixin({},this._url.query,{f:"json"},a.toJson()),k=a.outSpatialReference||a.geometries[0].spatialReference,h=this._bufferHandler,l=this._errorHandler,m=new r(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/buffer",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,k,c,
g,m)},error:function(a){l(a,g,m)}});return m},_bufferHandler:function(a,b,c,d,e,f){try{var k=a.geometries;a=[];var h,l=k.length;for(h=0;h<l;h++)a[h]=new g({spatialReference:c,rings:k[h].rings});this._successHandler([a],"onBufferComplete",d,f)}catch(m){this._errorHandler(m,e,f)}},onBufferComplete:function(){},areasAndLengths:function(a,c,g){a=d.mixin({},this._url.query,{f:"json"},a.toJson());var f=this._areasAndLengthsHandler,k=this._errorHandler,h=new r(b._dfdCanceller);h._pendingDfd=e({url:this._url.path+
"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,b){f(a,b,c,g,h)},error:function(a){k(a,g,h)}});return h},_areasAndLengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onAreasAndLengthsComplete",c,e)}catch(g){this._errorHandler(g,d,e)}},onAreasAndLengthsComplete:function(){},lengths:function(a,c,g){a=d.mixin({},this._url.query,{f:"json"},a.toJson());var f=this._lengthsHandler,k=this._errorHandler,h=new r(b._dfdCanceller);h._pendingDfd=e({url:this._url.path+"/lengths",
content:a,callbackParamName:"callback",load:function(a,b){f(a,b,c,g,h)},error:function(a){k(a,g,h)}});return h},_lengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onLengthsComplete",c,e)}catch(g){this._errorHandler(g,d,e)}},onLengthsComplete:function(){},labelPoints:function(a,c,g){var f=n.map(a,function(a){return a.toJson()}),h=a[0].spatialReference,f=d.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:k.toJson(h.toJson()),polygons:k.toJson(f)}),l=this._labelPointsHandler,m=this._errorHandler,
w=new r(b._dfdCanceller);w._pendingDfd=e({url:this._url.path+"/labelPoints",content:f,callbackParamName:"callback",load:function(b,d){l(b,d,a,h,c,g,w)},error:function(a){m(a,g,w)}});return w},_labelPointsHandler:function(a,b,c,d,e,g,h){try{var k=[];n.forEach(a.labelPoints,function(a){k.push(f.fromJson(a).setSpatialReference(d))});this._successHandler([k],"onLabelPointsComplete",e,h)}catch(l){this._errorHandler(l,g,h)}},onLabelPointsComplete:function(){},relation:function(a,c,g){a=d.mixin({},this._url.query,
{f:"json"},a.toJson());var f=this._relationHandler,h=this._errorHandler,k=new r(b._dfdCanceller);k._pendingDfd=e({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,b){f(a,b,c,g,k)},error:function(a){h(a,g,k)}});return k},_relationHandler:function(a,b,c,d,e){try{this._successHandler([a.relations],"onRelationComplete",c,e)}catch(g){this._errorHandler(g,d,e)}},onRelationComplete:function(){},trimExtend:function(a,c,g){var f=d.mixin({},this._url.query,{f:"json"},a.toJson()),
h=a.sr,k=this._trimExtendHandler,l=this._errorHandler,m=new r(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/trimExtend",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,c,g,m)},error:function(a){l(a,g,m)}});return m},_trimExtendHandler:function(a,b,c,d,e,g){try{var f=a.geometries;a=[];var h,k=f.length;for(h=0;h<k;h++)a[h]=new v({spatialReference:c,paths:f[h].paths});this._successHandler([a],"onTrimExtendComplete",d,g)}catch(l){this._errorHandler(l,e,g)}},onTrimExtendComplete:function(){},
densify:function(a,c,g){var f=d.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,k=this._densifyHandler,l=this._errorHandler,m=new r(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/densify",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,c,g,m)},error:function(a){l(a,g,m)}});return m},_densifyHandler:function(a,b,c,d,e,g){try{var h=[];n.forEach(a.geometries,function(a){h.push(f.fromJson(a).setSpatialReference(c))});this._successHandler([h],
"onDensifyComplete",d,g)}catch(k){this._errorHandler(k,e,g)}},onDensifyComplete:function(){},generalize:function(a,c,g){var f=d.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,k=this._generalizeHandler,l=this._errorHandler,m=new r(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+"/generalize",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,c,g,m)},error:function(a){l(a,g,m)}});return m},_generalizeHandler:function(a,b,c,d,e,g){try{var h=[];
n.forEach(a.geometries,function(a){h.push(f.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onGeneralizeComplete",d,g)}catch(k){this._errorHandler(k,e,g)}},onGeneralizeComplete:function(){},offset:function(a,c,g){var f=d.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,k=this._offsetHandler,m=this._errorHandler,l=new r(b._dfdCanceller);l._pendingDfd=e({url:this._url.path+"/offset",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,c,
g,l)},error:function(a){m(a,g,l)}});return l},_offsetHandler:function(a,b,c,d,e,g){try{var h=[];n.forEach(a.geometries,function(a){h.push(f.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onOffsetComplete",d,g)}catch(k){this._errorHandler(k,e,g)}},onOffsetComplete:function(){},distance:function(a,c,g){var f=d.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometry1.spatialReference,k=this._distanceHandler,l=this._errorHandler,m=new r(b._dfdCanceller);m._pendingDfd=e({url:this._url.path+
"/distance",content:f,callbackParamName:"callback",load:function(a,b){k(a,b,h,c,g,m)},error:function(a){l(a,g,m)}});return m},_distanceHandler:function(a,b,c,d,e,g){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",d,g)}catch(f){this._errorHandler(f,e,g)}},onDistanceComplete:function(){}});d.mixin(h,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});q("extend-esri")&&d.setObject("tasks.GeometryService",h,l);return h})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a){function p(a){return eval("("+a+")")}function u(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<z){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=z}return b}function t(a,b){var c=a.join();if(!x[c]){for(var d=[],e=0,g=a.length;e<g;e++){var f=a[e];d[d.length]=x[f]=x[f]||n.getObject(f)||~f.indexOf("/")&&(b?b(f):h(f))}e=d.shift();x[c]=d.length?e.createSubclass?e.createSubclass(d):e.extend.apply(e,d):e}return x[c]}
new Date("X");var z=0;b.after(n,"extend",function(){z++},!0);var x={},y={_clearCache:function(){z++;x={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),g=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);g&&g.length&&k.forEach(g.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var e=(c.scope||d._scopeName)+"Type",g="data-"+(c.scope||d._scopeName)+"-",f=g+
"type",h=g+"mixins",m=[];k.forEach(a,function(a){var c=e in b?b[e]:a.getAttribute(f)||a.getAttribute(e);if(c){var d=a.getAttribute(h),c=d?[c].concat(d.split(/\s*,\s*/)):[c];m.push({node:a,types:c})}});return this._instantiate(m,b,c)},_instantiate:function(a,b,d,e){function g(a){!b._started&&!d.noStart&&k.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=k.map(a,function(a){var c=a.ctor||t(a.types,d.contextRequire);if(!c)throw Error("Unable to resolve constructor for: '"+
a.types.join()+"'");return this.construct(c,a.node,b,d,a.scripts,a.inherited)},this);return e?c(a).then(g):g(a)},construct:function(a,c,h,l,q,r){function t(a){U&&n.setObject(U,a);for(D=0;D<M.length;D++)b[M[D].advice||"after"](a,M[D].method,n.hitch(a,M[D].func),!0);for(D=0;D<V.length;D++)V[D].call(a);for(D=0;D<O.length;D++)a.watch(O[D].prop,O[D].func);for(D=0;D<P.length;D++)f(a,P[D].event,P[D].func);return a}var x=a&&a.prototype;l=l||{};var y={};l.defaults&&n.mixin(y,l.defaults);r&&n.mixin(y,r);var v;
g("dom-attributes-explicit")?v=c.attributes:g("dom-attributes-specified-flag")?v=k.filter(c.attributes,function(a){return a.specified}):(r=(/^input$|^img$/i.test(c.nodeName)?c:c.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),v=k.map(r.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==c.nodeName&&"value"==a||"enctype"==b?c.getAttribute(b):c.getAttributeNode(b).value}}));var z=l.scope||d._scopeName;
r="data-"+z+"-";var C={};"dojo"!==z&&(C[r+"props"]="data-dojo-props",C[r+"type"]="data-dojo-type",C[r+"mixins"]="data-dojo-mixins",C[z+"type"]="dojoType",C[r+"id"]="data-dojo-id");for(var D=0,E,z=[],U,J;E=v[D++];){var F=E.name,H=F.toLowerCase();E=E.value;switch(C[H]||H){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":J=E;break;case "data-dojo-id":case "jsid":U=E;break;case "data-dojo-attach-point":case "dojoattachpoint":y.dojoAttachPoint=E;break;case "data-dojo-attach-event":case "dojoattachevent":y.dojoAttachEvent=
E;break;case "class":y["class"]=c.className;break;case "style":y.style=c.style&&c.style.cssText;break;default:if(F in x||(F=u(a)[H]||F),F in x)switch(typeof x[F]){case "string":y[F]=E;break;case "number":y[F]=E.length?Number(E):NaN;break;case "boolean":y[F]="false"!=E.toLowerCase();break;case "function":""===E||-1!=E.search(/[^\w\.]+/i)?y[F]=new Function(E):y[F]=n.getObject(E,!1)||new Function(E);z.push(F);break;default:H=x[F],y[F]=H&&"length"in H?E?E.split(/\s*,\s*/):[]:H instanceof Date?""==E?new Date(""):
"now"==E?new Date:s.fromISOString(E):H instanceof e?d.baseUrl+E:p(E)}else y[F]=E}}for(v=0;v<z.length;v++)C=z[v].toLowerCase(),c.removeAttribute(C),c[C]=null;if(J)try{J=p.call(l.propsThis,"{"+J+"}"),n.mixin(y,J)}catch(X){throw Error(X.toString()+" in data-dojo-props\x3d'"+J+"'");}n.mixin(y,h);q||(q=a&&(a._noScript||x._noScript)?[]:m("\x3e script[type^\x3d'dojo/']",c));var M=[],V=[],O=[],P=[];if(q)for(D=0;D<q.length;D++)C=q[D],c.removeChild(C),h=C.getAttribute(r+"event")||C.getAttribute("event"),l=
C.getAttribute(r+"prop"),J=C.getAttribute(r+"method"),z=C.getAttribute(r+"advice"),v=C.getAttribute("type"),C=this._functionFromScript(C,r),h?"dojo/connect"==v?M.push({method:h,func:C}):"dojo/on"==v?P.push({event:h,func:C}):y[h]=C:"dojo/aspect"==v?M.push({method:J,advice:z,func:C}):"dojo/watch"==v?O.push({prop:l,func:C}):V.push(C);a=(q=a.markupFactory||x.markupFactory)?q(y,c,a):new a(y,c);return a.then?a.then(t):t(a)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=
c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(r)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var e=[],f=[],l={},m=(b.scope||d._scopeName)+"Type",p="data-"+(b.scope||d._scopeName)+"-",n=p+"type",r=p+"textdir",p=p+"mixins",q=a.firstChild,s=b.inherited;if(!s){var u=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&u(a.parentNode,b)},s={dir:u(a,"dir"),lang:u(a,"lang"),textDir:u(a,r)},x;for(x in s)s[x]||
delete s[x]}for(var s={inherited:s},y,z;;)if(q)if(1!=q.nodeType)q=q.nextSibling;else if(y&&"script"==q.nodeName.toLowerCase())(F=q.getAttribute("type"))&&/^dojo\/\w/i.test(F)&&y.push(q),q=q.nextSibling;else if(z)q=q.nextSibling;else{var F=q.getAttribute(n)||q.getAttribute(m);x=q.firstChild;if(!F&&(!x||3==x.nodeType&&!x.nextSibling))q=q.nextSibling;else{z=null;if(F){var H=q.getAttribute(p);y=H?[F].concat(H.split(/\s*,\s*/)):[F];try{z=t(y,b.contextRequire)}catch(X){}z||k.forEach(y,function(a){~a.indexOf("/")&&
!l[a]&&(l[a]=!0,f[f.length]=a)});H=z&&!z.prototype._noScript?[]:null;s={types:y,ctor:z,parent:s,node:q,scripts:H};s.inherited=c(s);e.push(s)}else s={node:q,scripts:y,parent:s};y=H;z=q.stopParser||z&&z.prototype.stopParser&&!b.template;q=x}}else{if(!s||!s.node)break;q=s.node.nextSibling;z=!1;s=s.parent;y=s.scripts}var M=new v;f.length?(g("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+f.join(", ")),(b.contextRequire||h)(f,function(){M.resolve(k.filter(e,function(a){if(!a.ctor)try{a.ctor=
t(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):M.resolve(e);return M.promise},_require:function(a,b){var c=p("{"+a.innerHTML+"}"),d=[],e=[],g=new v,f=b&&b.contextRequire||h,k;for(k in c)d.push(k),e.push(c[k]);f(e,function(){for(var a=0;a<d.length;a++)n.setObject(d[a],arguments[a]);g.resolve(arguments)});
return g.promise},_scanAmd:function(a,b){var c=new v,d=c.promise;c.resolve(!0);var e=this;m("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,b){var c;!b&&a&&a.rootNode?(b=a,c=b.rootNode):a&&n.isObject(a)&&!("nodeType"in a)?b=a:c=a;c=c?q.byId(c):l.body();b=b||{};var d=b.template?{template:!0}:{},e=[],g=this,f=this._scanAmd(c,b).then(function(){return g.scan(c,b)}).then(function(a){return g._instantiate(a,
d,b,!0)}).then(function(a){return e=e.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});n.mixin(e,f);return e}};d.parser=y;r.parseOnLoad&&a(100,y,"parse");return y})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(h,d,n,k,r,q,l,e,b,c,s,v,g){function m(){}
function f(a){return function(b,c,d,e){return b&&"string"==typeof c&&b[c]==m?b.on(c.substring(2).toLowerCase(),l.hitch(d,e)):a.apply(n,arguments)}}h.around(n,"connect",f);q.connect&&h.around(q,"connect",f);h=k("dijit._Widget",[s,v,g],{onClick:m,onDblClick:m,onKeyDown:m,onKeyPress:m,onKeyUp:m,onMouseDown:m,onMouseMove:m,onMouseOut:m,onMouseOver:m,onMouseLeave:m,onMouseEnter:m,onMouseUp:m,constructor:function(a){this._toConnect={};for(var b in a)this[b]===m&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=
a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===m?n.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){q.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,b)},attr:function(a,
b){if(d.isDebug){var c=arguments.callee._ach||(arguments.callee._ach={}),e=(arguments.callee.caller||"unknown caller").toString();c[e]||(q.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+e,"","2.0"),c[e]=!0)}return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){q.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?
e("[widgetId]",this.containerNode).map(c.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});r("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});return h})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-class dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a,p){var u,t=new (d([v,l],{curNode:null,activeStack:[],constructor:function(){var a=e.hitch(this,function(a){n.isDescendant(this.curNode,a)&&this.set("curNode",null);n.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});h.before(r,"empty",a);h.before(r,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,c){var d=this,e=a.document&&a.document.body;if(e){var g=b(a.document,"mousedown, touchstart",function(a){d._justMouseDowned=
!0;setTimeout(function(){d._justMouseDowned=!1},0);if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),h=b(e,"focusin",function(a){u=(new Date).getTime();if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(f.isTabNavigable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),k=b(e,"focusout",function(a){(new Date).getTime()<u+100||d._onBlurNode(c||a.target)});return{remove:function(){g.remove();h.remove();k.remove();
e=g=h=k=null}}}},_onBlurNode:function(a){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(e.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0);this._justMouseDowned||(this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),this._clearActiveWidgetsTimer=setTimeout(e.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0))},_onTouchNode:function(b,c){this._clearActiveWidgetsTimer&&
(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);var d=[];try{b&&(q.contains(b,"dijitMenuPopup")&&!b.getAttribute("dijitPopupParent"))&&(b=b.firstChild);for(;b;){var e=k.get(b,"dijitPopupParent");if(e)b=a.byId(e).domNode;else if(b.tagName&&"body"==b.tagName.toLowerCase()){if(b===g.body())break;b=m.get(b.ownerDocument).frameElement}else{var f=b.getAttribute&&b.getAttribute("widgetId"),h=f&&a.byId(f);h&&!("mouse"==c&&h.get("disabled"))&&d.unshift(f);b=b.parentNode}}}catch(l){}this._setStack(d,
c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(b,c){var d=this.activeStack,e=d.length-1,g=b.length-1;if(b[g]!=d[e]){this.set("activeStack",b);var f;for(f=e;0<=f&&d[f]!=b[f];f--)if(e=a.byId(d[f]))e._hasBeenBlurred=!0,e.set("focused",!1),e._focusManager==this&&e._onBlur(c),this.emit("widget-blur",
e,c);for(f++;f<=g;f++)if(e=a.byId(b[f]))e.set("focused",!0),e._focusManager==this&&e._onFocus(c),this.emit("widget-focus",e,c)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));c(function(){var a=t.registerWin(m.get(document));s("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});p.focus=function(a){t.focus(a)};for(var z in t)/^_/.test(z)||(p.focus[z]="function"==typeof t[z]?e.hitch(t,z):t[z]);t.watch(function(a,b,c){p.focus[a]=c});return t})},"dijit/_FocusMixin":function(){define(["./focus",
"./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(h,d,n,k){k.extend(d,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return n("dijit._FocusMixin",null,{_focusManager:h})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang esri/geometry/Point".split(" "),function(h,d,n,k,r,q,l){var e=h(null,{declaredClass:"esri.layers.MosaicRule",
method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,constructor:function(b){d.isObject(b)&&(d.mixin(this,b),b.mosaicMethod&&(this.method=b.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),b.mosaicOperation&&(this.operation=b.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),
b.fids&&(this.objectIds=b.fids),b.viewpoint&&(this.viewpoint=new l(b.viewpoint)))},toJson:function(){var b={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation};return q.filter(b,function(b){if(null!==b)return!0})},_getMethodEnum:function(b){if(b){var c=e.METHOD_NONE;switch(b.toLowerCase()){case "byattribute":c=
e.METHOD_ATTRIBUTE;break;case "center":c=e.METHOD_CENTER;break;case "lockraster":c=e.METHOD_LOCKRASTER;break;case "nadir":c=e.METHOD_NADIR;break;case "northwest":c=e.METHOD_NORTHWEST;break;case "seamline":c=e.METHOD_SEAMLINE;break;case "viewpoint":c=e.METHOD_VIEWPOINT}return c}},_getOperatorEnum:function(b){if(b)switch(b.toLowerCase()){case "first":return e.OPERATION_FIRST;case "last":return e.OPERATION_LAST;case "max":return e.OPERATION_MAX;case "min":return e.OPERATION_MIN;case "blend":return e.OPERATION_BLEND;
case "mean":return e.OPERATION_MEAN}}});d.mixin(e,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});k("extend-esri")&&
d.setObject("layers.MosaicRule",e,r);return e})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has esri/kernel esri/request esri/deferredUtils esri/geometry/normalizeUtils esri/tasks/Task esri/tasks/FeatureSet".split(" "),function(h,d,n,k,r,q,l,e,b,c,s,v){h=h(s,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],
"execute-relationship-query-complete":["featureSets"]},constructor:function(b,c){this._handler=d.hitch(this,this._handler);this._relationshipQueryHandler=d.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=d.hitch(this,this._executeForIdsHandler);this._countHandler=d.hitch(this,this._countHandler);this._extentHandler=d.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(b,c,f,a,h){var k=h.assembly;b=this._encode(d.mixin({},this._url.query,{f:"json"},b.toJson(k&&k[0])));var l=this._handler,n=this._errorHandler;
this.source&&(k={source:this.source.toJson()},b.layer=r.toJson(k));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return e({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(a,b){l(a,b,c,f,h.dfd)},error:function(a){n(a,f,h.dfd)},callbackSuffix:a},this.requestOptions)},executeRelationshipQuery:function(c,h,f){c=this._encode(d.mixin({},this._url.query,{f:"json"},c.toJson()));var a=this._relationshipQueryHandler,l=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);
var n=new k(b._dfdCanceller);n._pendingDfd=e({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(b,c){a(b,c,h,f,n)},error:function(a){l(a,f,n)}},this.requestOptions);return n},executeForIds:function(b,c,f,a){var h=a.assembly;b=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},b.toJson(h&&h[0])));var k=this._executeForIdsHandler,l=this._errorHandler;this.source&&(h={source:this.source.toJson()},b.layer=r.toJson(h));this.gdbVersion&&(b.gdbVersion=
this.gdbVersion);return e({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,d){k(b,d,c,f,a.dfd)},error:function(b){l(b,f,a.dfd)}},this.requestOptions)},executeForCount:function(b,c,f,a){var h=a.assembly;b=this._encode(d.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(h&&h[0])));var k=this._countHandler,l=this._errorHandler;this.source&&(h={source:this.source.toJson()},b.layer=r.toJson(h));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);
return e({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,d){k(b,d,c,f,a.dfd)},error:function(b){l(b,f,a.dfd)}},this.requestOptions)},executeForExtent:function(b,c,f,a){var h=a.assembly;b=this._encode(d.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(h&&h[0])));var k=this._extentHandler,l=this._errorHandler;this.source&&(h={source:this.source.toJson()},b.layer=r.toJson(h));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return e({url:this._url.path+
"/query",content:b,callbackParamName:"callback",load:function(b,d){k(b,d,c,f,a.dfd)},error:function(b){l(b,f,a.dfd)}},this.requestOptions)},_handler:function(b,c,d,a,e){try{var h=new v(b);this._successHandler([h],"onComplete",d,e)}catch(k){this._errorHandler(k,a,e)}},_relationshipQueryHandler:function(b,c,d,a,e){try{var h=b.geometryType,k=b.spatialReference,l={};n.forEach(b.relatedRecordGroups,function(a){var b={};b.geometryType=h;b.spatialReference=k;b.features=a.relatedRecords;b=new v(b);l[a.objectId]=
b});this._successHandler([l],"onExecuteRelationshipQueryComplete",d,e)}catch(q){this._errorHandler(q,a,e)}},_executeForIdsHandler:function(b,c,d,a,e){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",d,e)}catch(h){this._errorHandler(h,a,e)}},_countHandler:function(b,c,d,a,e){try{var h,k=b.features,l=b.objectIds;if(l)h=l.length;else{if(k)throw Error("Unable to perform query. Please check your parameters.");h=b.count}this._successHandler([h],"onExecuteForCountComplete",d,e)}catch(n){this._errorHandler(n,
a,e)}},_extentHandler:function(b,c,d,a,e){try{this._successHandler([b],"onExecuteForExtentComplete",d,e)}catch(h){this._errorHandler(h,a,e)}}});c._createWrappers(h);q("extend-esri")&&d.setObject("tasks.QueryTask",h,l);return h})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/has dojo/io-query esri/kernel esri/config esri/lang esri/request esri/deferredUtils esri/urlUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/layers/MosaicRule esri/layers/DynamicMapServiceLayer esri/layers/TimeInfo esri/layers/Field esri/graphic esri/tasks/ImageServiceIdentifyTask esri/tasks/ImageServiceIdentifyParameters esri/geometry/Polygon".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a,p,u,t,z,x,y,w,A,B){h=h(t,{declaredClass:"esri.layers.ArcGISImageServiceLayer",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this._url=m.urlToObject(a);var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this._params=
d.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this._initLayer=d.hitch(this,this._initLayer);this._queryVisibleRastersHandler=d.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this.useMapImage=b&&b.useMapImage||!1;this.infoTemplate=b&&b.infoTemplate;this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=
b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):v({url:this._url.path,content:d.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,e=this.maxScale;d.mixin(this,a);this.minScale=c;this.maxScale=e;this.initialExtent=this.fullExtent=this.extent=
new f(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var g=this.minValues,h=this.maxValues,k=this.meanValues,l=this.stdvValues,m=this.bands=[],c=0,e=this.bandCount;c<e;c++)m[c]={min:g[c],max:h[c],mean:k[c],stddev:l[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new z(c):null;e=this.fields=[];if(g=a.fields)for(c=0;c<g.length;c++)e.push(new x(g[c]));this.version=a.currentVersion;this.version||
(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);s.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);s.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=u.METHOD_NONE;this.defaultMosaicRule=new u(c);this.defaultMosaicRule.ascending=!0;10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(d.hitch(this,
function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=d.clone(a.fields))}));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new n(g._dfdCanceller);10<this.version?(b._pendingDfd=v({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=q.isDebug,b.errback(a));return b},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",b=new n(g._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(b._pendingDfd=v({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=q.isDebug,
b.errback(a));return b},_getRasterAttributeTableFeatures:function(){var a=new n;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(d.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var b=
a?a.rasterAttributeTableFieldPrefix:"",c={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?d.clone(this.fields):[];var e=a.length;a[e]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a[e+1]=c;this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&
(c=k.filter(this._rasterAttributeTableFields,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),c=k.map(c,function(a){var c=d.clone(a);c.name=b+a.name;return c}),a=a.concat(c));return a},getImageUrl:function(a,b,g,f){var h=a.spatialReference.wkid||r.toJson(a.spatialReference.toJson());delete this._params._ts;var k=this._url.path+"/exportImage?";d.mixin(this._params,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:b+","+g},this.disableClientCaching?
{_ts:(new Date).getTime()}:{});var l=this._params.token=this._getToken();a=m.addProxy(k+e.objectToQuery(d.mixin(this._params,{f:"image"})));a.length>c.defaults.io.postLength||this.useMapImage?this._jsonRequest=v({url:k,content:d.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;l&&(c+=-1===c.indexOf("?")?"?token\x3d"+l:"\x26token\x3d"+l);f(m.addProxy(c))},error:this._errorHandler}):f(a)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=
a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=r.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?r.toJson(a.toJson()):null;if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=u.METHOD_NONE);c.where=a;c=new u(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=
b}},exportMapImage:function(a,b){var e=c.defaults.map,e=d.mixin({size:e.width+","+e.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete e._ts;this._exportMapImage(this._url.path+"/exportImage",e,b)},queryVisibleRasters:function(b,c,d,e){var f=this._map,h=g._fixDfd(new n(g._dfdCanceller));this._visibleRasters=[];var k,l,m=!0;if(this.infoTemplate&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){m=!1;for(k=0;k<this.infoTemplate.info.fieldInfos.length;k++)(l=
this.infoTemplate.info.fieldInfos[k])&&(l.visible&&"raster.servicepixelvalue"!==l.fieldName.toLowerCase())&&(m=!0)}k=new A;k.geometry=b.geometry.getCenter();k.returnGeometry=this._map.spatialReference.equals(this.spatialReference);k.returnCatalogItems=m;k.timeExtent=b.timeExtent;k.mosaicRule=this.mosaicRule?this.mosaicRule:null;k.renderingRule=this.renderingRule?this.renderingRule:null;f&&(b=new a((f.extent.xmax-f.extent.xmin)/(2*f.width),(f.extent.ymax-f.extent.ymin)/(2*f.height),f.extent.spatialReference),
k.pixelSize=b);var p=this;b=new w(this.url);(h._pendingDfd=b.execute(k)).addCallbacks(function(a){p._queryVisibleRastersHandler(a,c,d,e,h)},function(a){p._resolve([a],null,e,h,!0)});return h},_queryVisibleRastersHandler:function(a,b,c,e,g){function h(){var a=this.getCustomRasterFields(b),e=this._getDomainFields(a),f=b?b.returnDomainValues:!1,p=b&&b.rasterAttributeTableFieldPrefix,q,r,t,v,u,y,x,B;this._getRasterAttributeTableFeatures().then(d.hitch(this,function(a){for(q=0;q<l.length;q++){w=l[q];w.setInfoTemplate(this.infoTemplate);
if(m&&(r=m,n&&n.length>=q&&(t=n[q],r=t.replace(/ /gi,", ")),w.attributes["Raster.ItemPixelValue"]=r,w.attributes["Raster.ServicePixelValue"]=m,a&&0<a.length&&(v=k.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==r:a.attributes.VALUE==r}),0<v.length&&(u=d.clone(v[0]),p&&u)))){B={};for(y in u.attributes)u.attributes.hasOwnProperty(y)&&(x=p+y,B[x]=u.attributes[y]);u.attributes=B;w.attributes=d.mixin(w.attributes,u.attributes)}f&&(e&&0<e.length)&&
k.forEach(e,function(a){if(a){var b=w.attributes[a.name];s.isDefined(b)&&(b=this._getDomainValue(a.domain,b),s.isDefined(b)&&(w.attributes[a.name]=b))}},this);A.push(w);this._visibleRasters.push(w)}this._resolve([A,null,!0],null,c,g)}))}var l=a.features,m=a.value,n;e=[];var p=0,q=0,t=this;a.catalogItems&&(l=a.catalogItems.features,n=a.properties.Values);this._visibleRasters=[];var w,u=this.objectIdField;a=-1<m.toLowerCase().indexOf("nodata");m&&(!l&&!a)&&(u="ObjectId",l=[],w=new y(new f(this.fullExtent),
null,{ObjectId:0}),l.push(w));a=this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length;var A=[];if(l){if(a)for(p=0;p<l.length;p++)e.push(l[p].attributes[u]);!this._map.spatialReference.equals(this.spatialReference)&&0<e.length?v({url:this._url.path+"/query",content:{f:"json",objectIds:e.join(","),returnGeometry:!0,outSR:r.toJson(t._map.spatialReference.toJson()),outFields:u},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)t._resolve([A,
null,null],null,c,g);else{for(p=0;p<a.features.length;p++)for(q=0;q<l.length;q++)l[q].attributes[u]==a.features[p].attributes[u]&&(l[q].geometry=new B(a.features[p].geometry),l[q].geometry.setSpatialReference(t._map.spatialReference));h.call(t)}},error:function(a){t._resolve([A,null,null],null,c,g)}}):h.call(this)}else this._resolve([A,null,null],null,c,g)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=
[];k.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;k.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&g._resDfd(d,a,e)}});l("extend-esri")&&d.setObject("layers.ArcGISImageServiceLayer",h,b);return h})},"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore esri/kernel esri/config esri/request esri/SpatialReference esri/geometry/Geometry esri/geometry/jsonUtils esri/geometry/webMercatorUtils".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g){function m(a){var b=0,c="";d.forEach([","," ",";","|","\t"],function(d){var e=a.split(d).length;e>b&&(b=e,c=d)});return c}function f(a,b){if(!a||"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime()))return!1;var c=!0;if(k("chrome")&&/\d+\W*$/.test(b)){var d=b.match(/[a-zA-Z]{2,}/);if(d){for(var c=!1,e=0,f=d.length,g=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;!c&&
e<=f&&!(c=!g.test(d[e]));)e++;c=!c}}return c}function a(a,b,c){var e=a.indexOf("\n"),e=h.trim(a.substr(0,e)),g=b.columnDelimiter;g||(g=m(e));var l=new q({data:a,separator:g});a=9>k("ie")?750:1001;l.fetch({start:0,count:a,onComplete:function(a,e){var g=0,h={layerDefinition:b.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},k=h.layerDefinition.objectIdField;!k&&!d.some(h.layerDefinition.fields,function(a){return"esriFieldTypeOID"==a.type?(k=a.name,!0):!1})&&(h.layerDefinition.fields.push({name:"__OBJECTID",
alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}),k="__OBJECTID");var m,n,p=l._attributes,q=[],s=[];d.forEach(h.layerDefinition.fields,function(a,b){"esriFieldTypeDate"===a.type?q.push(a.name):("esriFieldTypeDouble"===a.type||"esriFieldTypeInteger"===a.type)&&s.push(a.name)});b.locationInfo&&"coordinates"===b.locationInfo.locationType?(m=b.locationInfo.latitudeFieldName,n=b.locationInfo.longitudeFieldName):d.forEach(p,function(a){var b;b=d.indexOf(z,a.toLowerCase());-1!==b&&(m=
a);b=d.indexOf(x,a.toLowerCase());-1!==b&&(n=a)},this);if(!m||!n)setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},1),c&&c(null,Error("File does not seem to contain fields with point coordinates."));else{-1===d.indexOf(s,m)&&s.push(m);-1===d.indexOf(s,n)&&s.push(n);var p=0,t=a.length;for(p;p<t;p++){if(1E3<=h.featureSet.features.length){setTimeout(function(){console.error("1000 feature limit reached. Unable to load any more data.")},1);break}var u=
a[p],v=l.getAttributes(u),y={};d.forEach(v,function(a,b){if(a){var c=a;0===a.length&&d.forEach(h.layerDefinition.fields,function(b,c){b.name==="attribute_"+(c-1)&&(a="attribute_"+(c-1))});if(-1<d.indexOf(q,a)){var c=l.getValue(u,c),e=new Date(c);y[a]=f(e,c)?e.getTime():null}else if(-1<d.indexOf(s,a)){e=r.parse(l.getValue(u,c));if((a==m||a==n)&&(isNaN(e)||181<Math.abs(e)))e=parseFloat(l.getValue(u,c));isNaN(e)?y[a]=null:y[a]=e}else y[a]=l.getValue(u,c)}});y[k]=g;g++;var v=y[m],B=y[n];null==B||(null==
v||isNaN(v)||isNaN(B))||h.featureSet.features.push({geometry:{x:B,y:v,spatialReference:{wkid:4326}},attributes:y})}h.layerDefinition.name="csv";c&&c(h)}},onError:function(a){console.error("Error fetching items from CSV store: ",a);c&&c(null,a)}});return!0}function p(a,b,c,f,k,l){0===a.length&&k(null);var m=v.getGeometryType(b),n=[];d.forEach(a,function(a){a=new m(a);a.spatialReference=c;n.push(a)},this);b=[102113,102100,3857];c.wkid&&4326===c.wkid&&f.wkid&&-1<d.indexOf(b,f.wkid)?(d.forEach(n,function(a){a.xmin?
(a.xmin=Math.max(a.xmin,-180),a.xmax=Math.min(a.xmax,180),a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99)):a.rings?d.forEach(a.rings,function(a){d.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.paths?d.forEach(a.paths,function(a){d.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.x&&(a.x=Math.min(Math.max(a.x,-180),180),a.y=Math.min(Math.max(a.y,
-89.99),89.99))},this),a=[],d.forEach(n,function(b){b=g.geographicToWebMercator(b);102100!==f.wkid&&(b.spatialReference=f);a.push(b.toJson())},this),k(a)):null!==c.wkid&&-1<d.indexOf(b,c.wkid)&&null!==f.wkid&&4326===f.wkid?(a=[],d.forEach(n,function(b){a.push(g.webMercatorToGeographic(b).toJson())},this),k(a)):(b=function(b,c){b&&b.length===a.length?(a=[],d.forEach(b,function(b){b&&(b.rings&&0<b.rings.length&&0<b.rings[0].length&&0<b.rings[0][0].length&&!isNaN(b.rings[0][0][0])&&!isNaN(b.rings[0][0][1])||
b.paths&&0<b.paths.length&&0<b.paths[0].length&&0<b.paths[0][0].length&&!isNaN(b.paths[0][0][0])&&!isNaN(b.paths[0][0][1])||b.xmin&&!isNaN(b.xmin)&&b.ymin&&!isNaN(b.ymin)||b.x&&!isNaN(b.x)&&b.y&&!isNaN(b.y))?a.push(b.toJson()):a.push(null)},this),k(a)):l(b,c)},e.defaults.geometryService?e.defaults.geometryService.project(n,f,h.hitch(this,b),l):k(null))}function u(a,b){var c=[102113,102100,3857];return a&&b&&a.wkid===b.wkid&&a.wkt===b.wkt||a&&b&&a.wkid&&b.wkid&&-1<d.indexOf(c,a.wkid)&&-1<d.indexOf(c,
b.wkid)?!0:!1}function t(a,b,e,f){if(a.featureSet&&0!==a.featureSet.features.length)if(u(e,b))f(a);else{var g=function(b){var c=[];d.forEach(a.featureSet.features,function(a,d){b[d]&&(a.geometry=b[d],c.push(a))},this);f(a)},k=function(b,c){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Final try.");f(a)},l=function(c,d){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Try one more time.");p(m,a.featureSet.geometryType,b,e,h.hitch(this,g),h.hitch(this,
k))};if(a.featureSet.features&&0<a.featureSet.features.length){var m=[];d.forEach(a.featureSet.features,function(b){if(b.geometry.toJson)m.push(b.geometry);else{var c=v.getGeometryType(a.featureSet.geometryType);m.push(new c(b.geometry))}});b.toJson||(b=new c(b));e.toJson||(e=new c(e));p(m,a.featureSet.geometryType,b,e,h.hitch(this,g),h.hitch(this,l))}else f(a)}}var z="lat latitude y ycenter latitude83 latdecdeg POINT-Y".split(" "),x="lon lng long longitude x xcenter longitude83 longdecdeg POINT-X".split(" ");
s={latFieldStrings:z,longFieldStrings:x,buildCSVFeatureCollection:function(c){var d=new n,e=function(a,b){b?d.errback(b):d.callback(a)};b({url:c.url,handleAs:"text",load:function(b){a(b,c,h.hitch(this,e))},error:function(a){d.errback(a);console.error("error: "+a)}},{usePost:!1});return d},projectFeatureCollection:function(a,b,d){var e=new n;d||(d=new c({wkid:4326}));t(a,d,b,h.hitch(this,function(a){e.callback(a)}));return e},generateDefaultPopupInfo:function(a){var b={esriFieldTypeDouble:1,esriFieldTypeSingle:1},
c={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},e={esriFieldTypeDate:1},f=null;a=d.map(a.layerDefinition.fields,h.hitch(this,function(a){"NAME"===a.name.toUpperCase()&&(f=a.name);var d="esriFieldTypeOID"!==a.type&&"esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeGeometry"!==a.type,g=null;if(d){var k=a.name.toLowerCase();if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+k+",")||-1<k.indexOf("area")||-1<k.indexOf("length")||-1<k.indexOf("shape")||
-1<k.indexOf("perimeter")||-1<k.indexOf("objectid")||k.indexOf("_")===k.length-1||k.indexOf("_i")===k.length-2&&1<k.length)d=!1;a.type in c?g={places:0,digitSeparator:!0}:a.type in b?g={places:2,digitSeparator:!0}:a.type in e&&(g={dateFormat:"shortDateShortTime"})}return h.mixin({},{fieldName:a.name,label:a.alias,isEditable:!0,tooltip:"",visible:d,format:g,stringFieldOption:"textbox"})}));return{title:f?"{"+f+"}":"",fieldInfos:a,description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:m,
_isValidDate:f,_processCsvData:a,_projectGeometries:p,_sameSpatialReference:u,_projectFeatureSet:t};k("extend-esri")&&h.setObject("arcgis.csv",s,l);return s})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(h,d,n){return n("dijit.Destroyable",null,{destroy:function(d){this._destroyed=!0},own:function(){h.forEach(arguments,function(h){var n="destroyRecursive"in h?"destroyRecursive":"destroy"in h?"destroy":"remove",q=d.before(this,"destroy",function(d){h[n](d)}),
l=d.after(h,n,function(){q.remove();l.remove()},!0)},this);return arguments}})})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(h,d,n,k){h=h(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(h){h&&d.isObject(h)&&(this.objectId=h.objectId,this.success=h.success,h.success||(h=h.error,this.error=Error(),this.error.code=h.code,this.error.message=h.description))}});n("extend-esri")&&d.setObject("layers.FeatureEditResult",
h,k);return h})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(h){return h.cache})},"esri/tasks/query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has esri/kernel esri/geometry/jsonUtils esri/tasks/SpatialRelationship dojo/has!extend-esri?esri/tasks/QueryTask dojo/has!extend-esri?esri/tasks/RelationshipQuery dojo/has!extend-esri?esri/tasks/StatisticDefinition".split(" "),function(h,d,n,k,r,q,l,e){var b=h(null,{declaredClass:"esri.tasks.Query",
constructor:function(){this.spatialRelationship=b.SPATIAL_REL_INTERSECTS},text:null,where:"",geometry:null,groupByFieldsForStatistics:null,objectIds:null,returnGeometry:!1,orderByFields:null,outSpatialReference:null,outFields:null,outStatistics:null,timeExtent:null,relationParam:null,pixelSize:null,distance:null,units:null,resultOffset:null,resultRecordCount:null,_units:{meters:"esriSRUnit_Meter",kilometers:"esriSRUnit_Kilometer",feet:"esriSRUnit_Foot",miles:"esriSRUnit_StatuteMile","nautical-miles":"esriSRUnit_NauticalMile",
"us-nautical-miles":"esriSRUnit_USNauticalMile"},toJson:function(c){var d={text:this.text,where:this.where,returnGeometry:this.returnGeometry,spatialRel:this.spatialRelationship,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},e=c&&c.geometry||this.geometry,g=this.objectIds,h=this.outFields,f=this.outSpatialReference,a=this.groupByFieldsForStatistics,p=this.orderByFields,q=this.outStatistics;c=this.distance;e&&(d.geometry=e,d.geometryType=l.getJsonType(e),d.inSR=
e.spatialReference.wkid||k.toJson(e.spatialReference.toJson()));g&&(d.objectIds=g.join(","));h&&(d.outFields=h.join(","));a&&(d.groupByFieldsForStatistics=a.join(","));p&&(d.orderByFields=p.join(","));if(q){var r=[];n.forEach(q,function(a,b){r.push(a.toJson())});d.outStatistics=k.toJson(r)}null!==f?d.outSR=f.wkid||k.toJson(f.toJson()):e&&(d.outSR=e.spatialReference.wkid||k.toJson(e.spatialReference.toJson()));e=this.timeExtent;d.time=e?e.toJson().join(","):null;if((e=this.relationParam)&&this.spatialRelationship===
b.SPATIAL_REL_RELATION)d.relationParam=e;c&&(d.distance=this.distance,this.hasOwnProperty("units")?d.units=this._units[this.units]||this._units.meters:(console.warn("esri/tasks/query::no distance unit provided, defaulting to meters"),d.units=this._units.meters));this.hasOwnProperty("start")&&(d.resultOffset=this.start,d.resultRecordCount=10,""===d.where&&(d.where="1\x3d1"));this.hasOwnProperty("num")&&(d.resultRecordCount=this.num);d.pixelSize=this.pixelSize?k.toJson(this.pixelSize.toJson()):null;
d._ts=this._ts;return d}});d.mixin(b,e);r("extend-esri")&&d.setObject("tasks.Query",b,q);return b})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/lang esri/graphic esri/SpatialReference esri/graphicsUtils esri/geometry/jsonUtils esri/symbols/jsonUtils".split(" "),function(h,d,n,k,r,q,l,e,b,c,s){h=h(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(b){if(b){d.mixin(this,b);var g=this.features,h=b.spatialReference,
f=c.getGeometryType(b.geometryType),h=this.spatialReference=new e(h);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);n.forEach(g,function(a,b){var c=a.geometry&&a.geometry.spatialReference;g[b]=new l(f&&a.geometry?new f(a.geometry):null,a.symbol&&s.fromJson(a.symbol),a.attributes);g[b].geometry&&!c&&g[b].geometry.setSpatialReference(h)})}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(d){var e={};this.displayFieldName&&
(e.displayFieldName=this.displayFieldName);this.fields&&(e.fields=this.fields);this.spatialReference?e.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(e.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(e.geometryType=c.getJsonType(this.features[0].geometry)),e.features=b._encodeGraphics(this.features,d));e.exceededTransferLimit=this.exceededTransferLimit;return q.fixJson(e)}});k("extend-esri")&&
d.setObject("tasks.FeatureSet",h,r);return h})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/graphic".split(" "),function(h,d,n,k,r,q){h=h(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(h){h&&d.isObject(h)&&(this.name=h.name,this.description=h.description,this.drawingTool=h.drawingTool,h=h.prototype,this.prototype=new q(h.geometry,null,h.attributes))},toJson:function(){return r.fixJson({name:this.name,
description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()})}});d.mixin(h,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",
TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});n("extend-esri")&&d.setObject("layers.FeatureTemplate",h,k);return h})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has esri/kernel esri/lang".split(" "),function(h,
d,n,k,r,q){h=h(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(d){var e=this.bbox||this.extent;d=(e=e&&d&&e._normalize(!0))?e.spatialReference.wkid||n.toJson(e.spatialReference.toJson()):null;var b=this.imageSpatialReference,e={bbox:e?e.xmin+","+e.ymin+","+e.xmax+","+e.ymax:null,bboxSR:d,
size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:b?b.wkid||n.toJson(b.toJson()):d,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?n.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?n.toJson(this.renderingRule.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation};d=this.timeExtent;e.time=d?d.toJson().join(","):
null;return q.filter(e,function(b){if(null!==b&&void 0!==b)return!0})}});d.mixin(h,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});k("extend-esri")&&d.setObject("layers.ImageServiceParameters",h,r);return h})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","esri/kernel"],function(h,d,n,k){h=h(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});n("extend-esri")&&d.setObject("tasks.StatisticDefinition",h,k);return h})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(h){var d={};h.setObject("dojo.data.util.filter",d);d.patternToRegExp=function(d,h){for(var r="^",q=null,l=0;l<d.length;l++)switch(q=d.charAt(l),q){case "\\":r+=q;l++;r+=d.charAt(l);break;case "*":r+=".*";break;case "?":r+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":r+="\\";default:r+=q}r+="$";return h?RegExp(r,"mi"):RegExp(r,"m")};return d})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct esri/kernel esri/InfoTemplate esri/PopupInfo esri/dijit/PopupRenderer".split(" "),
function(h,d,n,k,r,q,l,e){h=h([q,l],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,c){d.mixin(this,c);this.initialize(b,c)},getTitle:function(b){return this.info?this.getComponents(b).title:""},getContent:function(b){return this.info?(new e({template:this,graphic:b,chartTheme:this.chartTheme},k.create("div"))).domNode:""}});n("extend-esri")&&d.setObject("dijit.PopupTemplate",h,r);return h})},"*noref":1}});
define("esri/arcgis/utils","dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/has dojo/on dojo/DeferredList dojo/dom-construct esri/kernel esri/config esri/lang esri/request esri/SpatialReference esri/map esri/urlUtils esri/geometry/ScreenPoint esri/geometry/Extent esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/renderers/jsonUtils esri/dijit/PopupTemplate esri/dijit/Popup esri/tasks/query esri/tasks/GeometryService esri/arcgis/csv esri/layers/ArcGISTiledMapServiceLayer esri/layers/ArcGISDynamicMapServiceLayer esri/layers/ArcGISImageServiceLayer esri/layers/CSVLayer esri/layers/OpenStreetMapLayer esri/layers/WebTiledLayer esri/layers/FeatureLayer esri/layers/WMSLayer esri/layers/KMLLayer esri/layers/GeoRSSLayer esri/virtualearth/VETiledLayer esri/layers/TileInfo esri/layers/DynamicLayerInfo esri/layers/LayerDrawingOptions esri/layers/ImageParameters esri/layers/ImageServiceParameters esri/layers/RasterFunction esri/layers/MosaicRule esri/layers/WMSLayerInfo dojo/i18n!esri/nls/jsapi".split(" "),
function(h,d,n,k,r,q,l,e,b,c,s,v,g,m,f,a,p,u,t,z,x,y,w,A,B,G,N,K,W,S,Z,T,ga,C,D,E,U,J,F,H,X,M,V,O,P,ha,I){function Y(a){return m({url:L.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function ra(a){var b={f:"json"};if(s.id){var c=s.id.findCredential(p.urlToObject(L.arcgisUrl).path);c&&(b.token=c.token)}return m({url:a,content:b,callbackParamName:"callback"},{disableIdentityLookup:!0})}function sa(a){a.itemProperties.layerDefinition&&
(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),g.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),g.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),g.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):
a.layerDefinition=a.itemProperties.layerDefinition);a.itemProperties.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo);g.isDefined(a.itemProperties.showLegend)&&!g.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);g.isDefined(a.itemProperties.refreshInterval)&&!g.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}function $(a,c){var e=new k,f=a.itemData,h=[],l=[];d.forEach(f.operationalLayers,function(a){if(a.itemId&&
!a.type){var b=a.url.toLowerCase();-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?(l.push(a),h.push(Y(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!g.isDefined(a.minScale)&&!g.isDefined(a.maxScale))?(l.push(a),h.push(Y(a))):-1<b.indexOf("/imageserver")&&(!g.isDefined(a.minScale)&&!g.isDefined(a.maxScale))&&(l.push(a),h.push(Y(a)))}});f.baseMap&&f.baseMap.baseMapLayers&&d.forEach(f.baseMap.baseMapLayers,function(a){a.itemId&&(l.push(a),h.push(Y(a)))});0<
h.length?(new b(h)).addCallback(function(b){d.forEach(l,function(a,c){var e=b[c][1];if(e&&!a.type){var f=a.url.toLowerCase();(-1<f.indexOf("/featureserver")||-1<f.indexOf("/mapserver/"))&&e.layers?d.forEach(e.layers,function(b){if(f.endsWith("/featureserver/"+b.id)||f.endsWith("/mapserver/"+b.id))a.itemProperties=b,sa(a)}):-1<f.indexOf("/mapserver")?(e.layers&&!a.layers&&(a.layers=e.layers),g.isDefined(e.minScale)&&!g.isDefined(a.minScale)&&(a.minScale=e.minScale),g.isDefined(e.maxScale)&&!g.isDefined(a.maxScale)&&
(a.maxScale=e.maxScale),g.isDefined(e.refreshInterval)&&!g.isDefined(a.refreshInterval)&&(a.refreshInterval=e.refreshInterval)):-1<f.indexOf("/imageserver")&&(g.isDefined(e.minScale)&&!g.isDefined(a.minScale)&&(a.minScale=e.minScale),g.isDefined(e.maxScale)&&!g.isDefined(a.maxScale)&&(a.maxScale=e.maxScale),g.isDefined(e.refreshInterval)&&!g.isDefined(a.refreshInterval)&&(a.refreshInterval=e.refreshInterval),e.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=e.popupInfo),e.renderingRule&&
!a.renderingRule&&(a.renderingRule=e.renderingRule,e.renderingRule.functionName&&(a.renderingRule.rasterFunction=e.renderingRule.functionName)),e.bandIds&&!a.bandIds&&(a.bandIds=e.bandIds),e.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=e.mosaicRule),e.format&&!a.format&&(a.format=e.format),g.isDefined(e.compressionQuality)&&!g.isDefined(a.compressionQuality)&&(a.compressionQuality=e.compressionQuality))}});e.callback(a)}):e.callback(a);return e}function Ja(a,b){var c=new k,d=a.itemData,e=d.baseMap.baseMapLayers[0];
if("BingMapsAerial"===e.type||"BingMapsRoad"===e.type||"BingMapsHybrid"===e.type)if(e.portalUrl)delete b.bingMapsKey,ra(e.portalUrl).then(function(f){f.bingKey?(b.bingMapsKey=f.bingKey,f=new J({bingMapsKey:b.bingMapsKey,mapStyle:J.MAP_STYLE_AERIAL}),n.connect(f,"onLoad",h.hitch(this,function(){c.callback([a,b])})),n.connect(f,"onError",function(f){delete b.bingMapsKey;a.itemData=aa(d);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});
c.callback([a,b])})):(delete b.bingMapsKey,a.itemData=aa(d),e=a.itemData.baseMap.baseMapLayers[0],e.errors=[],e.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),c.callback([a,b]))});else if(b.bingMapsKey){var f=new J({bingMapsKey:b.bingMapsKey,mapStyle:J.MAP_STYLE_AERIAL});n.connect(f,"onLoad",h.hitch(this,function(){c.callback([a,b])}));n.connect(f,"onError",function(f){delete b.bingMapsKey;a.itemData=aa(d);e=a.itemData.baseMap.baseMapLayers[0];
e.errors=[];e.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});c.callback([a,b])})}else a.itemData=aa(d),e=a.itemData.baseMap.baseMapLayers[0],e.errors=[],e.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),c.callback([a,b]);else c.callback([a,b]);return c}function aa(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?
{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},
{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a}function ia(a,b){var c=a.dynamicLayerInfos||a.layerInfos,e=b.layers;if(e&&c){var f=[],h=[],k=[],l=[],m=[],n=[];d.forEach(c,function(b){var c=b.id;if(!b.subLayerIds&&-1!==d.indexOf(a.visibleLayers,c))for(b=0;b<e.length;b++){var p=e[b];if(p.id===c){h.push(c);f.push(p.popupInfo);k.push(p.layerUrl||"");p.layerDefinition&&
p.layerDefinition.definitionExpression?l.push(p.layerDefinition.definitionExpression):l.push("");m.push(g.isDefined(p.minScale)?p.minScale:null);n.push(g.isDefined(p.maxScale)?p.maxScale:null);break}}});f.length&&(a.__popups=f,a.__popupIds=h,a.__popupUrls=k,a.__popupWhereClauses=l,a.__popupMinScales=m,a.__popupMaxScales=n,a.__resourceInfo=b.resourceInfo)}}function ja(a){if(!a)return!1;var b=(new q(L.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function ta(a){return!a?
!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function Q(a){if("https:"===location.protocol&&(ja(a)||ta(a)))a=a.replace("http:","https:");return a}function ka(a){var b=[];a.displayLevels||(b=d.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));b=new K(Q(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||b,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval});
ia(b,a);return b}function la(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function ua(a){var b=new M;b.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&
(b.format="png32");var b=new W(Q(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:b,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),c=a.visibleLayers;if(!a.visibleLayers){var e="";d.forEach(b.layerInfos,function(a){a.defaultVisibility&&(e+=(0<e.length?",":"")+a.id)});c=e}if(a.layers&&0<a.layers.length){var f=[],g=[],k,l=[],m;d.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(f[b.id]=
b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){k=new H(h.mixin(b,b.layerDefinition));delete k.layerDefinition;k.id=b.id;if(a.visibleLayers){var c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers;-1<d.indexOf(c,b.id)?k.defaultVisibility=!0:k.defaultVisibility=!1}g.push(k)}b.layerDefinition&&(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(m=new X(b.layerDefinition.drawingInfo),l[b.id]=m)},this);0<f.length&&b.setLayerDefinitions(f);
0<g.length?(b.setDynamicLayerInfos(g,!0),0<l.length&&b.setLayerDrawingOptions(l,!0)):(c=la(b.layerInfos,c),b.setVisibleLayers(c))}else c=la(b.layerInfos,c),b.setVisibleLayers(c);ia(b,a);return b}function Ka(a,b){var c=new V;c.bandIds=a.bandIds;null!=a.format&&(c.format=a.format,null!=a.compressionQuality&&(c.compressionQuality=a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var d=new O(a.renderingRule);c.renderingRule=d}a.mosaicRule&&(d=new P(a.mosaicRule),c.mosaicRule=
d);g.isDefined(a.noData)&&(c.noData=a.noData);g.isDefined(a.noDataInterpretation)&&(c.noDataInterpretation=a.noDataInterpretation);g.isDefined(a.interpolation)&&(c.interpolation=a.interpolation);c=new S(Q(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:c,infoTemplate:a.popupInfo&&new b(a.popupInfo),minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval});a.layerDefinition&&a.layerDefinition.definitionExpression&&c.setDefinitionExpression(a.layerDefinition.definitionExpression,
!0);return c}function na(a,b,c){var e=[102113,102100,3857],h=c||new f(b[0].layerObject.fullExtent.spatialReference),k=new f(a.resourceInfo.fullExtent.spatialReference);return h.wkt==k.wkt&&(h.wkid==k.wkid||g.isDefined(h.latestWkid)&&h.latestWkid==k.wkid||g.isDefined(k.latestWkid)&&h.wkid==k.latestWkid||g.isDefined(h.latestWkid)&&h.latestWkid==k.latestWkid)||h.wkid&&k.wkid&&d.some(e,function(a){return a===k.wkid})&&d.some(e,function(a){return a===h.wkid})?!0:!1}function oa(a,b){if(!b[0].layerObject.tileInfo)return!1;
var c=[];d.forEach(b,function(a){a.baseMapLayer&&a.layerObject.tileInfo&&(c=c.concat(d.map(a.layerObject.tileInfo.lods,function(a){return a.scale})))});return d.some(a.resourceInfo.tileInfo.lods,function(a){return d.some(c,function(b){return b===a.scale})})}function qa(a,b,c,e,k){var l,m=c._clazz;if("OpenStreetMap"===a.type)l=new T({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WMS"===a.type){var q=[],u=[];d.forEach(a.layers,function(a){u.push(new ha({name:a.name,
title:a.title,legendURL:a.legendURL}));q.push(a.name)},this);a.visibleLayers&&(q=a.visibleLayers);e={extent:new t(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new f({wkid:4326})),layerInfos:u,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,title:a.title,copyright:a.copyright,minScale:a.minScale||0,maxScale:a.maxScale||0};l=new D(a.url,{id:a.id,visibleLayers:q,format:"png",transparent:a.baseMapLayer?!1:!0,opacity:a.opacity,
visible:null!==a.visibility?a.visibility:!0,resourceInfo:e,refreshInterval:a.refreshInterval});l.spatialReference.wkid=e.spatialReferences[0]}else if("KML"===a.type){c=a.url;if(s.id&&(m=s.id.findCredential(p.urlToObject(L.arcgisUrl).path))){b=L.arcgisUrl.substring(L.arcgisUrl.indexOf("//")+2,L.arcgisUrl.indexOf("/",L.arcgisUrl.indexOf("//")+3));k=b.split(".");k=k[k.length-2]+"."+k[k.length-1];var v=c.indexOf(k);-1<v&&(c="https://"+b+c.substring(v+k.length));c+="?token\x3d"+m.token}l=new E(c,{id:a.id,
visible:null!==a.visibility?a.visibility:!0,outSR:e,refreshInterval:a.refreshInterval});n.connect(l,"onLoad",function(){(a.opacity||0===a.opacity)&&l.setOpacity(a.opacity);a.visibleFolders&&d.forEach(l.folders,function(b){-1<d.indexOf(a.visibleFolders,b.id)?l.setFolderVisibility(b,!0):l.setFolderVisibility(b,!1)},this)})}else"WebTiledLayer"===a.type?(l=new ga(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new t(a.fullExtent),
initialExtent:a.fullExtent&&new t(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new F(a.tileInfo):null,refreshInterval:a.refreshInterval}),n.connect(l,"onLoad",function(){(g.isDefined(a.minScale)||g.isDefined(a.maxScale))&&l.setScaleRange(a.minScale,a.maxScale)})):"GeoRSS"===a.type?(l=new U(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:e,refreshInterval:a.refreshInterval}),n.connect(l,"onLoad",function(){!1===a.visibility&&l.hide();var b=l.getFeatureLayers();d.forEach(b,function(b){a.pointSymbol&&
"esriGeometryPoint"===b.geometryType?b.renderer.symbol=x.fromJson(a.pointSymbol):a.lineSymbol&&"esriGeometryPolyline"===b.geometryType?b.renderer.symbol=x.fromJson(a.lineSymbol):a.polygonSymbol&&"esriGeometryPolygon"===b.geometryType&&(b.renderer.symbol=x.fromJson(a.polygonSymbol));(g.isDefined(a.minScale)||g.isDefined(a.maxScale))&&b.setScaleRange(a.minScale,a.maxScale)})})):"CSV"==a.type&&a.url?(e={layerDefinition:a.layerDefinition,columnDelimiter:a.columnDelimiter,infoTemplate:new w(a.popupInfo?
a.popupInfo:N.generateDefaultPopupInfo(a)),id:a.id?a.id:null,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,refreshInterval:a.refreshInterval},a.locationInfo&&(e.latitudeFieldName=a.locationInfo.latitudeFieldName,e.longitudeFieldName=a.locationInfo.longitudeFieldName),l=new Z(a.url,e)):a.layerDefinition&&!a.url?(e=r.fromJson(r.toJson(a)),delete e.id,delete e.opacity,delete e.visibility,l=new C(e,{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],infoTemplate:e.popupInfo&&
new m(e.popupInfo),autoGeneralize:!0})):"BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?c.bingMapsKey?(e=J.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?e=J.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(e=J.MAP_STYLE_ROAD),l=new J({bingMapsKey:c.bingMapsKey,mapStyle:e,opacity:a.opacity,id:a.id}),n.connect(l,"onError",h.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+
a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?l=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||na(a,b,e)&&oa(a,k))?ka(a):ua(a):a.resourceInfo&&a.resourceInfo.pixelSizeX?l=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||na(a,b,e)&&oa(a,k))?ka(a):Ka(a,m):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type&&
(a.capabilities&&(a.resourceInfo.capabilities=a.capabilities),l=new C(Q(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,mode:ja(a.url)?C.MODE_AUTO:g.isDefined(a.mode)?a.mode:C.MODE_ONDEMAND,outFields:["*"],infoTemplate:a.popupInfo&&new m(a.popupInfo),autoGeneralize:!0,refreshInterval:a.refreshInterval}),a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(e=y.fromJson(a.layerDefinition.drawingInfo.renderer),e.isMaxInclusive=
!0,l.setRenderer(e)),a.layerDefinition.definitionExpression&&l.setDefinitionExpression(a.layerDefinition.definitionExpression),g.isDefined(a.layerDefinition.minScale)&&l.setMinScale(a.layerDefinition.minScale),g.isDefined(a.layerDefinition.maxScale)&&l.setMaxScale(a.layerDefinition.maxScale)));l&&(l.arcgisProps={title:a.title},a.baseMapLayer&&(l._basemapGalleryLayerType=a.isReference?"reference":"basemap"));return l}function ma(a,b,c,e){d.forEach(a,function(d,f){if(d.url&&!d.type){if(0===f||a[0].layerObject)d.layerObject=
qa(d,a,b,c,e)}else d.layerObject=qa(d,a,b,c,e)});var f=d.filter(a,function(a){return!a.isReference}),g=d.filter(a,function(a){return!!a.isReference});return a=f.concat(g)}function pa(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new f,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?b=new f({wkid:102100}):
"WMS"==a.type&&(b=new f({wkid:a.spatialReferences[0]}));return b}function va(a,b,c,e,f,g,h){d.forEach(b,function(b,c){b.url&&!b.type&&(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos)});g=g||pa(b);b=ma(b,c,g,h);f.callback(b);return f}function wa(a,b){var c=Q(a);return m({url:c,content:{f:"json"},callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.push(a);v.defaults.io.errorHandler(a,d)}})}function xa(a){var b=L.arcgisUrl+"/"+a.itemId+
"/data";return m({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,d){c.message=c.message?c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);v.defaults.io.errorHandler(c,d)}})}function ya(a,b,c){var e=new k;if((!c.featureCollection||!c.featureCollection.layers)&&!c.layers)return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+
a.itemId+"]"}),e.errback(),e;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,g.isDefined(c.showLegend)&&(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));za(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?d.forEach(c.featureCollection.layers,function(b,c){var d=a.featureCollection.layers[c];if(!d.poupInfo&&!d.layerDefinition)d.popupInfo=b.popupInfo,d.layerDefinition=b.layerDefinition;else if(d.layerDefinition){if(g.isDefined(d.layerDefinition.minScale)&&
g.isDefined(d.layerDefinition.maxScale)&&(d.layerDefinition.minScale!==b.layerDefinition.minScale||d.layerDefinition.maxScale!==b.layerDefinition.maxScale))delete b.layerDefinition.minscale,delete b.layerDefinition.maxScale;d.layerDefinition.drawingInfo&&r.toJson(d.layerDefinition.drawingInfo)!==r.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo;d.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend;d.layerDefinition=h.mixin(d.layerDefinition,
b.layerDefinition)}else d.layerDefinition=b.layerDefinition;d.featureSet=b.featureSet;d.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=h.mixin(a.featureCollection,c.featureCollection));e.callback(a)});return e}function za(a,c,e){var f=new k,h=[];d.forEach(c.layers,function(a){a.featureSet&&(a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference)&&(a.deferredsPos=h.length,
h.push(N.projectFeatureCollection(a,e,a.featureSet.features[0].geometry.spatialReference)))});(new b(h)).addCallback(function(){d.forEach(c.layers,function(b){g.isDefined(b.deferredsPos)&&(h[b.deferredsPos].results&&h[b.deferredsPos].results.length?b=h[b.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+
"]"})),delete b.deferredsPos)});f.callback(c)});return f}function ba(a,c,f,g){var l=new k,m=new k,n=[],p;d.forEach(a.operationalLayers,function(a,b){a.itemId&&"Feature Collection"==a.type&&n.push(xa(a).then(h.hitch(null,ya,a,f)))});0===n.length?Aa(a,c,f,g,m):(p=new b(n),p.addCallback(function(b){Aa(a,c,f,g,m)}));m.then(function(a){n=[];d.forEach(a,function(a){a=a.layerObject;if(a instanceof C&&!a.loaded&&!a.loadError){var b=new k;e.once(a,"load, error",function(){b.callback(a)});n.push(b)}});0===
n.length?l.callback(a):(p=new b(n),p.addCallback(function(){l.callback(a)}))});return l}function Aa(a,c,e,f,g){var h=[],k=[],l=[];d.forEach(a.operationalLayers,function(a,b){a.featureCollection?d.forEach(a.featureCollection.layers,function(c,e){var f=!0;a.visibleLayers&&-1==d.indexOf(a.visibleLayers,e)&&(f=!1);c.visibility=a.visibility&&f;c.opacity=a.opacity;c.id=(a.id||"operational"+b)+"_"+e;l.push(c)},this):l.push(a)});d.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||
"base"+b;h.push(a)});d.forEach(l,function(a,b){a.id=a.id||"operational"+b;h.push(a)});d.forEach(h,function(a){a.url&&!a.type&&(a.deferredsPos=k.length,a.errors=a.errors||[],k.push(wa(a.url,a.errors)))});0===k.length?(e=e||pa(h),h=ma(h,c,e,f),g.callback(h)):(new b(k)).addCallback(function(a){va(a,h,c,k,g,e,f)});return g}function ca(a,b,c,e){var f=a.minScale,g=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==e)if(0==f&&0<b[a].minScale?f=b[a].minScale:0<f&&0==b[a].minScale?f=c.minScale:
0<f&&0<b[a].minScale&&(f=Math.min(f,b[a].minScale)),g=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(f,g),-1<b[a].parentLayerId)e=b[a].parentLayerId;else break}else 10.1<c.version&&(d.forEach(a.layerInfos,function(a){a.id==e&&(0==f&&0<a.minScale?f=a.minScale:0<f&&0==a.minScale||0<f&&0<a.minScale&&(f=Math.min(f,a.minScale)),g=Math.max(g||0,a.maxScale||0))}),c.setScaleRange(f,g))}function da(a,b,c,e){var f=a.url,k=a.__popupIds,l=a.__popupUrls,m=a.__popupWhereClauses,p=a.__popupMinScales,q=
a.__popupMaxScales,r=a.__resourceInfo,s=[];d.forEach(a.__popups,function(e,h){if(e){var t,u=[];d.forEach(e.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&u.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var v=d.filter(a.dynamicLayerInfos,function(a){return k[h]==a.id})[0].source;t=new C(f+"/dynamicLayer",{id:a.id+"_"+k[h],source:v,outFields:u,mode:C.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,autoGeneralize:!0});var w=function(c,d){0<
m[c].length&&d.setDefinitionExpression(m[c]);if(!g.isDefined(p[c])&&!g.isDefined(q[c]))ca(a,b||r.layers,d,k[c]);else if(g.isDefined(a.minScale)||g.isDefined(a.maxScale)){var e=a.minScale,f=a.maxScale;0==e&&0<p[c]?e=p[c]:0<e&&0==p[c]||0<e&&0<p[c]&&(e=Math.min(e,p[c]));f=Math.max(f||0,q[c]||0);d.setScaleRange(e,f)}else d.setScaleRange(p[c],q[c])};t.loaded?w(h,t):n.connect(t,"onLoad",function(a){w(h,t)})}else{var x=null,y=f+"/"+k[h];if(l[h].length)y=l[h];else if(b)for(v=0;v<b.length;v++)if(b[v].id===
k[h]){x=b[v];break}t=new C(Q(y),{id:a.id+"_"+k[h],outFields:u,mode:C.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,resourceInfo:x,autoGeneralize:!0});t.loaded?(0<m[h].length&&t.setDefinitionExpression(m[h]),ca(a,b||r.layers,t,k[h])):n.connect(t,"onLoad",function(c){0<m[h].length&&t.setDefinitionExpression(m[h]);ca(a,b||r.layers,c,k[h])})}s.push(t)}});0<s.length&&(n.connect(a,"onVisibilityChange",h.hitch(this,function(a,b){d.forEach(a,function(a){b?a.show():a.hide()})},s)),
n.connect(e,"onLayerRemove",h.hitch(this,function(a,b,c){a.id===c.id&&d.forEach(b,function(a){e.removeLayer(a)})},a,s)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return s}function Ba(a){return m({url:Q(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function Ca(a,c,e){var f=[];d.forEach(a,function(a){var b=a.__popups;b&&(1<b.length&&10<=a.version)&&
(a.__deferredsPos=f.length,f.push(Ba(a)))});var g=[];0<f.length?(new b(f)).addCallback(function(b){d.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(g=g.concat(da(a,b[a.__deferredsPos][1].layers,e,c)),delete a.__deferredsPos):g=g.concat(da(a,null,e,c)))});c.addLayers(g)}):(d.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(g=g.concat(da(a,null,e,c)))}),c.addLayers(g))}function Da(a){d.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),
a.featureSet&&-1<b.name.indexOf("Text")&&d.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function Ea(a){var b=6;d.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,
Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&d.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function ea(a){var b=this,c=b.infoWindow,e=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var f=[];d.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("FeatureLayer")&&a.loaded&&
a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&f.push(a)});d.forEach(b.layerIds,function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&f.push(a)});e=e&&e.getInfoTemplate()?e:null;if(f.length||e){var g=Ea(f),h=a.screenPoint,l=b.toMap(new u(h.x-g,h.y+g)),g=b.toMap(new u(h.x+g,h.y-g)),l=new t(l.x,l.y,g.x,g.y,b.spatialReference),m=new B;m.geometry=l;m.timeExtent=b.timeExtent;var n=!0,l=d.map(f,function(a){var b;-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?
(n=!1,b=a.queryVisibleRasters(m,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),b.addCallback(function(){return a.getVisibleRasters()})):(b=a.selectFeatures(m),b.addCallback(function(){return a.getSelectedFeatures()}));return b});e&&(g=new k,g.callback([e]),l.splice(0,0,g));if(!d.some(l,function(a){return-1===a.fired})){var p=e?1:0;d.forEach(f,function(a){p=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?p+a.getVisibleRasters().length:p+a.getSelectedFeatures().length});
if(!p)return}c.setFeatures(l);c.show(a.mapPoint,{closestFirst:n})}}}function La(b,d){var e=d.mapOptions||{},f;e.infoWindow||(f=new A({visibleWhenEmpty:!1},c.create("div")),e.infoWindow=f);g.isDefined(e.showInfoWindowOnClick)||(e.showInfoWindowOnClick=!1);e=new a(b,e);n.connect(e,"onLayersAddResult",Da);return e}function R(a,b,c,e,f,g){var h,k,l;e.map?(h=e.map,k=e.clickEventHandle,l=e.errors):(h=La(e,f),!f.ignorePopups&&!f.disableClickBehavior&&(k=n.connect(h,"onClick",ea)));f.ignorePopups&&d.forEach(a,
function(a){delete a.infoTemplate});h.addLayers(a);f.ignorePopups||Ca(a,h,f._clazz);var m=l||[];d.forEach(b,function(a){a.errors&&(m=m.concat(a.errors))},this);h.loaded?g.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,clickEventListener:ea}):n.connect(h,"onLoad",function(){g.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,clickEventListener:ea})})}function fa(a,b,c,e,f){var g=[];d.forEach(f,function(a){h.isArray(a.layerObject)?d.forEach(a.layerObject,function(a){g.push(a)}):g.push(a.layerObject)});
if("BingMapsAerial"===f[0].type||"BingMapsRoad"===f[0].type||"BingMapsHybrid"===f[0].type)var k=setInterval(function(){if(f[0].layerObject&&f[0].layerObject.loaded)clearInterval(k),Fa(a,b,c,e,f,g);else if(f[0].errors){clearInterval(k);var d="";f[0].errors&&f[0].errors.length&&(d=" ("+f[0].errors[0].message+")");e.errback(Error(I.arcgis.utils.baseLayerError+d))}},10);else if(!g[0]&&f[0].baseMapLayer){var l="";f[0].errors&&f[0].errors.length&&(l=" ("+f[0].errors[0].message+")");e.errback(Error(I.arcgis.utils.baseLayerError+
l))}else Fa(a,b,c,e,f,g)}function Fa(a,b,c,e,h,k){try{var l=c.mapOptions||{};c.mapOptions=l;var m=a.item;k=d.filter(k,g.isDefined);if(m)if(m.extent&&m.extent.length)if(l.extent)R(k,h,a,b,c,e);else{var n=new t(m.extent[0][0],m.extent[0][1],m.extent[1][0],m.extent[1][1],new f({wkid:4326})),p=k[0].spatialReference;4326===p.wkid?(l.extent=n,R(k,h,a,b,c,e)):102100===p.wkid||102113===p.wkid||3857===p.wkid?(n.xmin=Math.max(n.xmin,-180),n.xmax=Math.min(n.xmax,180),n.ymin=Math.max(n.ymin,-89.99),n.ymax=Math.min(n.ymax,
89.99),l.extent=z.geographicToWebMercator(n),R(k,h,a,b,c,e)):c.geometryServiceURL||v.defaults.geometryService?(c.geometryServiceURL?new G(c.geometryServiceURL):v.defaults.geometryService).project([n],p,function(d){d=d[0];l.extent=l.extent||d;R(k,h,a,b,c,e)},function(){R(k,h,a,b,c,e)}):e.errback(Error(I.arcgis.utils.geometryServiceError))}else R(k,h,a,b,c,e);else R(k,h,a,b,c,e)}catch(q){e.errback(q)}}function Ga(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);d.forEach(a,function(a,
c){var e={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&d.forEach(a.featureCollection.layers,function(c){!1!==c.showLegend&&(e={layer:c.layerObject,title:a.title,defaultSymbol:c.renderer&&c.renderer.defaultSymbol&&c.renderer.defaultLabel?!0:!1},1<a.featureCollection.layers.length&&(e.title+=" - "+c.layerDefinition.name),b.push(e))});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject){var f=a.layerObject.renderer,
f=!f||f&&f.defaultSymbol&&f.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&(a.layerObject instanceof W||a.layerObject instanceof K)||a.layerObject instanceof S)f=!0;e={layer:a.layerObject,title:a.title,defaultSymbol:f};a.layers&&(f=d.map(d.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),f.length&&(e.hideLayers=f));b.push(e)}});return b}function Ha(a,b,c,e){Ja(e,b).then(function(b){var e=b[0],f=b[1];if(!e.itemData.operationalLayers||0===e.itemData.operationalLayers.length)$(e,
f).addCallback(function(b){ba(b.itemData,f).addCallback(h.hitch(null,fa,b,a,f,c))});else{var g=new k,l=e.itemData.baseMap.baseMapLayers.slice(0),m=d.filter(e.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:e.item,itemData:{baseMap:{baseMapLayers:m}}};e.itemData.baseMap.baseMapLayers=d.filter(e.itemData.baseMap.baseMapLayers,function(a){return a.isReference});$(b,f).addCallback(function(b){ba(b.itemData,f).addCallback(h.hitch(null,fa,b,a,f,g))});g.then(function(a){$(e,f).addCallback(function(b){ba(b.itemData,
f,a.map.spatialReference,m).addCallback(function(d){b.itemData.baseMap.baseMapLayers=l;fa(b,a,f,c,d)})})},h.hitch(c,c.errback))}})}function Ia(a){L._arcgisUrl&&0<L._arcgisUrl.length&&(L.arcgisUrl=L._arcgisUrl);var b=L.arcgisUrl+"/"+a,c={},d=new k;m({url:b,content:{f:"json"},callbackParamName:"callback",load:function(a){c.item=a;m({url:b+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){c.itemData=a;d.callback(c)},error:function(a){d.errback(a)}})},error:function(a){d.errback(a)}});
return d}String.prototype.endsWith=function(a){return this.match(a+"$")==a};var L;L={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:Ia,createMap:function(a,b,c){var d=new k;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(h.isObject(e)?e:h.getObject(e))||w;h.isString(a)?Ia(a).addCallback(h.hitch(null,Ha,b,c,d)).addErrback(h.hitch(d,d.errback)):Ha(b,c,d,a);return d},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Ga(a.itemInfo.itemData):[]},_arcgisUrl:null,
_getItemProps:$,_getItemData:Y,_getBingKey:ra,_processFSItemProperties:sa,_getLayers:ba,_preBuildLayerObjects:va,_buildLayerObjects:ma,_preCreateMap:fa,_getMapSR:pa,_createMap:R,_addSelectionLayers:Ca,_createSelectionFeatureLayers:da,_getServiceInfo:wa,_getFeatureCollectionItem:xa,_mergeFeatureCollectionItem:ya,_projectFeatureCollection:za,_getLayersInfo:Ba,_initLayer:qa,_loadAsCached:ka,_loadAsDynamic:ua,_processPopups:ia,_onLayersAddResult:Da,_sameSpatialReferenceAsBasemap:na,_sameTilingSchemeAsBasemap:oa,
_showPopup:ea,_calculateClickTolerance:Ea,_getVisibleFeatureLayers:la,_updateLayerScaleInfo:ca,_checkUrl:Q,_isHostedService:ja,_isAgolService:ta,_getLegendLayers:Ga};h.setObject("arcgis.utils",L,s);return L});